!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("xmldom"),require("util"),require("tokenizr")):"function"==typeof define&&define.amd?define("@ngx-i18nsupport/ngx-i18nsupport-lib",["exports","@angular/core","xmldom","util","tokenizr"],t):t((e["ngx-i18nsupport"]=e["ngx-i18nsupport"]||{},e["ngx-i18nsupport"]["ngx-i18nsupport-lib"]={}),e.ng.core,e.xmldom,e.util,e.tokenizr)}(this,function(e,t,a,f,n){"use strict";var r=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],e}(),p="xlf",c="xlf2",m="xmb",h="xtb",o="XLIFF 1.2",s="XLIFF 2.0",u="new",l="translated",g="final",i="ngxtranslate",d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function T(e,t){function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function E(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}return o}var y=function(){function r(){}return r.getFirstElementByTagName=function(e,t){var n=e.getElementsByTagName(t);return n&&0<n.length?n.item(0):null},r.getElementByTagNameAndId=function(e,t,n){var r=e.getElementsByTagName(t);if(r&&0<r.length)for(var i=0;i<r.length;i++){var a=r.item(i);if(a.getAttribute("id")===n)return a}return null},r.getElementFollowingSibling=function(e){if(!e)return null;for(var t=e.nextSibling;t;){if(t.nodeType===t.ELEMENT_NODE)return t;t=t.nextSibling}return null},r.getElementPrecedingSibling=function(e){if(!e)return null;for(var t=e.previousSibling;t;){if(t.nodeType===t.ELEMENT_NODE)return t;t=t.previousSibling}return null},r.getXMLContent=function(e){if(!e)return null;var t=(new a.XMLSerializer).serializeToString(e),n=e.nodeName,r=new RegExp("<"+n+"[^>]*>","g");t=t.replace(r,"");var i=new RegExp("</"+n+">","g");return t=t.replace(i,"")},r.getPCDATA=function(e){if(!e)return null;for(var t="",n=e.childNodes,r=0;r<n.length;r++){var i=n.item(r);i.nodeType!==i.TEXT_NODE&&i.nodeType!==i.CDATA_SECTION_NODE||(t+=i.nodeValue)}return 0===t.length?null:t},r.replaceContentWithXMLContent=function(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);for(var n=(new a.DOMParser).parseFromString("<fragment>"+t+"</fragment>","application/xml").getElementsByTagName("fragment").item(0).childNodes,r=0;r<n.length;r++){var i=n.item(r);e.appendChild(e.ownerDocument.importNode(i,!0))}},r.getPreviousElementSibling=function(e){for(var t=e.previousSibling;null!==t;){if(t.nodeType===t.ELEMENT_NODE)return t;t=t.previousSibling}return null},r.createFollowingSibling=function(e,t){var n=t.ownerDocument.createElement(e);return r.insertAfter(n,t)},r.insertAfter=function(e,t){return null!==t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e),e},r.insertBefore=function(e,t){return t.parentNode.insertBefore(e,t),e},r}(),N=function(){function e(){}return e.prototype.serializeToString=function(e,t){var n=[],r=[],i=e.documentElement,a=i.prefix,o=i.namespaceURI;if(o&&null==a&&null==(a=i.lookupPrefix(o))&&(r=[{namespace:o,prefix:null}]),t||(t={}),t.indentString&&!this.containsOnlyWhiteSpace(t.indentString))throw new Error("indentString must not contain non white characters");return this.doSerializeToString(e,t,n,0,!1,r),n.join("")},e.prototype.doSerializeToString=function(e,t,n,r,i,a){var o;switch(e.nodeType){case e.ELEMENT_NODE:var s=e,u=s.attributes,l=u.length;o=s.firstChild;var p=s.tagName,c=this.isMixedContentElement(p,t);i?n.push("<",p):this.outputIndented(t,n,r,"<",p);for(var m=0;m<l;m++){"xmlns"===(f=u.item(m)).prefix?a.push({prefix:f.localName,namespace:f.value}):"xmlns"===f.nodeName&&a.push({prefix:"",namespace:f.value})}for(m=0;m<l;m++){var f=u.item(m);if(this.needNamespaceDefine(f,a)){var h=f.prefix||"",g=f.namespaceURI,d=h?" xmlns:"+h:" xmlns";n.push(d,'="',g,'"'),a.push({prefix:h,namespace:g})}this.doSerializeToString(f,t,n,r,!1,a)}if(this.needNamespaceDefine(s,a)){h=s.prefix||"",g=e.namespaceURI,d=h?" xmlns:"+h:" xmlns";n.push(d,'="',g,'"'),a.push({prefix:h,namespace:g})}if(o){n.push(">");for(var T=!1;o;)o.nodeType===o.ELEMENT_NODE&&(T=!0),this.doSerializeToString(o,t,n,r+1,i||c,a),o=o.nextSibling;i||c||!T?n.push("</",p,">"):this.outputIndented(t,n,r,"</",p,">")}else n.push("/>");return;case e.DOCUMENT_NODE:case e.DOCUMENT_FRAGMENT_NODE:for(o=e.firstChild;o;)this.doSerializeToString(o,t,n,r,!1,a),o=o.nextSibling;return;case e.ATTRIBUTE_NODE:var E=e;return n.push(" ",E.name,'="',E.value.replace(/[<&"]/g,this._xmlEncoder),'"');case e.TEXT_NODE:var y=e;return t.beautify&&!i&&this.containsOnlyWhiteSpace(y.data)?void 0:n.push(y.data.replace(/[<&]/g,this._xmlEncoder));case e.CDATA_SECTION_NODE:var N=e;return n.push("<![CDATA[",N.data,"]]>");case e.COMMENT_NODE:var v=e;return n.push("\x3c!--",v.data,"--\x3e");case e.DOCUMENT_TYPE_NODE:var _=e,C=_.publicId,A=_.systemId;if(n.push("<!DOCTYPE ",_.name),C)n.push(' PUBLIC "',C),A&&"."!==A&&n.push('" "',A),n.push('">');else if(A&&"."!==A)n.push(' SYSTEM "',A,'">');else{var S=_.internalSubset;S&&n.push(" [",S,"]"),n.push(">")}return;case e.PROCESSING_INSTRUCTION_NODE:var b=e;return n.push("<?",b.target," ",b.data,"?>");case e.ENTITY_REFERENCE_NODE:return n.push("&",e.nodeName,";");default:n.push("??",e.nodeName)}},e.prototype.needNamespaceDefine=function(e,t){var n=e.prefix||"",r=e.namespaceURI;if(!n&&!r)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===r||"http://www.w3.org/2000/xmlns/"===r)return!1;for(var i=t.length;i--;){var a=t[i];if(a.prefix===n)return a.namespace!==r}return!0},e.prototype._xmlEncoder=function(e){return("<"===e?"&lt;":">"===e&&"&gt;")||"&"===e&&"&amp;"||'"'===e&&"&quot;"||"&#"+e.charCodeAt(0)+";"},e.prototype.outputIndented=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e.beautify&&(t.push("\n"),0<n&&t.push(this.indentationString(e,n))),t.push.apply(t,function a(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(E(arguments[t]));return e}(r))},e.prototype.indentationString=function(e,t){for(var n=e.indentString?e.indentString:"  ",r="",i=0;i<t;i++)r+=n;return r},e.prototype.isMixedContentElement=function(t,e){return!(!e||!e.mixedContentElements)&&!!e.mixedContentElements.find(function(e){return e===t})},e.prototype.containsOnlyWhiteSpace=function(e){for(var t=0;t<e.length;t++){var n=e.charAt(t);if(" "!==n&&"\t"!==n&&"\r"!==n&&"\n"!==n)return!1}return!0},e}(),v=function(){function e(){this.transUnits=null,this._warnings=[]}return e.prototype.parseContent=function(e,t,n,r){this._filename=t,this._encoding=n,this._parsedDocument=(new a.DOMParser).parseFromString(e,"text/xml"),this._fileEndsWithEOL=e.endsWith("\n")},e.prototype.lazyInitializeTransUnits=function(){f.isNullOrUndefined(this.transUnits)&&(this.initializeTransUnits(),this.countNumbers())},e.prototype.countNumbers=function(){var n=this;this._numberOfTransUnitsWithMissingId=0,this._numberOfUntranslatedTransUnits=0,this._numberOfReviewedTransUnits=0,this.forEachTransUnit(function(e){(f.isNullOrUndefined(e.id)||""===e.id)&&n._numberOfTransUnitsWithMissingId++;var t=e.targetState();(f.isNullOrUndefined(t)||t===u)&&n._numberOfUntranslatedTransUnits++,t===l&&n._numberOfReviewedTransUnits++})},e.prototype.warnings=function(){return this.lazyInitializeTransUnits(),this._warnings},e.prototype.numberOfTransUnits=function(){return this.lazyInitializeTransUnits(),this.transUnits.length},e.prototype.numberOfUntranslatedTransUnits=function(){return this.lazyInitializeTransUnits(),this._numberOfUntranslatedTransUnits},e.prototype.numberOfReviewedTransUnits=function(){return this.lazyInitializeTransUnits(),this._numberOfReviewedTransUnits},e.prototype.numberOfTransUnitsWithMissingId=function(){return this.lazyInitializeTransUnits(),this._numberOfTransUnitsWithMissingId},e.prototype.forEachTransUnit=function(t){this.lazyInitializeTransUnits(),this.transUnits.forEach(function(e){return t(e)})},e.prototype.transUnitWithId=function(t){return this.lazyInitializeTransUnits(),this.transUnits.find(function(e){return e.id===t})},e.prototype.setNewTransUnitTargetPraefix=function(e){this.targetPraefix=e},e.prototype.getNewTransUnitTargetPraefix=function(){return f.isNullOrUndefined(this.targetPraefix)?"":this.targetPraefix},e.prototype.setNewTransUnitTargetSuffix=function(e){this.targetSuffix=e},e.prototype.getNewTransUnitTargetSuffix=function(){return f.isNullOrUndefined(this.targetSuffix)?"":this.targetSuffix},e.prototype.removeTransUnitWithId=function(t){var e=this._parsedDocument.getElementById(t);e&&(e.parentNode.removeChild(e),this.lazyInitializeTransUnits(),this.transUnits=this.transUnits.filter(function(e){return e.id!==t}),this.countNumbers())},e.prototype.filename=function(){return this._filename},e.prototype.encoding=function(){return this._encoding},e.prototype.editedContent=function(e){var t={};!0===e&&(t.beautify=!0,t.indentString="  ",t.mixedContentElements=this.elementsWithMixedContent());var n=(new N).serializeToString(this._parsedDocument,t);return this._fileEndsWithEOL?n+"\n":n},e}(),_=function(){function e(e,t,n){this._element=e,this._id=t,this._translationMessagesFile=n}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.translationMessagesFile=function(){return this._translationMessagesFile},e.prototype.supportsSetSourceContent=function(){return!0},e.prototype.sourceContentNormalized=function(){return f.isNullOrUndefined(this._sourceContentNormalized)&&(this._sourceContentNormalized=this.createSourceContentNormalized()),this._sourceContentNormalized},e.prototype.targetState=function(){var e=this.nativeTargetState();return this.mapNativeStateToState(e)},e.prototype.setTargetState=function(e){this.setNativeTargetState(this.mapStateToNativeState(e)),this.translationMessagesFile()instanceof v&&this.translationMessagesFile().countNumbers()},e.prototype.supportsSetSourceReferences=function(){return!0},e.prototype.supportsSetDescriptionAndMeaning=function(){return!0},e.prototype.checkNotes=function(e){var t=e.find(function(e){return"description"===e.from||"meaning"===e.from});if(!f.isNullOrUndefined(t))throw new Error("description or meaning are not allowed as from atttribute")},e.prototype.asXmlElement=function(){return this._element},e.prototype.translate=function(e){var t;t=f.isString(e)?e:e.asNativeString(),this.translateNative(t),this.setTargetState(l)},e.prototype.isICUMessage=function(e){return this.messageParser().isICUMessageStart(e)},e}(),C={TEXT:0,PLACEHOLDER:1,START_TAG:2,END_TAG:3,EMPTY_TAG:4,ICU_MESSAGE:5,ICU_MESSAGE_REF:6};C[C.TEXT]="TEXT",C[C.PLACEHOLDER]="PLACEHOLDER",C[C.START_TAG]="START_TAG",C[C.END_TAG]="END_TAG",C[C.EMPTY_TAG]="EMPTY_TAG",C[C.ICU_MESSAGE]="ICU_MESSAGE",C[C.ICU_MESSAGE_REF]="ICU_MESSAGE_REF";var A=function he(e){this.type=e},S=function(n){function e(e){var t=n.call(this,C.TEXT)||this;return t.text=e,t}return T(e,n),e.prototype.asDisplayString=function(e){return this.text},e}(A),b=function(r){function e(e,t){var n=r.call(this,C.PLACEHOLDER)||this;return n._index=e,n._disp=t,n}return T(e,r),e.prototype.asDisplayString=function(e){return"{{"+this._index+"}}"},e.prototype.index=function(){return this._index},e.prototype.disp=function(){return this._disp},e}(A),w=function(r){function e(e,t){var n=r.call(this,C.START_TAG)||this;return n._tagname=e,n._idcounter=t,n}return T(e,r),e.prototype.asDisplayString=function(e){return 0===this._idcounter?"<"+this._tagname+">":"<"+this._tagname+' id="'+this._idcounter.toString()+'">'},e.prototype.tagName=function(){return this._tagname},e.prototype.idCounter=function(){return this._idcounter},e}(A),x=function(n){function e(e){var t=n.call(this,C.END_TAG)||this;return t._tagname=e,t}return T(e,n),e.prototype.asDisplayString=function(e){return"</"+this._tagname+">"},e.prototype.tagName=function(){return this._tagname},e}(A),U="TEXT",M="CURLY_BRACE_OPEN",I="CURLY_BRACE_CLOSE",F="COMMA",O="PLURAL",L="SELECT",R="normal",P="in_message",D=function(){function e(){}return e.prototype.getLexer=function(){var r=this,e=new n,i="",a=0;return e.before(function(e,t,n){n.name!==U&&(r.containsNonWhiteSpace(i)?(e.accept(U,i),i=""):e.ignore())}),e.finish(function(e){r.containsNonWhiteSpace(i)&&e.accept(U,i)}),e.rule("default",/{/,function(e,t){e.accept(M,t[0]),e.push(R)},M),e.rule(R,/{/,function(e,t){e.accept(M,t[0]),e.push(P)},M),e.rule(R,/}/,function(e,t){e.pop(),e.accept(I,t[0])},I),e.rule(P,/'[{}]?'/,function(e,t){"''"===t[0]?i+="'":"'{'"===t[0]?i+="{":"'}'"===t[0]&&(i+="}"),e.ignore()},U),e.rule(P,/./,function(e,t){var n=t[0];"{"===n?(a++,i+=t[0],e.ignore()):"}"===n?0<a?(a--,i+=t[0],e.ignore()):(e.pop(),e.accept(U,i),i="",e.accept(I,t[0])):(i+=t[0],e.ignore())},U),e.rule(R,/,/,function(e,t){e.accept(F,t[0])},F),e.rule(R,/plural/,function(e,t){e.accept(O,t[0])},O),e.rule(R,/select/,function(e,t){e.accept(L,t[0])},L),e.rule(/./,function(e,t){i+=t[0],e.ignore()},U),e.rule(/[\s]+/,function(e,t){i+=t[0],e.ignore()},U),e},e.prototype.containsNonWhiteSpace=function(e){for(var t=0;t<e.length;t++)if(!/\s/.test(e.charAt(t)))return!0;return!1},e.prototype.tokenize=function(e){var t=this.getLexer();return t.input(e),t.tokens()},e.prototype.input=function(e){this.lexer=this.getLexer(),this.lexer.input(e)},e.prototype.next=function(){return this.lexer.token()},e.prototype.peek=function(){return this.lexer.peek()},e}(),X=function(){function e(e,t){this._category=e,this._message=t}return e.prototype.getCategory=function(){return this._category},e.prototype.getMessageNormalized=function(){return this._message},e}(),B=function(){function e(e,t){this._parser=e,this._isPluralMessage=t,this._categories=[]}return e.prototype.addCategory=function(e,t){this._categories.push(new X(e,t))},e.prototype.asNativeString=function(){var e=this.isPluralMessage()?"VAR_PLURAL":"VAR_SELECT",t=this.isPluralMessage()?"plural":"select",n="";return this._categories.forEach(function(e){n+=f.format(" %s {%s}",e.getCategory(),e.getMessageNormalized().asNativeString())}),f.format("{%s, %s,%s}",e,t,n)},e.prototype.isPluralMessage=function(){return this._isPluralMessage},e.prototype.isSelectMessage=function(){return!this._isPluralMessage},e.prototype.getCategories=function(){return this._categories},e.prototype.translate=function(r){var i=this,a=new e(this._parser,this.isPluralMessage()),o=new Set;return this._categories.forEach(function(e){var t,n=r[e.getCategory()];t=f.isNullOrUndefined(n)?e.getMessageNormalized():f.isString(n)?(o.add(e.getCategory()),i._parser.parseNormalizedString(n,null)):null,a.addCategory(e.getCategory(),t)}),Object.keys(r).forEach(function(e){if(!o.has(e)){if(i.isSelectMessage())throw new Error(f.format('adding a new category not allowed for select messages ("%s" is not part of message)',e));i.checkValidPluralCategory(e);var t=i._parser.parseNormalizedString(r[e],null);a.addCategory(e,t)}}),a},e.prototype.checkValidPluralCategory=function(t){var e=["zero","one","two","few","many","other"];if(!t.match(/=\d+/)&&!e.find(function(e){return e===t}))throw new Error(f.format('invalid plural category "%s", allowed are =<n> and %s',t,e))},e}(),W=function(r){function t(e,t){var n=r.call(this,C.ICU_MESSAGE)||this;return n._parser=t,e&&n.parseICUMessage(e),n}return T(t,r),t.looksLikeICUMessage=function(e){return new t(null,null).looksLikeICUMessage(e)},t.prototype.asDisplayString=function(e){return"<ICU-Message/>"},t.prototype.getICUMessage=function(){return this._message},t.prototype.parseICUMessage=function(e){this._messageText=e,this._tokenizer=new D,this._tokenizer.input(e),this.expectNext(M),this.expectNext(U),this.expectNext(F);var t=this._tokenizer.next();for(t.type===O?this._message=new B(this._parser,!0):t.type===L&&(this._message=new B(this._parser,!1)),this.expectNext(F),t=this._tokenizer.peek();t.type!==I;){var n=this.expectNext(U).value.trim();this.expectNext(M);var r=this.expectNext(U).value;this._message.addCategory(n,this.parseNativeSubMessage(r)),this.expectNext(I),t=this._tokenizer.peek()}this.expectNext(I),this.expectNext("EOF")},t.prototype.looksLikeICUMessage=function(e){this._tokenizer=new D,this._tokenizer.input(e);try{this.expectNext(M),this.expectNext(U),this.expectNext(F);var t=this._tokenizer.next();return(t.type===O||t.type===L)&&(this.expectNext(F),!0)}catch(n){return!1}},t.prototype.expectNext=function(e){var t=this._tokenizer.next();if(t.type!==e)throw new Error(f.format("Error parsing ICU Message: expected %s, found %s (%s) (message %s)",e,t.type,t.value,this._messageText));return t},t.prototype.parseNativeSubMessage=function(e){return this._parser.createNormalizedMessageFromXMLString(e,null)},t}(A),z=function(r){function e(e,t){var n=r.call(this,C.ICU_MESSAGE_REF)||this;return n._index=e,n._disp=t,n}return T(e,r),e.prototype.asDisplayString=function(e){return"<ICU-Message-Ref_"+this._index+"/>"},e.prototype.index=function(){return this._index},e.prototype.disp=function(){return this._disp},e}(A),k=function(r){function e(e,t){var n=r.call(this,C.EMPTY_TAG)||this;return n._tagname=e,n._idcounter=t,n}return T(e,r),e.prototype.asDisplayString=function(e){return 0===this._idcounter?"<"+this._tagname+">":"<"+this._tagname+' id="'+this._idcounter.toString()+'">'},e.prototype.tagName=function(){return this._tagname},e.prototype.idCounter=function(){return this._idcounter},e}(A),G=function(){function e(e,t){this._parser=e,this.sourceMessage=t,this._parts=[]}return e.prototype.getParser=function(){return this._parser},e.prototype.translate=function(e){if(f.isNullOrUndefined(this.getICUMessage()))return this._parser.parseNormalizedString(e,this);throw new Error(f.format('cannot translate ICU message with simple string, use translateICUMessage() instead ("%s", "%s")',e,this.asNativeString()))},e.prototype.translateICUMessage=function(e){var t=this.getICUMessage();if(f.isNullOrUndefined(t))throw new Error(f.format('this is not an ICU message, use translate() instead ("%s", "%s")',e,this.asNativeString()));var n=t.translate(e);return this._parser.parseICUMessage(n.asNativeString(),this)},e.prototype.translateNativeString=function(e){return this._parser.createNormalizedMessageFromXMLString(e,this)},e.prototype.asDisplayString=function(t){return this._parts.map(function(e){return e.asDisplayString(t)}).join("")},e.prototype.asNativeString=function(){return f.isNullOrUndefined(this.getICUMessage())?y.getXMLContent(this._xmlRepresentation):this.getICUMessage().asNativeString()},e.prototype.validate=function(){var e,t=!1,n={};return e=this.checkPlaceholderAdded(),f.isNullOrUndefined(e)||(n.placeholderAdded=e,t=!0),e=this.checkICUMessageRefRemoved(),f.isNullOrUndefined(e)||(n.icuMessageRefRemoved=e,t=!0),e=this.checkICUMessageRefAdded(),f.isNullOrUndefined(e)||(n.icuMessageRefAdded=e,t=!0),t?n:null},e.prototype.validateWarnings=function(){var e,t=!1,n={};return e=this.checkPlaceholderRemoved(),f.isNullOrUndefined(e)||(n.placeholderRemoved=e,t=!0),e=this.checkTagRemoved(),f.isNullOrUndefined(e)||(n.tagRemoved=e,t=!0),e=this.checkTagAdded(),f.isNullOrUndefined(e)||(n.tagAdded=e,t=!0),t?n:null},e.prototype.getICUMessage=function(){return 1!==this._parts.length||this._parts[0].type!==C.ICU_MESSAGE?null:this._parts[0].getICUMessage()},e.prototype.checkPlaceholderAdded=function(){var e=null,t=[];if(this.sourceMessage){var n=this.sourceMessage.allPlaceholders();this.allPlaceholders().forEach(function(e){n.has(e)||t.push(e)})}if(1===t.length)e="added placeholder "+t[0]+", which is not in original message";else if(1<t.length){var r="",i=!0;t.forEach(function(e){i||(r+=", "),r+=e,i=!1}),e="added placeholders "+r+", which are not in original message"}return e},e.prototype.checkPlaceholderRemoved=function(){var e=null,t=[];if(this.sourceMessage){var n=this.sourceMessage.allPlaceholders(),r=this.allPlaceholders();n.forEach(function(e){r.has(e)||t.push(e)})}if(1===t.length)e="removed placeholder "+t[0]+" from original message";else if(1<t.length){var i="",a=!0;t.forEach(function(e){a||(i+=", "),i+=e,a=!1}),e="removed placeholders "+i+" from original message"}return e},e.prototype.checkICUMessageRefAdded=function(){var e=null,t=[];if(this.sourceMessage){var n=this.sourceMessage.allICUMessageRefs();this.allICUMessageRefs().forEach(function(e){n.has(e)||t.push(e)})}if(1===t.length)e="added ICU message reference "+t[0]+", which is not in original message";else if(1<t.length){var r="",i=!0;t.forEach(function(e){i||(r+=", "),r+=e,i=!1}),e="added ICU message references "+r+", which are not in original message"}return e},e.prototype.checkICUMessageRefRemoved=function(){var e=null,t=[];if(this.sourceMessage){var n=this.sourceMessage.allICUMessageRefs(),r=this.allICUMessageRefs();n.forEach(function(e){r.has(e)||t.push(e)})}if(1===t.length)e="removed ICU message reference "+t[0]+" from original message";else if(1<t.length){var i="",a=!0;t.forEach(function(e){a||(i+=", "),i+=e,a=!1}),e="removed ICU message references "+i+" from original message"}return e},e.prototype.allPlaceholders=function(){var n=new Set;return this.parts().forEach(function(e){if(e.type===C.PLACEHOLDER){var t=e.index();n.add(t)}}),n},e.prototype.getPlaceholderDisp=function(n){var r=null;return this.parts().forEach(function(e){if(e.type===C.PLACEHOLDER){var t=e;t.index()===n&&(r=t)}}),r?r.disp():null},e.prototype.allICUMessageRefs=function(){var n=new Set;return this.parts().forEach(function(e){if(e.type===C.ICU_MESSAGE_REF){var t=e.index();n.add(t)}}),n},e.prototype.getICUMessageRefDisp=function(n){var r=null;return this.parts().forEach(function(e){if(e.type===C.ICU_MESSAGE_REF){var t=e;t.index()===n&&(r=t)}}),r?r.disp():null},e.prototype.checkTagAdded=function(){var e=null,t=[];if(this.sourceMessage){var n=this.sourceMessage.allTags();this.allTags().forEach(function(e){n.has(e)||t.push(e)})}if(1===t.length)e="added tag <"+t[0]+">, which is not in original message";else if(1<t.length){var r="",i=!0;t.forEach(function(e){i||(r+=", "),r=r+"<"+e+">",i=!1}),e="added tags "+r+", which are not in original message"}return e},e.prototype.checkTagRemoved=function(){var e=null,t=[];if(this.sourceMessage){var n=this.sourceMessage.allTags(),r=this.allTags();n.forEach(function(e){r.has(e)||t.push(e)})}if(1===t.length)e="removed tag <"+t[0]+"> from original message";else if(1<t.length){var i="",a=!0;t.forEach(function(e){a||(i+=", "),i=i+"<"+e+">",a=!1}),e="removed tags "+i+" from original message"}return e},e.prototype.allTags=function(){var n=new Set;return this.parts().forEach(function(e){if(e.type===C.START_TAG||e.type===C.EMPTY_TAG){var t=e.tagName();n.add(t)}}),n},e.prototype.parts=function(){return this._parts},e.prototype.setXmlRepresentation=function(e){this._xmlRepresentation=e},e.prototype.addText=function(e){this._parts.push(new S(e))},e.prototype.addPlaceholder=function(e,t){this._parts.push(new b(e,t))},e.prototype.addStartTag=function(e,t){this._parts.push(new w(e,t))},e.prototype.addEndTag=function(e){var t=this.calculateOpenTagName();if(!t||t!==e)throw new Error(f.format('unexpected close tag %s (currently open is %s, native xml is "%s")',e,t,this.asNativeString()));this._parts.push(new x(e))},e.prototype.addEmptyTag=function(e,t){this._parts.push(new k(e,t))},e.prototype.addICUMessageRef=function(e,t){this._parts.push(new z(e,t))},e.prototype.addICUMessage=function(e){this._parts.push(new W(e,this._parser))},e.prototype.calculateOpenTagName=function(){var r=this,i=[];return this._parts.forEach(function(e){switch(e.type){case C.START_TAG:i.push(e.tagName());break;case C.END_TAG:var t=e.tagName();if(0===i.length||i[i.length-1]!==t){var n=0===i.length?"nothing":i[i.length-1];throw new Error(f.format('unexpected close tag %s (currently open is %s, native xml is "%s")',t,n,r.asNativeString()))}i.pop()}}),0===i.length?null:i[i.length-1]},e}(),H="TEXT",Y="START_TAG",q="END_TAG",j="EMPTY_TAG",V="PLACEHOLDER",Z="ICU_MESSAGE_REF",K="ICU_MESSAGE",Q=function(){function e(){}return e.prototype.getLexer=function(){var e=new n,r="";return e.before(function(e,t,n){n.name!==H&&""!==r&&(e.accept(H,{text:r}),r="")}),e.finish(function(e){""!==r&&e.accept(H,{text:r})}),e.rule(/<(br|hr|img|area|link|wbr)( id="([0-9])*")?\>/,function(e,t){var n=f.isNullOrUndefined(t[3])?0:parseInt(t[3],10);e.accept(j,{name:t[1],idcounter:n})},j),e.rule(/<([a-zA-Z][a-zA-Z-0-9]*)( id="([0-9]*)")?>/,function(e,t){var n=f.isNullOrUndefined(t[3])?0:parseInt(t[3],10);e.accept(Y,{name:t[1],idcounter:n})},Y),e.rule(/<\/([a-zA-Z][a-zA-Z-0-9]*)>/,function(e,t){e.accept(q,{name:t[1]})},q),e.rule(/{{([0-9]+)}}/,function(e,t){e.accept(V,{idcounter:parseInt(t[1],10)})},V),e.rule(/<ICU-Message-Ref_([0-9]+)\/>/,function(e,t){e.accept(Z,{idcounter:parseInt(t[1],10)})},Z),e.rule(/<ICU-Message\/>/,function(e,t){e.accept(K,{message:t[0]})},K),e.rule(/./,function(e,t){r+=t[0],e.ignore()},H),e.rule(/[\t\r\n]+/,function(e,t){r+=t[0],e.ignore()},H),e},e.prototype.tokenize=function(e){var t=this.getLexer();return t.reset(),t.input(e),t.tokens()},e}(),$=function(){function e(){}return e.prototype.createNormalizedMessageFromXML=function(e,t){var n=new G(this,t);return e&&(n.setXmlRepresentation(e),this.addPartsOfNodeToMessage(e,n,!1)),n},e.prototype.createNormalizedMessageFromXMLString=function(e,t){var n=(new a.DOMParser).parseFromString("<dummy>"+e+"</dummy>","text/xml").childNodes.item(0);return this.createNormalizedMessageFromXML(n,t)},e.prototype.addPartsOfNodeToMessage=function(e,t,n){var r=!0;if(n){if(e.nodeType===e.TEXT_NODE)return void t.addText(e.textContent);e.nodeType===e.ELEMENT_NODE&&(r=this.processStartElement(e,t))}if(r){var i=this.getICUMessageText(e),a=!f.isNullOrUndefined(i);if(a)try{t.addICUMessage(i)}catch(u){console.log("non ICU message: ",i,u),a=!1}if(!a)for(var o=e.childNodes,s=0;s<o.length;s++)this.addPartsOfNodeToMessage(o.item(s),t,!0)}e.nodeType===e.ELEMENT_NODE&&this.processEndElement(e,t)},e.prototype.getICUMessageText=function(e){var t=e.childNodes;if(0===t.length)return null;var n=t.item(0);return n.nodeType===n.TEXT_NODE&&this.isICUMessageStart(n.textContent)?y.getXMLContent(e):null},e.prototype.isICUMessageStart=function(e){return W.looksLikeICUMessage(e)},e.prototype.parseNormalizedString=function(n,r){var e,i=new G(this,r),a=[];try{e=(new Q).tokenize(n)}catch(t){throw new Error(f.format('unexpected error while parsing message: "%s" (parsed "%")',t.message,n))}if(e.forEach(function(e){var t=null;switch(e.type){case H:i.addText(e.value.text);break;case Y:i.addStartTag(e.value.name,e.value.idcounter),a.push(e.value.name);break;case q:if(i.addEndTag(e.value.name),0===a.length||a[a.length-1]!==e.value.name)throw new Error(f.format('unexpected close tag "%s" (parsed "%s")',e.value.name,n));a.pop();break;case j:i.addEmptyTag(e.value.name,e.value.idcounter);break;case V:t=r?r.getPlaceholderDisp(e.value.idcounter):null,i.addPlaceholder(e.value.idcounter,t);break;case Z:t=r?r.getICUMessageRefDisp(e.value.idcounter):null,i.addICUMessageRef(e.value.idcounter,t);break;case K:throw new Error(f.format('<ICUMessage/> not allowed here, use parseICUMessage instead (parsed "%")',n))}}),0<a.length)throw new Error(f.format('missing close tag "%s" (parsed "%s")',a[a.length-1],n));return i.setXmlRepresentation(this.createXmlRepresentation(i)),i},e.prototype.parseICUMessage=function(e,t){var n=new G(this,t);return n.addICUMessage(e),n},e.prototype.parseIdCountFromName=function(e){var t=/.*_([0-9]*)/.exec(e);if(f.isNullOrUndefined(t)||""===t[1])return 0;var n=t[1];return parseInt(n,10)},e.prototype.createXmlRepresentation=function(e){var t=(new a.DOMParser).parseFromString("<dummy/>","text/xml").getElementsByTagName("dummy").item(0);return this.addXmlRepresentationToRoot(e,t),t},e.prototype.createXmlRepresentationOfTextPart=function(e,t){return t.ownerDocument.createTextNode(e.asDisplayString())},e}(),J={A:"LINK",B:"BOLD_TEXT",BR:"LINE_BREAK",EM:"EMPHASISED_TEXT",H1:"HEADING_LEVEL1",H2:"HEADING_LEVEL2",H3:"HEADING_LEVEL3",H4:"HEADING_LEVEL4",H5:"HEADING_LEVEL5",H6:"HEADING_LEVEL6",HR:"HORIZONTAL_RULE",I:"ITALIC_TEXT",LI:"LIST_ITEM",LINK:"MEDIA_LINK",OL:"ORDERED_LIST",P:"PARAGRAPH",Q:"QUOTATION",S:"STRIKETHROUGH_TEXT",SMALL:"SMALL_TEXT",SUB:"SUBSTRIPT",SUP:"SUPERSCRIPT",TBODY:"TABLE_BODY",TD:"TABLE_CELL",TFOOT:"TABLE_FOOTER",TH:"TABLE_HEADER_CELL",THEAD:"TABLE_HEADER",TR:"TABLE_ROW",TT:"MONOSPACED_TEXT",U:"UNDERLINED_TEXT",UL:"UNORDERED_LIST"},ee=["BR","HR","IMG","AREA","LINK","WBR"],te=function(){function e(){}return e.prototype.getStartTagPlaceholderName=function(e,t){var n=e.toUpperCase();return"START_"+(J[n]||"TAG_"+n)+this.counterString(t)},e.prototype.getCloseTagPlaceholderName=function(e){var t=e.toUpperCase();return"CLOSE_"+(J[t]||"TAG_"+t)},e.prototype.getEmptyTagPlaceholderName=function(e,t){var n=e.toUpperCase();return(J[n]||"TAG_"+n)+this.counterString(t)},e.prototype.getCtypeForTag=function(e){switch(e.toLowerCase()){case"br":return"lb";case"img":return"image";default:return"x-"+e}},e.prototype.getTagnameFromStartTagPlaceholderName=function(e){if(e.startsWith("START_TAG_"))return this.stripCounter(e.substring("START_TAG_".length)).toLowerCase();if(e.startsWith("START_")){var t=this.stripCounter(e.substring("START_".length)),n=Object.keys(J).find(function(e){return J[e]===t});return n?n.toLowerCase():null}return null},e.prototype.getTagnameFromCloseTagPlaceholderName=function(e){if(e.startsWith("CLOSE_TAG_"))return this.stripCounter(e.substring("CLOSE_TAG_".length)).toLowerCase();if(e.startsWith("CLOSE_")){var t=this.stripCounter(e.substring("CLOSE_".length)),n=Object.keys(J).find(function(e){return J[e]===t});return n?n.toLowerCase():null}return null},e.prototype.isEmptyTagPlaceholderName=function(e){var t,n=this.stripCounter(e);return!!((t=n.startsWith("TAG_")?n.substring(4).toUpperCase():Object.keys(J).find(function(e){return J[e]===n}))&&0<=ee.indexOf(t))},e.prototype.getTagnameFromEmptyTagPlaceholderName=function(e){var t,n=this.stripCounter(e);return(t=n.startsWith("TAG_")?n.substring(4).toUpperCase():Object.keys(J).find(function(e){return J[e]===n}))&&0<=ee.indexOf(t)?t.toLowerCase():null},e.prototype.stripCounter=function(e){if(e){var t=/(.*)_[0-9]+$/;if(e.match(t))return e.replace(t,"$1")}return e},e.prototype.counterString=function(e){return 0===e?"":"_"+e.toString(10)},e}(),ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return T(t,e),t.prototype.processStartElement=function(e,t){var n=e.tagName,r=new te;if("x"===n){var i=e.getAttribute("id");if(!i)return;if(i.startsWith("INTERPOLATION")){var a=this.parsePlaceholderIndexFromId(i);t.addPlaceholder(a,null)}else if(i.startsWith("ICU")){a=this.parseICUMessageRefIndexFromId(i);t.addICUMessageRef(a,null)}else if(i.startsWith("START_")){if(s=r.getTagnameFromStartTagPlaceholderName(i)){var o=this.parseIdCountFromName(i);t.addStartTag(s,o)}}else if(i.startsWith("CLOSE_")){(s=r.getTagnameFromCloseTagPlaceholderName(i))&&t.addEndTag(s)}else if(r.isEmptyTagPlaceholderName(i)){var s;if(s=r.getTagnameFromEmptyTagPlaceholderName(i)){o=this.parseIdCountFromName(i);t.addEmptyTag(s,o)}}}return!0},t.prototype.processEndElement=function(e,t){},t.prototype.parsePlaceholderIndexFromId=function(e){var t="";return t="INTERPOLATION"===e?"0":e.substring("INTERPOLATION_".length),Number.parseInt(t,10)},t.prototype.parseICUMessageRefIndexFromId=function(e){var t="";return t="ICU"===e?"0":e.substring("ICU_".length),Number.parseInt(t,10)},t.prototype.addXmlRepresentationToRoot=function(e,n){var r=this;e.parts().forEach(function(e){var t;switch(e.type){case C.TEXT:t=r.createXmlRepresentationOfTextPart(e,n);break;case C.START_TAG:t=r.createXmlRepresentationOfStartTagPart(e,n);break;case C.END_TAG:t=r.createXmlRepresentationOfEndTagPart(e,n);break;case C.EMPTY_TAG:t=r.createXmlRepresentationOfEmptyTagPart(e,n);break;case C.PLACEHOLDER:t=r.createXmlRepresentationOfPlaceholderPart(e,n);break;case C.ICU_MESSAGE_REF:t=r.createXmlRepresentationOfICUMessageRefPart(e,n)}t&&n.appendChild(t)})},t.prototype.createXmlRepresentationOfStartTagPart=function(e,t){var n=t.ownerDocument.createElement("x"),r=new te,i=r.getStartTagPlaceholderName(e.tagName(),e.idCounter()),a=r.getCtypeForTag(e.tagName()),o="<"+e.tagName()+">";return n.setAttribute("id",i),n.setAttribute("ctype",a),n.setAttribute("equiv-text",o),n},t.prototype.createXmlRepresentationOfEndTagPart=function(e,t){var n=t.ownerDocument.createElement("x"),r=(new te).getCloseTagPlaceholderName(e.tagName()),i="x-"+e.tagName();return n.setAttribute("id",r),n.setAttribute("ctype",i),n},t.prototype.createXmlRepresentationOfEmptyTagPart=function(e,t){var n=t.ownerDocument.createElement("x"),r=new te,i=r.getEmptyTagPlaceholderName(e.tagName(),e.idCounter()),a=r.getCtypeForTag(e.tagName()),o="<"+e.tagName()+"/>";return n.setAttribute("id",i),n.setAttribute("ctype",a),n.setAttribute("equiv-text",o),n},t.prototype.createXmlRepresentationOfPlaceholderPart=function(e,t){var n=t.ownerDocument.createElement("x"),r="INTERPOLATION";0<e.index()&&(r="INTERPOLATION_"+e.index().toString(10));var i=e.disp();return n.setAttribute("id",r),i&&n.setAttribute("equiv-text",i),n},t.prototype.createXmlRepresentationOfICUMessageRefPart=function(e,t){var n=t.ownerDocument.createElement("x"),r="ICU";return 0<e.index()&&(r="ICU_"+e.index().toString(10)),n.setAttribute("id",r),n},t}($),re=function(r){function i(e,t,n){return r.call(this,e,t,n)||this}return T(i,r),i.prototype.sourceContent=function(){var e=y.getFirstElementByTagName(this._element,"source");return y.getXMLContent(e)},i.prototype.setSourceContent=function(e){var t=y.getFirstElementByTagName(this._element,"source");t||(t=this._element.appendChild(this._element.ownerDocument.createElement("source"))),y.replaceContentWithXMLContent(t,e)},i.prototype.messageParser=function(){return new ne},i.prototype.createSourceContentNormalized=function(){var e=y.getFirstElementByTagName(this._element,"source");return e?this.messageParser().createNormalizedMessageFromXML(e,null):null},i.prototype.targetContent=function(){var e=y.getFirstElementByTagName(this._element,"target");return y.getXMLContent(e)},i.prototype.targetContentNormalized=function(){var e=y.getFirstElementByTagName(this._element,"target");return(new ne).createNormalizedMessageFromXML(e,this.sourceContentNormalized())},i.prototype.nativeTargetState=function(){var e=y.getFirstElementByTagName(this._element,"target");return e?e.getAttribute("state"):null},i.prototype.setNativeTargetState=function(e){var t=y.getFirstElementByTagName(this._element,"target");t&&t.setAttribute("state",e)},i.prototype.mapStateToNativeState=function(e){switch(e){case u:return"new";case l:return"translated";case g:return"final";default:throw new Error("unknown state "+e)}},i.prototype.mapNativeStateToState=function(e){switch(e){case"new":case"needs-translation":return u;case"translated":case"needs-adaptation":case"needs-l10n":case"needs-review-adaptation":case"needs-review-l10n":case"needs-review-translation":return l;case"final":case"signed-off":return g;default:return u}},i.prototype.sourceReferences=function(){for(var e=this._element.getElementsByTagName("context-group"),t=[],n=0;n<e.length;n++){var r=e.item(n);if("location"===r.getAttribute("purpose")){for(var i=r.getElementsByTagName("context"),a=null,o=0,s=0;s<i.length;s++){var u=i.item(s);"sourcefile"===u.getAttribute("context-type")&&(a=y.getPCDATA(u)),"linenumber"===u.getAttribute("context-type")&&(o=Number.parseInt(y.getPCDATA(u),10))}t.push({sourcefile:a,linenumber:o})}}return t},i.prototype.setSourceReferences=function(e){var i=this;this.removeAllSourceReferences(),e.forEach(function(e){var t=i._element.ownerDocument.createElement("context-group");t.setAttribute("purpose","location");var n=i._element.ownerDocument.createElement("context");n.setAttribute("context-type","sourcefile"),n.appendChild(i._element.ownerDocument.createTextNode(e.sourcefile));var r=i._element.ownerDocument.createElement("context");r.setAttribute("context-type","linenumber"),r.appendChild(i._element.ownerDocument.createTextNode(e.linenumber.toString(10))),t.appendChild(n),t.appendChild(r),i._element.appendChild(t)})},i.prototype.removeAllSourceReferences=function(){for(var e=this._element.getElementsByTagName("context-group"),t=[],n=0;n<e.length;n++){var r=e.item(n);"location"===r.getAttribute("purpose")&&t.push(r)}t.forEach(function(e){e.parentNode.removeChild(e)})},i.prototype.description=function(){var e=this.findNoteElementWithFromAttribute("description");return e?y.getPCDATA(e):null},i.prototype.setDescription=function(e){var t=this.findNoteElementWithFromAttribute("description");e?f.isNullOrUndefined(t)?t=this.createNoteElementWithFromAttribute("description",e):y.replaceContentWithXMLContent(t,e):f.isNullOrUndefined(t)||this.removeNoteElementWithFromAttribute("description")},i.prototype.findNoteElementWithFromAttribute=function(e){for(var t=this._element.getElementsByTagName("note"),n=0;n<t.length;n++){var r=t.item(n);if(r.getAttribute("from")===e)return r}return null},i.prototype.findAllAdditionalNoteElements=function(){for(var e=this._element.getElementsByTagName("note"),t=[],n=0;n<e.length;n++){var r=e.item(n),i=r.getAttribute("from");"description"!==i&&"meaning"!==i&&t.push(r)}return t},i.prototype.createNoteElementWithFromAttribute=function(e,t){var n=this._element.ownerDocument.createElement("note");return e&&n.setAttribute("from",e),n.setAttribute("priority","1"),t&&y.replaceContentWithXMLContent(n,t),this._element.appendChild(n),n},i.prototype.removeNoteElementWithFromAttribute=function(e){var t=this.findNoteElementWithFromAttribute(e);t&&this._element.removeChild(t)},i.prototype.removeAllAdditionalNoteElements=function(){var t=this;this.findAllAdditionalNoteElements().forEach(function(e){t._element.removeChild(e)})},i.prototype.meaning=function(){var e=this.findNoteElementWithFromAttribute("meaning");return e?y.getPCDATA(e):null},i.prototype.setMeaning=function(e){var t=this.findNoteElementWithFromAttribute("meaning");e?f.isNullOrUndefined(t)?t=this.createNoteElementWithFromAttribute("meaning",e):y.replaceContentWithXMLContent(t,e):f.isNullOrUndefined(t)||this.removeNoteElementWithFromAttribute("meaning")},i.prototype.notes=function(){return this.findAllAdditionalNoteElements().map(function(e){return{from:e.getAttribute("from"),text:y.getPCDATA(e)}})},i.prototype.supportsSetNotes=function(){return!0},i.prototype.setNotes=function(e){var t=this;f.isNullOrUndefined(e)||this.checkNotes(e),this.removeAllAdditionalNoteElements(),f.isNullOrUndefined(e)||e.forEach(function(e){t.createNoteElementWithFromAttribute(e.from,e.text)})},i.prototype.translateNative=function(e){var t=y.getFirstElementByTagName(this._element,"target");if(!t){var n=y.getFirstElementByTagName(this._element,"source");t=y.createFollowingSibling("target",n)}y.replaceContentWithXMLContent(t,e),this.setTargetState(l)},i.prototype.cloneWithSourceAsTarget=function(e,t,n){var r=new i(this._element.cloneNode(!0),this._id,n);return r.useSourceAsTarget(e,t),r},i.prototype.useSourceAsTarget=function(e,t){var n=y.getFirstElementByTagName(this._element,"source"),r=y.getFirstElementByTagName(this._element,"target");if(r||(r=y.createFollowingSibling("target",n)),e||t){var i=y.getXMLContent(n),a=i;this.isICUMessage(i)||(a=this.translationMessagesFile().getNewTransUnitTargetPraefix()+i+this.translationMessagesFile().getNewTransUnitTargetSuffix()),y.replaceContentWithXMLContent(r,a)}else y.replaceContentWithXMLContent(r,"");e?r.setAttribute("state",this.mapStateToNativeState(g)):r.setAttribute("state",this.mapStateToNativeState(u))},i}(_),ie=function(i){function a(e,t,n){var r=i.call(this)||this;return r._warnings=[],r._numberOfTransUnitsWithMissingId=0,r.initializeFromContent(e,t,n),r}return T(a,i),a.prototype.initializeFromContent=function(e,t,n){this.parseContent(e,t,n);var r=this._parsedDocument.getElementsByTagName("xliff");if(1!==r.length)throw new Error(f.format('File "%s" seems to be no xliff file (should contain an xliff element)',t));var i=r.item(0).getAttribute("version");if("1.2"!==i)throw new Error(f.format('File "%s" seems to be no xliff 1.2 file, version should be %s, found %s',t,"1.2",i));return this},a.prototype.i18nFormat=function(){return p},a.prototype.fileType=function(){return o},a.prototype.elementsWithMixedContent=function(){return["source","target","tool","seg-source","g","ph","bpt","ept","it","sub","mrk"]},a.prototype.initializeTransUnits=function(){this.transUnits=[];for(var e=this._parsedDocument.getElementsByTagName("trans-unit"),t=0;t<e.length;t++){var n=e.item(t),r=n.getAttribute("id");r||this._warnings.push(f.format('oops, trans-unit without "id" found in master, please check file %s',this._filename)),this.transUnits.push(new re(n,r,this))}},a.prototype.sourceLanguage=function(){var e=y.getFirstElementByTagName(this._parsedDocument,"file");return e?e.getAttribute("source-language"):null},a.prototype.setSourceLanguage=function(e){var t=y.getFirstElementByTagName(this._parsedDocument,"file");t&&t.setAttribute("source-language",e)},a.prototype.targetLanguage=function(){var e=y.getFirstElementByTagName(this._parsedDocument,"file");return e?e.getAttribute("target-language"):null},a.prototype.setTargetLanguage=function(e){var t=y.getFirstElementByTagName(this._parsedDocument,"file");t&&t.setAttribute("target-language",e)},a.prototype.importNewTransUnit=function(e,t,n,r){if(this.transUnitWithId(e.id))throw new Error(f.format("tu with id %s already exists in file, cannot import it",e.id));var i=e.cloneWithSourceAsTarget(t,n,this),a=y.getFirstElementByTagName(this._parsedDocument,"body");if(!a)throw new Error(f.format('File "%s" seems to be no xliff 1.2 file (should contain a body element)',this._filename));var o=!1,s=!1;r&&(this.transUnitWithId(r.id)&&(s=!0));if(r===undefined||r&&!s)a.appendChild(i.asXmlElement()),o=!0;else if(null===r){var u=y.getFirstElementByTagName(this._parsedDocument,"trans-unit");o=(u?y.insertBefore(i.asXmlElement(),u):a.appendChild(i.asXmlElement()),!0)}else{var l=y.getElementByTagNameAndId(this._parsedDocument,"trans-unit",r.id);l&&(y.insertAfter(i.asXmlElement(),l),o=!0)}return o?(this.lazyInitializeTransUnits(),this.transUnits.push(i),this.countNumbers(),i):null},a.prototype.createTranslationFileForLang=function(e,t,n,r){var i=new a(this.editedContent(),t,this.encoding());return i.setNewTransUnitTargetPraefix(this.targetPraefix),i.setNewTransUnitTargetSuffix(this.targetSuffix),i.setTargetLanguage(e),i.forEachTransUnit(function(e){e.useSourceAsTarget(n,r)}),i},a}(v),ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return T(t,e),t.prototype.processStartElement=function(e,t){var n=e.tagName;if("ph"===n){var r=e.getAttribute("name");if(!r)return!0;if(r.startsWith("INTERPOLATION")){var i=this.parsePlaceholderIndexFromName(r);return t.addPlaceholder(i,null),!1}if(r.startsWith("START_")){var a=this.parseTagnameFromPhElement(e),o=this.parseIdCountFromName(r);return a&&t.addStartTag(a,o),!1}if(r.startsWith("CLOSE_"))return(a=this.parseTagnameFromPhElement(e))&&t.addEndTag(a),!1;if((new te).isEmptyTagPlaceholderName(r)){var s=(new te).getTagnameFromEmptyTagPlaceholderName(r);o=this.parseIdCountFromName(r);return t.addEmptyTag(s,o),!1}if(r.startsWith("ICU")){i=this.parseICUMessageIndexFromName(r);return t.addICUMessageRef(i,null),!1}}else if("source"===n)return!1;return!0},t.prototype.getICUMessageText=function(e){var t=e.childNodes;if(0===t.length)return null;var n,r=null;for(n=0;n<t.length;n++){var i=t.item(n);if(i.nodeType!==i.ELEMENT_NODE||"source"!==i.tagName){r=i;break}}if(r&&r.nodeType===r.TEXT_NODE){if(this.isICUMessageStart(r.textContent)){var a=y.getXMLContent(e);if(0<n){var o=new RegExp("<source[^>]*>.*</source>","g");return a.replace(o,"")}return a}return null}return null},t.prototype.processEndElement=function(e,t){},t.prototype.parsePlaceholderIndexFromName=function(e){var t="";return t="INTERPOLATION"===e?"0":e.substring("INTERPOLATION_".length),Number.parseInt(t,10)},t.prototype.parseICUMessageIndexFromName=function(e){var t="";return t="ICU"===e?"0":e.substring("ICU_".length),Number.parseInt(t,10)},t.prototype.parseTagnameFromPhElement=function(e){var t=y.getFirstElementByTagName(e,"ex");if(t){var n=y.getPCDATA(t);return n&&n.startsWith("<")&&n.endsWith(">")?"/"===n.charAt(1)?n.substring(2,n.length-1):n.substring(1,n.length-1):null}return null},t.prototype.addXmlRepresentationToRoot=function(e,n){var r=this;e.parts().forEach(function(e){var t=r.createXmlRepresentationOfPart(e,n);t&&n.appendChild(t)})},t.prototype.createXmlRepresentationOfPart=function(e,t){switch(e.type){case C.TEXT:return this.createXmlRepresentationOfTextPart(e,t);case C.START_TAG:return this.createXmlRepresentationOfStartTagPart(e,t);case C.END_TAG:return this.createXmlRepresentationOfEndTagPart(e,t);case C.EMPTY_TAG:return this.createXmlRepresentationOfEmptyTagPart(e,t);case C.PLACEHOLDER:return this.createXmlRepresentationOfPlaceholderPart(e,t);case C.ICU_MESSAGE_REF:return this.createXmlRepresentationOfICUMessageRefPart(e,t)}},t.prototype.createXmlRepresentationOfStartTagPart=function(e,t){var n=t.ownerDocument.createElement("ph"),r=(new te).getStartTagPlaceholderName(e.tagName(),e.idCounter());n.setAttribute("name",r);var i=t.ownerDocument.createElement("ex");return i.appendChild(t.ownerDocument.createTextNode("<"+e.tagName()+">")),n.appendChild(i),n},t.prototype.createXmlRepresentationOfEndTagPart=function(e,t){var n=t.ownerDocument.createElement("ph"),r=(new te).getCloseTagPlaceholderName(e.tagName());n.setAttribute("name",r);var i=t.ownerDocument.createElement("ex");return i.appendChild(t.ownerDocument.createTextNode("</"+e.tagName()+">")),n.appendChild(i),n},t.prototype.createXmlRepresentationOfEmptyTagPart=function(e,t){var n=t.ownerDocument.createElement("ph"),r=(new te).getEmptyTagPlaceholderName(e.tagName(),e.idCounter());n.setAttribute("name",r);var i=t.ownerDocument.createElement("ex");return i.appendChild(t.ownerDocument.createTextNode("<"+e.tagName()+">")),n.appendChild(i),n},t.prototype.createXmlRepresentationOfPlaceholderPart=function(e,t){var n=t.ownerDocument.createElement("ph"),r="INTERPOLATION";0<e.index()&&(r="INTERPOLATION_"+e.index().toString(10)),n.setAttribute("name",r);var i=t.ownerDocument.createElement("ex");return i.appendChild(t.ownerDocument.createTextNode(r)),n.appendChild(i),n},t.prototype.createXmlRepresentationOfICUMessageRefPart=function(e,t){var n=t.ownerDocument.createElement("ph"),r="ICU";0<e.index()&&(r="ICU_"+e.index().toString(10)),n.setAttribute("name",r);var i=t.ownerDocument.createElement("ex");return i.appendChild(t.ownerDocument.createTextNode(r)),n.appendChild(i),n},t}($),oe=function(r){function a(e,t,n){return r.call(this,e,t,n)||this}return T(a,r),a.parseSourceAndPos=function(e){var t=e.lastIndexOf(":");return t<0?{sourcefile:e,linenumber:0}:{sourcefile:e.substring(0,t),linenumber:a.parseLineNumber(e.substring(t+1))}},a.parseLineNumber=function(e){return Number.parseInt(e,10)},a.prototype.sourceContent=function(){var e=y.getXMLContent(this._element);return e=e.replace(/<source>.*<\/source>/g,"")},a.prototype.supportsSetSourceContent=function(){return!1},a.prototype.setSourceContent=function(e){},a.prototype.messageParser=function(){return new ae},a.prototype.createSourceContentNormalized=function(){return this.messageParser().createNormalizedMessageFromXML(this._element,null)},a.prototype.targetContent=function(){return this.sourceContent()},a.prototype.targetContentNormalized=function(){return(new ae).createNormalizedMessageFromXML(this._element,this.sourceContentNormalized())},a.prototype.nativeTargetState=function(){return null},a.prototype.mapStateToNativeState=function(e){return e},a.prototype.mapNativeStateToState=function(e){return e},a.prototype.setNativeTargetState=function(e){},a.prototype.sourceReferences=function(){for(var e=this._element.getElementsByTagName("source"),t=[],n=0;n<e.length;n++){var r=e.item(n),i=y.getPCDATA(r);t.push(a.parseSourceAndPos(i))}return t},a.prototype.setSourceReferences=function(e){this.removeAllSourceReferences();for(var t=this._element.childNodes.item(0),n=e.length-1;0<=n;n--){var r=e[n],i=this._element.ownerDocument.createElement("source");i.appendChild(this._element.ownerDocument.createTextNode(r.sourcefile+":"+r.linenumber.toString(10))),this._element.insertBefore(i,t),t=i}},a.prototype.removeAllSourceReferences=function(){for(var e=this._element.getElementsByTagName("source"),t=[],n=0;n<e.length;n++){var r=e.item(n);t.push(r)}t.forEach(function(e){e.parentNode.removeChild(e)})},a.prototype.description=function(){return this._element.getAttribute("desc")},a.prototype.meaning=function(){return this._element.getAttribute("meaning")},a.prototype.supportsSetDescriptionAndMeaning=function(){return!1},a.prototype.setDescription=function(e){},a.prototype.setMeaning=function(e){},a.prototype.notes=function(){return[]},a.prototype.supportsSetNotes=function(){return!1},a.prototype.setNotes=function(e){},a.prototype.cloneWithSourceAsTarget=function(e,t,n){return this},a.prototype.useSourceAsTarget=function(e,t){},a.prototype.translateNative=function(e){throw new Error("You cannot translate xmb files, use xtb instead.")},a}(_),se=function(a){function e(e,t,n,r){var i=a.call(this)||this;return i._translationMessageFileFactory=e,i._warnings=[],i._numberOfTransUnitsWithMissingId=0,i.initializeFromContent(t,n,r),i}return T(e,a),e.prototype.initializeFromContent=function(e,t,n){if(this.parseContent(e,t,n),1!==this._parsedDocument.getElementsByTagName("messagebundle").length)throw new Error(f.format('File "%s" seems to be no xmb file (should contain a messagebundle element)',t));return this},e.prototype.initializeTransUnits=function(){this.transUnits=[];for(var e=this._parsedDocument.getElementsByTagName("msg"),t=0;t<e.length;t++){var n=e.item(t),r=n.getAttribute("id");r||this._warnings.push(f.format('oops, msg without "id" found in master, please check file %s',this._filename)),this.transUnits.push(new oe(n,r,this))}},e.prototype.i18nFormat=function(){return m},e.prototype.fileType=function(){return"XMB"},e.prototype.elementsWithMixedContent=function(){return["message"]},e.prototype.guessLanguageFromFilename=function(){if(this._filename){var e=this._filename.split(".");if(2<e.length&&"xmb"===e[e.length-1].toLowerCase())return e[e.length-2]}return null},e.prototype.sourceLanguage=function(){return this.guessLanguageFromFilename()},e.prototype.setSourceLanguage=function(e){},e.prototype.targetLanguage=function(){return this.guessLanguageFromFilename()},e.prototype.setTargetLanguage=function(e){},e.prototype.importNewTransUnit=function(e,t,n,r){throw Error("xmb file cannot be used to store translations, use xtb file")},e.prototype.createTranslationFileForLang=function(e,t,n,r){var i=this._translationMessageFileFactory.createFileFromFileContent(h,'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE translationbundle [\n  <!ELEMENT translationbundle (translation)*>\n  <!ATTLIST translationbundle lang CDATA #REQUIRED>\n  <!ELEMENT translation (#PCDATA|ph)*>\n  <!ATTLIST translation id CDATA #REQUIRED>\n  <!ELEMENT ph EMPTY>\n  <!ATTLIST ph name CDATA #REQUIRED>\n]>\n<translationbundle>\n</translationbundle>\n',t,this.encoding(),{xmlContent:this.editedContent(),path:this.filename(),encoding:this.encoding()});return i.setNewTransUnitTargetPraefix(this.targetPraefix),i.setNewTransUnitTargetSuffix(this.targetSuffix),i.setTargetLanguage(e),i.setNewTransUnitTargetPraefix(this.getNewTransUnitTargetPraefix()),i.setNewTransUnitTargetSuffix(this.getNewTransUnitTargetSuffix()),this.forEachTransUnit(function(e){i.importNewTransUnit(e,n,r)}),i},e}(v),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return T(t,e),t.prototype.processStartElement=function(e,t){var n=e.tagName;if("ph"===n){var r=!1,i=!1,a=!1,o=e.getAttribute("equiv"),s=e.getAttribute("disp"),u=null,l=0,p=null;if(o)if(o.startsWith("ICU"))i=!0,u="ICU"===o?"0":o.substring("ICU_".length),l=Number.parseInt(u,10);else if(o.startsWith("INTERPOLATION"))r=!0,u="INTERPOLATION"===o?"0":o.substring("INTERPOLATION_".length),l=Number.parseInt(u,10);else{if(!(new te).isEmptyTagPlaceholderName(o))return!0;a=!0,p=(new te).getTagnameFromEmptyTagPlaceholderName(o)}else i=!0,u=e.getAttribute("id"),l=Number.parseInt(u,10);r?t.addPlaceholder(l,s):i?t.addICUMessageRef(l,s):a&&t.addEmptyTag(p,this.parseIdCountFromName(o))}else if("pc"===n){var c=this.tagNameFromPCElement(e);c&&t.addStartTag(c,this.parseIdCountFromName(e.getAttribute("equivStart")))}return!0},t.prototype.processEndElement=function(e,t){if("pc"!==e.tagName);else{var n=this.tagNameFromPCElement(e);n&&t.addEndTag(n)}},t.prototype.tagNameFromPCElement=function(e){var t=e.getAttribute("dispStart");return t.startsWith("<")&&(t=t.substring(1)),t.endsWith(">")&&(t=t.substring(0,t.length-1)),t},t.prototype.addXmlRepresentationToRoot=function(e,i){var a=this,o=[{element:i,tagName:"root"}],s=0;if(e.parts().forEach(function(e){switch(e.type){case C.TEXT:o[o.length-1].element.appendChild(a.createXmlRepresentationOfTextPart(e,i));break;case C.PLACEHOLDER:o[o.length-1].element.appendChild(a.createXmlRepresentationOfPlaceholderPart(e,i,s++));break;case C.ICU_MESSAGE_REF:o[o.length-1].element.appendChild(a.createXmlRepresentationOfICUMessageRefPart(e,i));break;case C.START_TAG:var t=a.createXmlRepresentationOfStartTagPart(e,i,s++);o[o.length-1].element.appendChild(t),o.push({element:t,tagName:e.tagName()});break;case C.END_TAG:var n=e.tagName();if(o.length<=1||o[o.length-1].tagName!==n)throw new Error("unexpected close tag "+n);o.pop();break;case C.EMPTY_TAG:var r=a.createXmlRepresentationOfEmptyTagPart(e,i,s++);o[o.length-1].element.appendChild(r)}}),1!==o.length)throw new Error("missing close tag "+o[o.length-1].tagName)},t.prototype.createXmlRepresentationOfStartTagPart=function(e,t,n){var r=new te,i=t.ownerDocument.createElement("pc"),a=e.tagName(),o=r.getStartTagPlaceholderName(a,e.idCounter()),s=r.getCloseTagPlaceholderName(a),u="<"+a+">",l="</"+a+">";return i.setAttribute("id",n.toString(10)),i.setAttribute("equivStart",o),i.setAttribute("equivEnd",s),i.setAttribute("type",this.getTypeForTag(a)),i.setAttribute("dispStart",u),i.setAttribute("dispEnd",l),i},t.prototype.createXmlRepresentationOfEndTagPart=function(e,t){return null},t.prototype.createXmlRepresentationOfEmptyTagPart=function(e,t,n){var r=new te,i=t.ownerDocument.createElement("ph"),a=e.tagName(),o=r.getEmptyTagPlaceholderName(a,e.idCounter()),s="<"+a+"/>";return i.setAttribute("id",n.toString(10)),i.setAttribute("equiv",o),i.setAttribute("type",this.getTypeForTag(a)),i.setAttribute("disp",s),i},t.prototype.getTypeForTag=function(e){switch(e.toLowerCase()){case"br":case"b":case"i":case"u":return"fmt";case"img":return"image";case"a":return"link";default:return"other"}},t.prototype.createXmlRepresentationOfPlaceholderPart=function(e,t,n){var r=t.ownerDocument.createElement("ph"),i="INTERPOLATION";0<e.index()&&(i="INTERPOLATION_"+e.index().toString(10)),r.setAttribute("id",n.toString(10)),r.setAttribute("equiv",i);var a=e.disp();return a&&r.setAttribute("disp",a),r},t.prototype.createXmlRepresentationOfICUMessageRefPart=function(e,t){var n=t.ownerDocument.createElement("ph"),r="ICU";0<e.index()&&(r="ICU_"+e.index().toString(10)),n.setAttribute("id",e.index().toString(10)),n.setAttribute("equiv",r);var i=e.disp();return i&&n.setAttribute("disp",i),n},t}($),le=function(r){function i(e,t,n){return r.call(this,e,t,n)||this}return T(i,r),i.prototype.sourceContent=function(){var e=y.getFirstElementByTagName(this._element,"source");return y.getXMLContent(e)},i.prototype.setSourceContent=function(e){var t=y.getFirstElementByTagName(this._element,"source");t||(t=y.getFirstElementByTagName(this._element,"segment").parentNode.appendChild(this._element.ownerDocument.createElement("source")));y.replaceContentWithXMLContent(t,e)},i.prototype.messageParser=function(){return new ue},i.prototype.createSourceContentNormalized=function(){var e=y.getFirstElementByTagName(this._element,"source");return e?this.messageParser().createNormalizedMessageFromXML(e,null):null},i.prototype.targetContent=function(){var e=y.getFirstElementByTagName(this._element,"target");return y.getXMLContent(e)},i.prototype.targetContentNormalized=function(){var e=y.getFirstElementByTagName(this._element,"target");return(new ue).createNormalizedMessageFromXML(e,this.sourceContentNormalized())},i.prototype.nativeTargetState=function(){var e=y.getFirstElementByTagName(this._element,"segment");return e?e.getAttribute("state"):null},i.prototype.setNativeTargetState=function(e){var t=y.getFirstElementByTagName(this._element,"segment");t&&t.setAttribute("state",e)},i.prototype.mapStateToNativeState=function(e){switch(e){case u:return"initial";case l:return"translated";case g:return"final";default:throw new Error("unknown state "+e)}},i.prototype.mapNativeStateToState=function(e){switch(e){case"initial":return u;case"translated":case"reviewed":return l;case"final":return g;default:return u}},i.prototype.sourceReferences=function(){for(var e=this._element.getElementsByTagName("note"),t=[],n=0;n<e.length;n++){var r=e.item(n);if("location"===r.getAttribute("category")){var i=y.getPCDATA(r);t.push(this.parseSourceAndPos(i))}}return t},i.prototype.parseSourceAndPos=function(e){var t=e.lastIndexOf(":");return t<0?{sourcefile:e,linenumber:0}:{sourcefile:e.substring(0,t),linenumber:this.parseLineNumber(e.substring(t+1))}},i.prototype.parseLineNumber=function(e){return Number.parseInt(e,10)},i.prototype.setSourceReferences=function(e){var n=this;this.removeAllSourceReferences();var r=y.getFirstElementByTagName(this._element,"notes");0!==e.length||f.isNullOrUndefined(r)||0!==r.childNodes.length?(f.isNullOrUndefined(r)&&(r=this._element.ownerDocument.createElement("notes"),this._element.insertBefore(r,this._element.childNodes.item(0))),e.forEach(function(e){var t=n._element.ownerDocument.createElement("note");t.setAttribute("category","location"),t.appendChild(n._element.ownerDocument.createTextNode(e.sourcefile+":"+e.linenumber.toString(10))),r.appendChild(t)})):r.parentNode.removeChild(r)},i.prototype.removeAllSourceReferences=function(){for(var e=this._element.getElementsByTagName("note"),t=[],n=0;n<e.length;n++){var r=e.item(n);"location"===r.getAttribute("category")&&t.push(r)}t.forEach(function(e){e.parentNode.removeChild(e)})},i.prototype.description=function(){var e=this.findNoteElementWithCategoryAttribute("description");return e?y.getPCDATA(e):null},i.prototype.setDescription=function(e){var t=this.findNoteElementWithCategoryAttribute("description");e?f.isNullOrUndefined(t)?this.createNoteElementWithCategoryAttribute("description",e):y.replaceContentWithXMLContent(t,e):f.isNullOrUndefined(t)||this.removeNoteElementWithCategoryAttribute("description")},i.prototype.findNoteElementWithCategoryAttribute=function(e){for(var t=this._element.getElementsByTagName("note"),n=0;n<t.length;n++){var r=t.item(n);if(r.getAttribute("category")===e)return r}return null},i.prototype.findAllAdditionalNoteElements=function(){for(var e=this._element.getElementsByTagName("note"),t=[],n=0;n<e.length;n++){var r=e.item(n),i=r.getAttribute("category");"description"!==i&&"meaning"!==i&&t.push(r)}return t},i.prototype.createNoteElementWithCategoryAttribute=function(e,t){var n=y.getFirstElementByTagName(this._element,"notes");f.isNullOrUndefined(n)&&(n=this._element.ownerDocument.createElement("notes"),this._element.appendChild(n));var r=this._element.ownerDocument.createElement("note");return e&&r.setAttribute("category",e),t&&y.replaceContentWithXMLContent(r,t),n.appendChild(r),r},i.prototype.removeNotesElementIfEmpty=function(){var e=y.getFirstElementByTagName(this._element,"notes");e&&(y.getFirstElementByTagName(this._element,"note")||e.parentNode.removeChild(e))},i.prototype.removeNoteElementWithCategoryAttribute=function(e){var t=this.findNoteElementWithCategoryAttribute(e);t&&t.parentNode.removeChild(t),this.removeNotesElementIfEmpty()},i.prototype.removeAllAdditionalNoteElements=function(){this.findAllAdditionalNoteElements().forEach(function(e){e.parentNode.removeChild(e)}),this.removeNotesElementIfEmpty()},i.prototype.meaning=function(){var e=this.findNoteElementWithCategoryAttribute("meaning");return e?y.getPCDATA(e):null},i.prototype.setMeaning=function(e){var t=this.findNoteElementWithCategoryAttribute("meaning");e?f.isNullOrUndefined(t)?this.createNoteElementWithCategoryAttribute("meaning",e):y.replaceContentWithXMLContent(t,e):f.isNullOrUndefined(t)||this.removeNoteElementWithCategoryAttribute("meaning")},i.prototype.notes=function(){return this.findAllAdditionalNoteElements().map(function(e){return{from:e.getAttribute("category"),text:y.getPCDATA(e)}})},i.prototype.supportsSetNotes=function(){return!0},i.prototype.setNotes=function(e){var t=this;f.isNullOrUndefined(e)||this.checkNotes(e),this.removeAllAdditionalNoteElements(),f.isNullOrUndefined(e)||e.forEach(function(e){t.createNoteElementWithCategoryAttribute(e.from,e.text)})},i.prototype.translateNative=function(e){var t=y.getFirstElementByTagName(this._element,"target");t||(t=y.getFirstElementByTagName(this._element,"source").parentNode.appendChild(this._element.ownerDocument.createElement("target")));y.replaceContentWithXMLContent(t,e),this.setTargetState(l)},i.prototype.cloneWithSourceAsTarget=function(e,t,n){var r=new i(this._element.cloneNode(!0),this._id,n);return r.useSourceAsTarget(e,t),r},i.prototype.useSourceAsTarget=function(e,t){var n=y.getFirstElementByTagName(this._element,"source"),r=y.getFirstElementByTagName(this._element,"target");if(r||(r=n.parentNode.appendChild(this._element.ownerDocument.createElement("target"))),e||t){var i=y.getXMLContent(n),a=i;this.isICUMessage(i)||(a=this.translationMessagesFile().getNewTransUnitTargetPraefix()+i+this.translationMessagesFile().getNewTransUnitTargetSuffix()),y.replaceContentWithXMLContent(r,a)}else y.replaceContentWithXMLContent(r,"");var o=y.getFirstElementByTagName(this._element,"segment");o&&(e?o.setAttribute("state",this.mapStateToNativeState(g)):o.setAttribute("state",this.mapStateToNativeState(u)))},i}(_),pe=function(i){function a(e,t,n){var r=i.call(this)||this;return r._warnings=[],r._numberOfTransUnitsWithMissingId=0,r.initializeFromContent(e,t,n),r}return T(a,i),a.prototype.initializeFromContent=function(e,t,n){this.parseContent(e,t,n);var r=this._parsedDocument.getElementsByTagName("xliff");if(1!==r.length)throw new Error(f.format('File "%s" seems to be no xliff file (should contain an xliff element)',t));var i=r.item(0).getAttribute("version");if("2.0"!==i)throw new Error(f.format('File "%s" seems to be no xliff 2 file, version should be %s, found %s',t,"2.0",i));return this},a.prototype.i18nFormat=function(){return c},a.prototype.fileType=function(){return s},a.prototype.elementsWithMixedContent=function(){return["skeleton","note","data","source","target","pc","mrk"]},a.prototype.initializeTransUnits=function(){this.transUnits=[];for(var e=this._parsedDocument.getElementsByTagName("unit"),t=0;t<e.length;t++){var n=e.item(t),r=n.getAttribute("id");r||this._warnings.push(f.format('oops, trans-unit without "id" found in master, please check file %s',this._filename)),this.transUnits.push(new le(n,r,this))}},a.prototype.sourceLanguage=function(){var e=y.getFirstElementByTagName(this._parsedDocument,"xliff");return e?e.getAttribute("srcLang"):null},a.prototype.setSourceLanguage=function(e){var t=y.getFirstElementByTagName(this._parsedDocument,"xliff");t&&t.setAttribute("srcLang",e)},a.prototype.targetLanguage=function(){var e=y.getFirstElementByTagName(this._parsedDocument,"xliff");return e?e.getAttribute("trgLang"):null},a.prototype.setTargetLanguage=function(e){var t=y.getFirstElementByTagName(this._parsedDocument,"xliff");t&&t.setAttribute("trgLang",e)},a.prototype.importNewTransUnit=function(e,t,n,r){if(this.transUnitWithId(e.id))throw new Error(f.format("tu with id %s already exists in file, cannot import it",e.id));var i=e.cloneWithSourceAsTarget(t,n,this),a=y.getFirstElementByTagName(this._parsedDocument,"file");if(!a)throw new Error(f.format('File "%s" seems to be no xliff 2.0 file (should contain a file element)',this._filename));var o=!1,s=!1;r&&(this.transUnitWithId(r.id)&&(s=!0));if(r===undefined||r&&!s)a.appendChild(i.asXmlElement()),o=!0;else if(null===r){var u=y.getFirstElementByTagName(this._parsedDocument,"unit");o=(u?y.insertBefore(i.asXmlElement(),u):a.appendChild(i.asXmlElement()),!0)}else{var l=y.getElementByTagNameAndId(this._parsedDocument,"unit",r.id);l&&(y.insertAfter(i.asXmlElement(),l),o=!0)}return o?(this.lazyInitializeTransUnits(),this.transUnits.push(i),this.countNumbers(),i):null},a.prototype.createTranslationFileForLang=function(e,t,n,r){var i=new a(this.editedContent(),t,this.encoding());return i.setNewTransUnitTargetPraefix(this.targetPraefix),i.setNewTransUnitTargetSuffix(this.targetSuffix),i.setTargetLanguage(e),i.forEachTransUnit(function(e){e.useSourceAsTarget(n,r)}),i},a}(v),ce=function(a){function e(e,t,n,r){var i=a.call(this,e,t,n)||this;return i._sourceTransUnitFromMaster=r,i}return T(e,a),e.prototype.sourceContent=function(){return this._sourceTransUnitFromMaster?this._sourceTransUnitFromMaster.sourceContent():null},e.prototype.supportsSetSourceContent=function(){return!1},e.prototype.setSourceContent=function(e){},e.prototype.messageParser=function(){return new ae},e.prototype.createSourceContentNormalized=function(){return this._sourceTransUnitFromMaster?this._sourceTransUnitFromMaster.createSourceContentNormalized():null},e.prototype.targetContent=function(){return y.getXMLContent(this._element)},e.prototype.targetContentNormalized=function(){return this.messageParser().createNormalizedMessageFromXML(this._element,this.sourceContentNormalized())},e.prototype.nativeTargetState=function(){if(this._sourceTransUnitFromMaster){var e=this._sourceTransUnitFromMaster.sourceContent();return e&&e!==this.targetContent()&&this.targetContent()?"final":"new"}return null},e.prototype.mapStateToNativeState=function(e){return e},e.prototype.mapNativeStateToState=function(e){return e},e.prototype.setNativeTargetState=function(e){},e.prototype.sourceReferences=function(){return this._sourceTransUnitFromMaster?this._sourceTransUnitFromMaster.sourceReferences():[]},e.prototype.supportsSetSourceReferences=function(){return!1},e.prototype.setSourceReferences=function(e){},e.prototype.description=function(){return this._sourceTransUnitFromMaster?this._sourceTransUnitFromMaster.description():null},e.prototype.meaning=function(){return this._sourceTransUnitFromMaster?this._sourceTransUnitFromMaster.meaning():null},e.prototype.supportsSetDescriptionAndMeaning=function(){return!1},e.prototype.setDescription=function(e){},e.prototype.setMeaning=function(e){},e.prototype.notes=function(){return[]},e.prototype.supportsSetNotes=function(){return!1},e.prototype.setNotes=function(e){},e.prototype.cloneWithSourceAsTarget=function(e,t,n){return this},e.prototype.useSourceAsTarget=function(e,t){},e.prototype.translateNative=function(e){var t=this._element;f.isNullOrUndefined(e)&&(e=""),y.replaceContentWithXMLContent(t,e)},e}(_),me=function(o){function e(e,t,n,r,i){var a=o.call(this)||this;return a._translationMessageFileFactory=e,a._warnings=[],a._numberOfTransUnitsWithMissingId=0,a.initializeFromContent(t,n,r,i),a}return T(e,o),e.prototype.initializeFromContent=function(e,t,n,r){if(this.parseContent(e,t,n),1!==this._parsedDocument.getElementsByTagName("translationbundle").length)throw new Error(f.format('File "%s" seems to be no xtb file (should contain a translationbundle element)',t));if(r)try{this._masterFile=this._translationMessageFileFactory.createFileFromFileContent(m,r.xmlContent,r.path,r.encoding);var i=this._masterFile.numberOfTransUnits(),a=this.numberOfTransUnits();i!==a&&this._warnings.push(f.format("%s trans units found in master, but this file has %s. Check if it is the correct master",i,a))}catch(o){throw new Error(f.format('File "%s" seems to be no xmb file. An xtb file needs xmb as master file.',r.path))}return this},e.prototype.initializeTransUnits=function(){this.transUnits=[];for(var e=this._parsedDocument.getElementsByTagName("translation"),t=0;t<e.length;t++){var n=e.item(t),r=n.getAttribute("id");r||this._warnings.push(f.format('oops, msg without "id" found in master, please check file %s',this._filename));var i=null;this._masterFile&&(i=this._masterFile.transUnitWithId(r)),this.transUnits.push(new ce(n,r,this,i))}},e.prototype.i18nFormat=function(){return h},e.prototype.fileType=function(){return"XTB"},e.prototype.elementsWithMixedContent=function(){return["translation"]},e.prototype.sourceLanguage=function(){return this._masterFile?this._masterFile.sourceLanguage():null},e.prototype.setSourceLanguage=function(e){},e.prototype.targetLanguage=function(){var e=y.getFirstElementByTagName(this._parsedDocument,"translationbundle");return e?e.getAttribute("lang"):null},e.prototype.setTargetLanguage=function(e){var t=y.getFirstElementByTagName(this._parsedDocument,"translationbundle");t&&t.setAttribute("lang",e)},e.prototype.importNewTransUnit=function(e,t,n,r){if(this.transUnitWithId(e.id))throw new Error(f.format("tu with id %s already exists in file, cannot import it",e.id));var i=e.cloneWithSourceAsTarget(t,n,this),a=y.getFirstElementByTagName(this._parsedDocument,"translationbundle");if(!a)throw new Error(f.format('File "%s" seems to be no xtb file (should contain a translationbundle element)',this._filename));var o=a.ownerDocument.createElement("translation");o.setAttribute("id",e.id);var s=n||t?e.sourceContent():"";e.isICUMessage(s)||(s=this.getNewTransUnitTargetPraefix()+s+this.getNewTransUnitTargetSuffix()),y.replaceContentWithXMLContent(o,s);var u=new ce(o,e.id,this,i),l=!1,p=!1;r&&(this.transUnitWithId(r.id)&&(p=!0));if(r===undefined||r&&!p)a.appendChild(u.asXmlElement()),l=!0;else if(null===r){var c=y.getFirstElementByTagName(this._parsedDocument,"translation");l=(c?y.insertBefore(u.asXmlElement(),c):a.appendChild(u.asXmlElement()),!0)}else{var m=y.getElementByTagNameAndId(this._parsedDocument,"translation",r.id);m&&(y.insertAfter(u.asXmlElement(),m),l=!0)}return l?(this.lazyInitializeTransUnits(),this.transUnits.push(u),this.countNumbers(),u):null},e.prototype.createTranslationFileForLang=function(e,t,n,r){throw new Error(f.format('File "%s", xtb files are not translatable, they are already translations',t))},e}(v),fe=function(){function l(){}return l.fromFileContent=function(e,t,n,r,i){return(new l).createFileFromFileContent(e,t,n,r,i)},l.fromUnknownFormatFileContent=function(e,t,n,r){return(new l).createFileFromUnknownFormatFileContent(e,t,n,r)},l.prototype.createFileFromFileContent=function(e,t,n,r,i){if(e===p)return new ie(t,n,r);if(e===c)return new pe(t,n,r);if(e===m)return new se(this,t,n,r);if(e===h)return new me(this,t,n,r,i);throw new Error(f.format('oops, unsupported format "%s"',e))},l.prototype.createFileFromUnknownFormatFileContent=function(e,t,n,r){var i=[p,c,m,h];t&&t.endsWith("xmb")&&(i=[m,h,p,c]),t&&t.endsWith("xtb")&&(i=[h,m,p,c]);for(var a=0;a<i.length;a++){var o=i[a];try{var s=l.fromFileContent(o,e,t,n,r);if(s)return s}catch(u){}}throw new Error(f.format("could not identify file format, it is neiter XLIFF (1.2 or 2.0) nor XMB/XTB"))},l}();e.NgxI18nsupportLibModule=r,e.TranslationMessagesFileFactory=fe,e.FORMAT_XLIFF12=p,e.FORMAT_XLIFF20=c,e.FORMAT_XMB=m,e.FORMAT_XTB=h,e.FILETYPE_XLIFF12=o,e.FILETYPE_XLIFF20=s,e.FILETYPE_XMB="XMB",e.FILETYPE_XTB="XTB",e.STATE_NEW=u,e.STATE_TRANSLATED=l,e.STATE_FINAL=g,e.NORMALIZATION_FORMAT_DEFAULT="default",e.NORMALIZATION_FORMAT_NGXTRANSLATE=i,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-i18nsupport-ngx-i18nsupport-lib.umd.min.js.map