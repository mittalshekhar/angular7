/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as Tokenizr from 'tokenizr';
import { isNullOrUndefined } from 'util';
/** *
 * Created by martin on 14.05.2017.
 * A tokenizer for normalized messages.
  @type {?} */
export const TEXT = 'TEXT';
/** @type {?} */
export const START_TAG = 'START_TAG';
/** @type {?} */
export const END_TAG = 'END_TAG';
/** @type {?} */
export const EMPTY_TAG = 'EMPTY_TAG';
/** @type {?} */
export const PLACEHOLDER = 'PLACEHOLDER';
/** @type {?} */
export const ICU_MESSAGE_REF = 'ICU_MESSAGE_REF';
/** @type {?} */
export const ICU_MESSAGE = 'ICU_MESSAGE';
/**
 * @record
 */
export function Token() { }
/** @type {?} */
Token.prototype.type;
/** @type {?} */
Token.prototype.value;
export class ParsedMesageTokenizer {
    /**
     * @return {?}
     */
    getLexer() {
        /** @type {?} */
        const lexer = new Tokenizr();
        /** @type {?} */
        let plaintext = '';
        lexer.before((ctx, match, rule) => {
            if (rule.name !== TEXT && plaintext !== '') {
                ctx.accept(TEXT, { text: plaintext });
                plaintext = '';
            }
        });
        lexer.finish((ctx) => {
            if (plaintext !== '') {
                ctx.accept(TEXT, { text: plaintext });
            }
        });
        // empty tag, there are only a few allowed (see tag-mappings): ['BR', 'HR', 'IMG', 'AREA', 'LINK', 'WBR']
        // format is <name id="nr">, nr ist optional, z.B. <img> oder <img id="2">
        lexer.rule(/<(br|hr|img|area|link|wbr)( id="([0-9])*")?\>/, (ctx, match) => {
            /** @type {?} */
            const idcount = isNullOrUndefined(match[3]) ? 0 : parseInt(match[3], 10);
            ctx.accept(EMPTY_TAG, { name: match[1], idcounter: idcount });
        }, EMPTY_TAG);
        // start tag, Format <name id="nr">, nr ist optional, z.B. <mytag> oder <mytag id="2">
        lexer.rule(/<([a-zA-Z][a-zA-Z-0-9]*)( id="([0-9]*)")?>/, (ctx, match) => {
            /** @type {?} */
            const idcount = isNullOrUndefined(match[3]) ? 0 : parseInt(match[3], 10);
            ctx.accept(START_TAG, { name: match[1], idcounter: idcount });
        }, START_TAG);
        // end tag
        lexer.rule(/<\/([a-zA-Z][a-zA-Z-0-9]*)>/, (ctx, match) => {
            ctx.accept(END_TAG, { name: match[1] });
        }, END_TAG);
        // placeholder
        lexer.rule(/{{([0-9]+)}}/, (ctx, match) => {
            ctx.accept(PLACEHOLDER, { idcounter: parseInt(match[1], 10) });
        }, PLACEHOLDER);
        // icu message ref
        lexer.rule(/<ICU-Message-Ref_([0-9]+)\/>/, (ctx, match) => {
            ctx.accept(ICU_MESSAGE_REF, { idcounter: parseInt(match[1], 10) });
        }, ICU_MESSAGE_REF);
        // icu message
        lexer.rule(/<ICU-Message\/>/, (ctx, match) => {
            ctx.accept(ICU_MESSAGE, { message: match[0] });
        }, ICU_MESSAGE);
        // text
        lexer.rule(/./, (ctx, match) => {
            plaintext += match[0];
            ctx.ignore();
        }, TEXT);
        lexer.rule(/[\t\r\n]+/, (ctx, match) => {
            plaintext += match[0];
            ctx.ignore();
        }, TEXT);
        return lexer;
    }
    /**
     * @param {?} normalizedMessage
     * @return {?}
     */
    tokenize(normalizedMessage) {
        /** @type {?} */
        const lexer = this.getLexer();
        lexer.reset();
        lexer.input(normalizedMessage);
        return lexer.tokens();
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VkLW1lc3NhZ2UtdG9rZW5pemVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQG5neC1pMThuc3VwcG9ydC9uZ3gtaTE4bnN1cHBvcnQtbGliLyIsInNvdXJjZXMiOlsiaW1wbC9wYXJzZWQtbWVzc2FnZS10b2tlbml6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sS0FBSyxRQUFRLE1BQU0sVUFBVSxDQUFDO0FBQ3JDLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLE1BQU0sQ0FBQzs7Ozs7QUFRdkMsYUFBYSxJQUFJLEdBQUcsTUFBTSxDQUFDOztBQUMzQixhQUFhLFNBQVMsR0FBRyxXQUFXLENBQUM7O0FBQ3JDLGFBQWEsT0FBTyxHQUFHLFNBQVMsQ0FBQzs7QUFDakMsYUFBYSxTQUFTLEdBQUcsV0FBVyxDQUFDOztBQUNyQyxhQUFhLFdBQVcsR0FBRyxhQUFhLENBQUM7O0FBQ3pDLGFBQWEsZUFBZSxHQUFHLGlCQUFpQixDQUFDOztBQUNqRCxhQUFhLFdBQVcsR0FBRyxhQUFhLENBQUM7Ozs7Ozs7OztBQU96QyxNQUFNOzs7O0lBRU0sUUFBUTs7UUFDWixNQUFNLEtBQUssR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDOztRQUM3QixJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDbkIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUU7WUFDOUIsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxTQUFTLEtBQUssRUFBRSxFQUFFO2dCQUN4QyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDO2dCQUNwQyxTQUFTLEdBQUcsRUFBRSxDQUFDO2FBQ2xCO1NBQ0osQ0FBQyxDQUFDO1FBQ0gsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ2pCLElBQUksU0FB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QUNuQyxTQUFTLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNoQixFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ1QsT0FBTyxLQUFLLENBQUM7Ozs7OztJQUdqQixRQUFRLENBQUMsaUJBQXlCOztRQUM5QixNQUFNLEtBQUssR0FBYSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDeEMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2QsS0FBSyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQy9CLE9BQU8sS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0tBQ3pCO0NBRUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBUb2tlbml6ciBmcm9tICd0b2tlbml6cic7XHJcbmltcG9ydCB7aXNOdWxsT3JVbmRlZmluZWR9IGZyb20gJ3V0aWwnO1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgbWFydGluIG9uIDE0LjA1LjIwMTcuXHJcbiAqIEEgdG9rZW5pemVyIGZvciBub3JtYWxpemVkIG1lc3NhZ2VzLlxyXG4gKi9cclxuXHJcbi8vIFRva2Vuc1xyXG5leHBvcnQgY29uc3QgVEVYVCA9ICdURVhUJztcclxuZXhwb3J0IGNvbnN0IFNUQVJUX1RBRyA9ICdTVEFSVF9UQUcnO1xyXG5leHBvcnQgY29uc3QgRU5EX1RBRyA9ICdFTkRfVEFHJztcclxuZXhwb3J0IGNvbnN0IEVNUFRZX1RBRyA9ICdFTVBUWV9UQUcnO1xyXG5leHBvcnQgY29uc3QgUExBQ0VIT0xERVIgPSAnUExBQ0VIT0xERVInO1xyXG5leHBvcnQgY29uc3QgSUNVX01FU1NBR0VfUkVGID0gJ0lDVV9NRVNTQUdFX1JFRic7XHJcbmV4cG9ydCBjb25zdCBJQ1VfTUVTU0FHRSA9ICdJQ1VfTUVTU0FHRSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRva2VuIHtcclxuICAgIHR5cGU6IHN0cmluZztcclxuICAgIHZhbHVlOiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBQYXJzZWRNZXNhZ2VUb2tlbml6ZXIge1xyXG5cclxuICAgIHByaXZhdGUgZ2V0TGV4ZXIoKTogVG9rZW5penIge1xyXG4gICAgICAgIGNvbnN0IGxleGVyID0gbmV3IFRva2VuaXpyKCk7XHJcbiAgICAgICAgbGV0IHBsYWludGV4dCA9ICcnO1xyXG4gICAgICAgIGxleGVyLmJlZm9yZSgoY3R4LCBtYXRjaCwgcnVsZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocnVsZS5uYW1lICE9PSBURVhUICYmIHBsYWludGV4dCAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGN0eC5hY2NlcHQoVEVYVCwge3RleHQ6IHBsYWludGV4dH0pO1xyXG4gICAgICAgICAgICAgICAgcGxhaW50ZXh0ID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXhlci5maW5pc2goKGN0eCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocGxhaW50ZXh0ICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgY3R4LmFjY2VwdChURVhULCB7dGV4dDogcGxhaW50ZXh0fSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gZW1wdHkgdGFnLCB0aGVyZSBhcmUgb25seSBhIGZldyBhbGxvd2VkIChzZWUgdGFnLW1hcHBpbmdzKTogWydCUicsICdIUicsICdJTUcnLCAnQVJFQScsICdMSU5LJywgJ1dCUiddXHJcbiAgICAgICAgLy8gZm9ybWF0IGlzIDxuYW1lIGlkPVwibnJcIj4sIG5yIGlzdCBvcHRpb25hbCwgei5CLiA8aW1nPiBvZGVyIDxpbWcgaWQ9XCIyXCI+XHJcbiAgICAgICAgbGV4ZXIucnVsZSgvPChicnxocnxpbWd8YXJlYXxsaW5rfHdicikoIGlkPVwiKFswLTldKSpcIik/XFw+LywgKGN0eCwgbWF0Y2gpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaWRjb3VudCA9IGlzTnVsbE9yVW5kZWZpbmVkKG1hdGNoWzNdKSA/IDAgOiBwYXJzZUludChtYXRjaFszXSwgMTApO1xyXG4gICAgICAgICAgICBjdHguYWNjZXB0KEVNUFRZX1RBRywge25hbWU6IG1hdGNoWzFdLCBpZGNvdW50ZXI6IGlkY291bnR9KTtcclxuICAgICAgICB9LCBFTVBUWV9UQUcpO1xyXG4gICAgICAgIC8vIHN0YXJ0IHRhZywgRm9ybWF0IDxuYW1lIGlkPVwibnJcIj4sIG5yIGlzdCBvcHRpb25hbCwgei5CLiA8bXl0YWc+IG9kZXIgPG15dGFnIGlkPVwiMlwiPlxyXG4gICAgICAgIGxleGVyLnJ1bGUoLzwoW2EtekEtWl1bYS16QS1aLTAtOV0qKSggaWQ9XCIoWzAtOV0qKVwiKT8+LywgKGN0eCwgbWF0Y2gpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaWRjb3VudCA9IGlzTnVsbE9yVW5kZWZpbmVkKG1hdGNoWzNdKSA/IDAgOiBwYXJzZUludChtYXRjaFszXSwgMTApO1xyXG4gICAgICAgICAgICBjdHguYWNjZXB0KFNUQVJUX1RBRywge25hbWU6IG1hdGNoWzFdLCBpZGNvdW50ZXI6IGlkY291bnR9KTtcclxuICAgICAgICB9LCBTVEFSVF9UQUcpO1xyXG4gICAgICAgIC8vIGVuZCB0YWdcclxuICAgICAgICBsZXhlci5ydWxlKC88XFwvKFthLXpBLVpdW2EtekEtWi0wLTldKik+LywgKGN0eCwgbWF0Y2gpID0+IHtcclxuICAgICAgICAgICAgY3R4LmFjY2VwdChFTkRfVEFHLCB7bmFtZTogbWF0Y2hbMV19KTtcclxuICAgICAgICB9LCBFTkRfVEFHKTtcclxuICAgICAgICAvLyBwbGFjZWhvbGRlclxyXG4gICAgICAgIGxleGVyLnJ1bGUoL3t7KFswLTldKyl9fS8sIChjdHgsIG1hdGNoKSA9PiB7XHJcbiAgICAgICAgICAgIGN0eC5hY2NlcHQoUExBQ0VIT0xERVIsIHtpZGNvdW50ZXI6IHBhcnNlSW50KG1hdGNoWzFdLCAxMCl9KTtcclxuICAgICAgICB9LCBQTEFDRUhPTERFUik7XHJcbiAgICAgICAgLy8gaWN1IG1lc3NhZ2UgcmVmXHJcbiAgICAgICAgbGV4ZXIucnVsZSgvPElDVS1NZXNzYWdlLVJlZl8oWzAtOV0rKVxcLz4vLCAoY3R4LCBtYXRjaCkgPT4ge1xyXG4gICAgICAgICAgICBjdHguYWNjZXB0KElDVV9NRVNTQUdFX1JFRiwge2lkY291bnRlcjogcGFyc2VJbnQobWF0Y2hbMV0sIDEwKX0pO1xyXG4gICAgICAgIH0sIElDVV9NRVNTQUdFX1JFRik7XHJcbiAgICAgICAgLy8gaWN1IG1lc3NhZ2VcclxuICAgICAgICBsZXhlci5ydWxlKC88SUNVLU1lc3NhZ2VcXC8+LywgKGN0eCwgbWF0Y2gpID0+IHtcclxuICAgICAgICAgICAgY3R4LmFjY2VwdChJQ1VfTUVTU0FHRSwge21lc3NhZ2U6IG1hdGNoWzBdfSk7XHJcbiAgICAgICAgfSwgSUNVX01FU1NBR0UpO1xyXG4gICAgICAgIC8vIHRleHRcclxuICAgICAgICBsZXhlci5ydWxlKC8uLywgKGN0eCwgbWF0Y2gpID0+IHtcclxuICAgICAgICAgICAgcGxhaW50ZXh0ICs9IG1hdGNoWzBdO1xyXG4gICAgICAgICAgICBjdHguaWdub3JlKCk7XHJcbiAgICAgICAgfSwgVEVYVCk7XHJcbiAgICAgICAgbGV4ZXIucnVsZSgvW1xcdFxcclxcbl0rLywgKGN0eCwgbWF0Y2gpID0+IHtcclxuICAgICAgICAgICAgcGxhaW50ZXh0ICs9IG1hdGNoWzBdO1xyXG4gICAgICAgICAgICBjdHguaWdub3JlKCk7XHJcbiAgICAgICAgfSwgVEVYVCk7XHJcbiAgICAgICAgcmV0dXJuIGxleGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHRva2VuaXplKG5vcm1hbGl6ZWRNZXNzYWdlOiBzdHJpbmcpOiBUb2tlbltdIHtcclxuICAgICAgICBjb25zdCBsZXhlcjogVG9rZW5penIgPSB0aGlzLmdldExleGVyKCk7XHJcbiAgICAgICAgbGV4ZXIucmVzZXQoKTtcclxuICAgICAgICBsZXhlci5pbnB1dChub3JtYWxpemVkTWVzc2FnZSk7XHJcbiAgICAgICAgcmV0dXJuIGxleGVyLnRva2VucygpO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=