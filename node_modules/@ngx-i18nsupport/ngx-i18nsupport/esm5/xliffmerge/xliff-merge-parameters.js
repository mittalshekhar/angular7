/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/**
 * Created by martin on 17.02.2017.
 * Collection of all parameters used by the tool.
 * The parameters are read form the profile or defaults are used.
 */
import * as fs from 'fs';
import { XliffMergeError } from './xliff-merge-error';
import { format } from 'util';
import { isArray, isNullOrUndefined } from '../common/util';
import { FileUtil } from '../common/file-util';
import { NgxTranslateExtractor } from './ngx-translate-extractor';
import { dirname, isAbsolute, join } from 'path';
/** @type {?} */
var PROFILE_CANDIDATES = ['package.json', '.angular-cli.json'];
var XliffMergeParameters = /** @class */ (function () {
    function XliffMergeParameters() {
        this.errorsFound = [];
        this.warningsFound = [];
    }
    /**
     * Create Parameters.
     * @param options command options
     * @param profileContent given profile (if not, it is read from the profile path from options).
     */
    /**
     * Create Parameters.
     * @param {?} options command options
     * @param {?=} profileContent given profile (if not, it is read from the profile path from options).
     * @return {?}
     */
    XliffMergeParameters.createFromOptions = /**
     * Create Parameters.
     * @param {?} options command options
     * @param {?=} profileContent given profile (if not, it is read from the profile path from options).
     * @return {?}
     */
    function (options, profileContent) {
        /** @type {?} */
        var parameters = new XliffMergeParameters();
        parameters.configure(options, profileContent);
        return parameters;
    };
    /**
     * Read potential profile.
     * To be a candidate, file must exist and contain property "xliffmergeOptions".
     * @param profilePath path of profile
     * @return parsed content of file or null, if file does not exist or is not a profile candidate.
     */
    /**
     * Read potential profile.
     * To be a candidate, file must exist and contain property "xliffmergeOptions".
     * @param {?} profilePath path of profile
     * @return {?} parsed content of file or null, if file does not exist or is not a profile candidate.
     */
    XliffMergeParameters.readProfileCandidate = /**
     * Read potential profile.
     * To be a candidate, file must exist and contain property "xliffmergeOptions".
     * @param {?} profilePath path of profile
     * @return {?} parsed content of file or null, if file does not exist or is not a profile candidate.
     */
    function (profilePath) {
        /** @type {?} */
        var content;
        try {
            content = fs.readFileSync(profilePath, 'UTF-8');
        }
        catch (err) {
            return null;
        }
        /** @type {?} */
        var parsedContent = JSON.parse(content);
        if (parsedContent && parsedContent.xliffmergeOptions) {
            return parsedContent;
        }
        else {
            return null;
        }
    };
    /**
     * Initialize me from the profile content.
     * (public only for test usage).
     * @param options options given at runtime via command line
     * @param profileContent if null, read it from profile.
     */
    /**
     * Initialize me from the profile content.
     * (public only for test usage).
     * @param {?} options options given at runtime via command line
     * @param {?=} profileContent if null, read it from profile.
     * @return {?}
     */
    XliffMergeParameters.prototype.configure = /**
     * Initialize me from the profile content.
     * (public only for test usage).
     * @param {?} options options given at runtime via command line
     * @param {?=} profileContent if null, read it from profile.
     * @return {?}
     */
    function (options, profileContent) {
        this.errorsFound = [];
        this.warningsFound = [];
        if (!profileContent) {
            profileContent = this.readProfile(options);
        }
        /** @type {?} */
        var validProfile = (!!profileContent);
        if (options.quiet) {
            this._quiet = options.quiet;
        }
        if (options.verbose) {
            this._verbose = options.verbose;
        }
        if (validProfile) {
            this.initializeFromConfig(profileContent);
            // if languages are given as parameters, they ovveride everything said in profile
            if (!!options.languages && options.languages.length > 0) {
                this._languages = options.languages;
                if (!this._defaultLanguage) {
                    this._defaultLanguage = this._languages[0];
                }
            }
            this.checkParameters();
        }
    };
    /**
     * Read profile.
     * @param options program options
     * @return the read profile (empty, if none, null if errors)
     */
    /**
     * Read profile.
     * @param {?} options program options
     * @return {?} the read profile (empty, if none, null if errors)
     */
    XliffMergeParameters.prototype.readProfile = /**
     * Read profile.
     * @param {?} options program options
     * @return {?} the read profile (empty, if none, null if errors)
     */
    function (options) {
        var e_1, _a;
        /** @type {?} */
        var profilePath = options.profilePath;
        if (!profilePath) {
            try {
                for (var PROFILE_CANDIDATES_1 = tslib_1.__values(PROFILE_CANDIDATES), PROFILE_CANDIDATES_1_1 = PROFILE_CANDIDATES_1.next(); !PROFILE_CANDIDATES_1_1.done; PROFILE_CANDIDATES_1_1 = PROFILE_CANDIDATES_1.next()) {
                    var configfilename = PROFILE_CANDIDATES_1_1.value;
                    /** @type {?} */
                    var profile = XliffMergeParameters.readProfileCandidate(configfilename);
                    if (profile) {
                        this.usedProfilePath = configfilename;
                        return profile;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (PROFILE_CANDIDATES_1_1 && !PROFILE_CANDIDATES_1_1.done && (_a = PROFILE_CANDIDATES_1.return)) _a.call(PROFILE_CANDIDATES_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return {};
        }
        /** @type {?} */
        var content;
        try {
            content = fs.readFileSync(profilePath, 'UTF-8');
        }
        catch (err) {
            this.errorsFound.push(new XliffMergeError('could not read profile "' + profilePath + '"'));
            return null;
        }
        this.usedProfilePath = profilePath;
        /** @type {?} */
        var profileContent = JSON.parse(content);
        // replace all pathes in options by absolute paths
        /** @type {?} */
        var xliffmergeOptions = profileContent.xliffmergeOptions;
        xliffmergeOptions.srcDir = this.adjustPathToProfilePath(profilePath, xliffmergeOptions.srcDir);
        xliffmergeOptions.genDir = this.adjustPathToProfilePath(profilePath, xliffmergeOptions.genDir);
        xliffmergeOptions.apikeyfile = this.adjustPathToProfilePath(profilePath, xliffmergeOptions.apikeyfile);
        return profileContent;
    };
    /**
     * @param {?} profilePath
     * @param {?} pathToAdjust
     * @return {?}
     */
    XliffMergeParameters.prototype.adjustPathToProfilePath = /**
     * @param {?} profilePath
     * @param {?} pathToAdjust
     * @return {?}
     */
    function (profilePath, pathToAdjust) {
        if (!pathToAdjust || isAbsolute(pathToAdjust)) {
            return pathToAdjust;
        }
        return join(dirname(profilePath), pathToAdjust).replace(/\\/g, '/');
    };
    /**
     * @param {?} profileContent
     * @return {?}
     */
    XliffMergeParameters.prototype.initializeFromConfig = /**
     * @param {?} profileContent
     * @return {?}
     */
    function (profileContent) {
        if (!profileContent) {
            return;
        }
        /** @type {?} */
        var profile = profileContent.xliffmergeOptions;
        if (profile) {
            if (!isNullOrUndefined(profile.quiet)) {
                this._quiet = profile.quiet;
            }
            if (!isNullOrUndefined(profile.verbose)) {
                this._verbose = profile.verbose;
            }
            if (!isNullOrUndefined(profile.allowIdChange)) {
                this._allowIdChange = profile.allowIdChange;
            }
            if (profile.defaultLanguage) {
                this._defaultLanguage = profile.defaultLanguage;
            }
            if (profile.languages) {
                this._languages = profile.languages;
            }
            if (profile.srcDir) {
                this._srcDir = profile.srcDir;
            }
            if (profile.angularCompilerOptions) {
                if (profile.angularCompilerOptions.genDir) {
                    this._genDir = profile.angularCompilerOptions.genDir;
                }
            }
            if (profile.genDir) {
                // this must be after angularCompilerOptions to be preferred
                this._genDir = profile.genDir;
            }
            if (profile.i18nBaseFile) {
                this._i18nBaseFile = profile.i18nBaseFile;
            }
            if (profile.i18nFile) {
                this._i18nFile = profile.i18nFile;
            }
            if (profile.i18nFormat) {
                this._i18nFormat = profile.i18nFormat;
            }
            if (profile.encoding) {
                this._encoding = profile.encoding;
            }
            if (!isNullOrUndefined(profile.removeUnusedIds)) {
                this._removeUnusedIds = profile.removeUnusedIds;
            }
            if (!isNullOrUndefined(profile.supportNgxTranslate)) {
                this._supportNgxTranslate = profile.supportNgxTranslate;
            }
            if (!isNullOrUndefined(profile.ngxTranslateExtractionPattern)) {
                this._ngxTranslateExtractionPattern = profile.ngxTranslateExtractionPattern;
            }
            if (!isNullOrUndefined(profile.useSourceAsTarget)) {
                this._useSourceAsTarget = profile.useSourceAsTarget;
            }
            if (!isNullOrUndefined(profile.targetPraefix)) {
                this._targetPraefix = profile.targetPraefix;
            }
            if (!isNullOrUndefined(profile.targetSuffix)) {
                this._targetSuffix = profile.targetSuffix;
            }
            if (!isNullOrUndefined(profile.autotranslate)) {
                this._autotranslate = profile.autotranslate;
            }
            if (!isNullOrUndefined(profile.beautifyOutput)) {
                this._beautifyOutput = profile.beautifyOutput;
            }
            if (!isNullOrUndefined(profile.preserveOrder)) {
                this._preserveOrder = profile.preserveOrder;
            }
            if (!isNullOrUndefined(profile.apikey)) {
                this._apikey = profile.apikey;
            }
            if (!isNullOrUndefined(profile.apikeyfile)) {
                this._apikeyfile = profile.apikeyfile;
            }
        }
        else {
            this.warningsFound.push('did not find "xliffmergeOptions" in profile, using defaults');
        }
    };
    /**
     * Check all Parameters, wether they are complete and consistent.
     * if something is wrong with the parameters, it is collected in errorsFound.
     */
    /**
     * Check all Parameters, wether they are complete and consistent.
     * if something is wrong with the parameters, it is collected in errorsFound.
     * @return {?}
     */
    XliffMergeParameters.prototype.checkParameters = /**
     * Check all Parameters, wether they are complete and consistent.
     * if something is wrong with the parameters, it is collected in errorsFound.
     * @return {?}
     */
    function () {
        var _this = this;
        this.checkLanguageSyntax(this.defaultLanguage());
        if (this.languages().length === 0) {
            this.errorsFound.push(new XliffMergeError('no languages specified'));
        }
        this.languages().forEach(function (lang) {
            _this.checkLanguageSyntax(lang);
        });
        /** @type {?} */
        var stats;
        /** @type {?} */
        var err;
        // srcDir should exists
        try {
            stats = fs.statSync(this.srcDir());
        }
        catch (e) {
            err = e;
        }
        if (!!err || !stats.isDirectory()) {
            this.errorsFound.push(new XliffMergeError('srcDir "' + this.srcDir() + '" is not a directory'));
        }
        // genDir should exists
        try {
            stats = fs.statSync(this.genDir());
        }
        catch (e) {
            err = e;
        }
        if (!!err || !stats.isDirectory()) {
            this.errorsFound.push(new XliffMergeError('genDir "' + this.genDir() + '" is not a directory'));
        }
        // master file MUST exist
        try {
            fs.accessSync(this.i18nFile(), fs.constants.R_OK);
        }
        catch (err) {
            this.errorsFound.push(new XliffMergeError('i18nFile "' + this.i18nFile() + '" is not readable'));
        }
        // i18nFormat must be xlf xlf2 or xmb
        if (!(this.i18nFormat() === 'xlf' || this.i18nFormat() === 'xlf2' || this.i18nFormat() === 'xmb')) {
            this.errorsFound.push(new XliffMergeError('i18nFormat "' + this.i18nFormat() + '" invalid, must be "xlf" or "xlf2" or "xmb"'));
        }
        // autotranslate requires api key
        if (this.autotranslate() && !this.apikey()) {
            this.errorsFound.push(new XliffMergeError('autotranslate requires an API key, please set one'));
        }
        // autotranslated languages must be in list of all languages
        this.autotranslatedLanguages().forEach(function (lang) {
            if (_this.languages().indexOf(lang) < 0) {
                _this.errorsFound.push(new XliffMergeError('autotranslate language "' + lang + '" is not in list of languages'));
            }
            if (lang === _this.defaultLanguage()) {
                _this.errorsFound.push(new XliffMergeError('autotranslate language "' + lang + '" cannot be translated, because it is the source language'));
            }
        });
        // ngx translate pattern check
        if (this.supportNgxTranslate()) {
            /** @type {?} */
            var checkResult = NgxTranslateExtractor.checkPattern(this.ngxTranslateExtractionPattern());
            if (!isNullOrUndefined(checkResult)) {
                this.errorsFound.push(new XliffMergeError('ngxTranslateExtractionPattern "' + this.ngxTranslateExtractionPattern() + '": ' + checkResult));
            }
        }
        // targetPraefix and targetSuffix check
        if (!this.useSourceAsTarget()) {
            if (this.targetPraefix().length > 0) {
                this.warningsFound.push('configured targetPraefix "' + this.targetPraefix() + '" will not be used because "useSourceAsTarget" is disabled"');
            }
            if (this.targetSuffix().length > 0) {
                this.warningsFound.push('configured targetSuffix "' + this.targetSuffix() + '" will not be used because "useSourceAsTarget" is disabled"');
            }
        }
    };
    /**
     * Check syntax of language.
     * Must be compatible with XML Schema type xsd:language.
     * Pattern: [a-zA-Z]{1,8}((-|_)[a-zA-Z0-9]{1,8})*
     * @param lang language to check
     */
    /**
     * Check syntax of language.
     * Must be compatible with XML Schema type xsd:language.
     * Pattern: [a-zA-Z]{1,8}((-|_)[a-zA-Z0-9]{1,8})*
     * @param {?} lang language to check
     * @return {?}
     */
    XliffMergeParameters.prototype.checkLanguageSyntax = /**
     * Check syntax of language.
     * Must be compatible with XML Schema type xsd:language.
     * Pattern: [a-zA-Z]{1,8}((-|_)[a-zA-Z0-9]{1,8})*
     * @param {?} lang language to check
     * @return {?}
     */
    function (lang) {
        /** @type {?} */
        var pattern = /^[a-zA-Z]{1,8}([-_][a-zA-Z0-9]{1,8})*$/;
        if (!pattern.test(lang)) {
            this.errorsFound.push(new XliffMergeError('language "' + lang + '" is not valid'));
        }
    };
    /**
     * @return {?}
     */
    XliffMergeParameters.prototype.allowIdChange = /**
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._allowIdChange)) ? false : this._allowIdChange;
    };
    /**
     * @return {?}
     */
    XliffMergeParameters.prototype.verbose = /**
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._verbose)) ? false : this._verbose;
    };
    /**
     * @return {?}
     */
    XliffMergeParameters.prototype.quiet = /**
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._quiet)) ? false : this._quiet;
    };
    /**
     * Debug output all parameters to commandOutput.
     */
    /**
     * Debug output all parameters to commandOutput.
     * @param {?} commandOutput
     * @return {?}
     */
    XliffMergeParameters.prototype.showAllParameters = /**
     * Debug output all parameters to commandOutput.
     * @param {?} commandOutput
     * @return {?}
     */
    function (commandOutput) {
        var e_2, _a;
        commandOutput.debug('xliffmerge Used Parameters:');
        commandOutput.debug('usedProfilePath:\t"%s"', this.usedProfilePath);
        commandOutput.debug('defaultLanguage:\t"%s"', this.defaultLanguage());
        commandOutput.debug('srcDir:\t"%s"', this.srcDir());
        commandOutput.debug('genDir:\t"%s"', this.genDir());
        commandOutput.debug('i18nBaseFile:\t"%s"', this.i18nBaseFile());
        commandOutput.debug('i18nFile:\t"%s"', this.i18nFile());
        commandOutput.debug('languages:\t%s', this.languages());
        try {
            for (var _b = tslib_1.__values(this.languages()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var language = _c.value;
                commandOutput.debug('outputFile[%s]:\t%s', language, this.generatedI18nFile(language));
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
        commandOutput.debug('removeUnusedIds:\t%s', this.removeUnusedIds());
        commandOutput.debug('supportNgxTranslate:\t%s', this.supportNgxTranslate());
        if (this.supportNgxTranslate()) {
            commandOutput.debug('ngxTranslateExtractionPattern:\t%s', this.ngxTranslateExtractionPattern());
        }
        commandOutput.debug('useSourceAsTarget:\t%s', this.useSourceAsTarget());
        if (this.useSourceAsTarget()) {
            commandOutput.debug('targetPraefix:\t"%s"', this.targetPraefix());
            commandOutput.debug('targetSuffix:\t"%s"', this.targetSuffix());
        }
        commandOutput.debug('allowIdChange:\t%s', this.allowIdChange());
        commandOutput.debug('beautifyOutput:\t%s', this.beautifyOutput());
        commandOutput.debug('preserveOrder:\t%s', this.preserveOrder());
        commandOutput.debug('autotranslate:\t%s', this.autotranslate());
        if (this.autotranslate()) {
            commandOutput.debug('autotranslated languages:\t%s', this.autotranslatedLanguages());
            commandOutput.debug('apikey:\t%s', this.apikey() ? '****' : 'NOT SET');
            commandOutput.debug('apikeyfile:\t%s', this.apikeyfile());
        }
    };
    /**
     * Default-Language, default en.
     * @return default language
     */
    /**
     * Default-Language, default en.
     * @return {?} default language
     */
    XliffMergeParameters.prototype.defaultLanguage = /**
     * Default-Language, default en.
     * @return {?} default language
     */
    function () {
        return this._defaultLanguage ? this._defaultLanguage : 'en';
    };
    /**
     * Liste der zu bearbeitenden Sprachen.
     * @return languages
     */
    /**
     * Liste der zu bearbeitenden Sprachen.
     * @return {?} languages
     */
    XliffMergeParameters.prototype.languages = /**
     * Liste der zu bearbeitenden Sprachen.
     * @return {?} languages
     */
    function () {
        return this._languages ? this._languages : [];
    };
    /**
     * src directory, where the master xlif is located.
     * @return srcDir
     */
    /**
     * src directory, where the master xlif is located.
     * @return {?} srcDir
     */
    XliffMergeParameters.prototype.srcDir = /**
     * src directory, where the master xlif is located.
     * @return {?} srcDir
     */
    function () {
        return this._srcDir ? this._srcDir : '.';
    };
    /**
     * The base file name of the xlif file for input and output.
     * Default is messages
     * @return base file
     */
    /**
     * The base file name of the xlif file for input and output.
     * Default is messages
     * @return {?} base file
     */
    XliffMergeParameters.prototype.i18nBaseFile = /**
     * The base file name of the xlif file for input and output.
     * Default is messages
     * @return {?} base file
     */
    function () {
        return this._i18nBaseFile ? this._i18nBaseFile : 'messages';
    };
    /**
     * The master xlif file (the one generated by ng-xi18n).
     * Default is <srcDir>/<i18nBaseFile>.xlf.
     * @return master file
     */
    /**
     * The master xlif file (the one generated by ng-xi18n).
     * Default is <srcDir>/<i18nBaseFile>.xlf.
     * @return {?} master file
     */
    XliffMergeParameters.prototype.i18nFile = /**
     * The master xlif file (the one generated by ng-xi18n).
     * Default is <srcDir>/<i18nBaseFile>.xlf.
     * @return {?} master file
     */
    function () {
        return join(this.srcDir(), (this._i18nFile ? this._i18nFile : this.i18nBaseFile() + '.' + this.suffixForGeneratedI18nFile())).replace(/\\/g, '/');
    };
    /**
     * Format of the master xlif file.
     * Default is "xlf", possible are "xlf" or "xlf2" or "xmb".
     * @return format
     */
    /**
     * Format of the master xlif file.
     * Default is "xlf", possible are "xlf" or "xlf2" or "xmb".
     * @return {?} format
     */
    XliffMergeParameters.prototype.i18nFormat = /**
     * Format of the master xlif file.
     * Default is "xlf", possible are "xlf" or "xlf2" or "xmb".
     * @return {?} format
     */
    function () {
        return (this._i18nFormat ? this._i18nFormat : 'xlf');
    };
    /**
     * potentially to be generated I18n-File with the translations for one language.
     * @param lang language shortcut
     * @return Path of file
     */
    /**
     * potentially to be generated I18n-File with the translations for one language.
     * @param {?} lang language shortcut
     * @return {?} Path of file
     */
    XliffMergeParameters.prototype.generatedI18nFile = /**
     * potentially to be generated I18n-File with the translations for one language.
     * @param {?} lang language shortcut
     * @return {?} Path of file
     */
    function (lang) {
        return join(this.genDir(), this.i18nBaseFile() + '.' + lang + '.' + this.suffixForGeneratedI18nFile()).replace(/\\/g, '/');
    };
    /**
     * @return {?}
     */
    XliffMergeParameters.prototype.suffixForGeneratedI18nFile = /**
     * @return {?}
     */
    function () {
        switch (this.i18nFormat()) {
            case 'xlf':
                return 'xlf';
            case 'xlf2':
                return 'xlf';
            case 'xmb':
                return 'xtb';
        }
    };
    /**
     * potentially to be generated translate-File for ngx-translate with the translations for one language.
     * @param lang language shortcut
     * @return Path of file
     */
    /**
     * potentially to be generated translate-File for ngx-translate with the translations for one language.
     * @param {?} lang language shortcut
     * @return {?} Path of file
     */
    XliffMergeParameters.prototype.generatedNgxTranslateFile = /**
     * potentially to be generated translate-File for ngx-translate with the translations for one language.
     * @param {?} lang language shortcut
     * @return {?} Path of file
     */
    function (lang) {
        return join(this.genDir(), this.i18nBaseFile() + '.' + lang + '.' + 'json').replace(/\\/g, '/');
    };
    /**
     * The encoding used to write new XLIFF-files.
     * @return encoding
     */
    /**
     * The encoding used to write new XLIFF-files.
     * @return {?} encoding
     */
    XliffMergeParameters.prototype.encoding = /**
     * The encoding used to write new XLIFF-files.
     * @return {?} encoding
     */
    function () {
        return this._encoding ? this._encoding : 'UTF-8';
    };
    /**
     * Output-Directory, where the output is written to.
     * Default is <srcDir>.
    */
    /**
     * Output-Directory, where the output is written to.
     * Default is <srcDir>.
     * @return {?}
     */
    XliffMergeParameters.prototype.genDir = /**
     * Output-Directory, where the output is written to.
     * Default is <srcDir>.
     * @return {?}
     */
    function () {
        return this._genDir ? this._genDir : this.srcDir();
    };
    /**
     * @return {?}
     */
    XliffMergeParameters.prototype.removeUnusedIds = /**
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._removeUnusedIds)) ? true : this._removeUnusedIds;
    };
    /**
     * @return {?}
     */
    XliffMergeParameters.prototype.supportNgxTranslate = /**
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._supportNgxTranslate)) ? false : this._supportNgxTranslate;
    };
    /**
     * @return {?}
     */
    XliffMergeParameters.prototype.ngxTranslateExtractionPattern = /**
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._ngxTranslateExtractionPattern)) ?
            NgxTranslateExtractor.DefaultExtractionPattern : this._ngxTranslateExtractionPattern;
    };
    /**
     * Whether source must be used as target for new trans-units
     * Default is true
     */
    /**
     * Whether source must be used as target for new trans-units
     * Default is true
     * @return {?}
     */
    XliffMergeParameters.prototype.useSourceAsTarget = /**
     * Whether source must be used as target for new trans-units
     * Default is true
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._useSourceAsTarget)) ? true : this._useSourceAsTarget;
    };
    /**
     * Praefix used for target when copying new trans-units
     * Default is ""
     */
    /**
     * Praefix used for target when copying new trans-units
     * Default is ""
     * @return {?}
     */
    XliffMergeParameters.prototype.targetPraefix = /**
     * Praefix used for target when copying new trans-units
     * Default is ""
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._targetPraefix)) ? '' : this._targetPraefix;
    };
    /**
     * Suffix used for target when copying new trans-units
     * Default is ""
     */
    /**
     * Suffix used for target when copying new trans-units
     * Default is ""
     * @return {?}
     */
    XliffMergeParameters.prototype.targetSuffix = /**
     * Suffix used for target when copying new trans-units
     * Default is ""
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._targetSuffix)) ? '' : this._targetSuffix;
    };
    /**
     * If set, run xml result through beautifier (pretty-data).
     */
    /**
     * If set, run xml result through beautifier (pretty-data).
     * @return {?}
     */
    XliffMergeParameters.prototype.beautifyOutput = /**
     * If set, run xml result through beautifier (pretty-data).
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._beautifyOutput)) ? false : this._beautifyOutput;
    };
    /**
     * If set, order of new trans units will be as in master.
     * Otherwise they are added at the end.
     */
    /**
     * If set, order of new trans units will be as in master.
     * Otherwise they are added at the end.
     * @return {?}
     */
    XliffMergeParameters.prototype.preserveOrder = /**
     * If set, order of new trans units will be as in master.
     * Otherwise they are added at the end.
     * @return {?}
     */
    function () {
        return (isNullOrUndefined(this._preserveOrder)) ? true : this._preserveOrder;
    };
    /**
     * Whether to use autotranslate for new trans-units
     * Default is false
     */
    /**
     * Whether to use autotranslate for new trans-units
     * Default is false
     * @return {?}
     */
    XliffMergeParameters.prototype.autotranslate = /**
     * Whether to use autotranslate for new trans-units
     * Default is false
     * @return {?}
     */
    function () {
        if (isNullOrUndefined(this._autotranslate)) {
            return false;
        }
        if (isArray(this._autotranslate)) {
            return ((/** @type {?} */ (this._autotranslate))).length > 0;
        }
        return (/** @type {?} */ (this._autotranslate));
    };
    /**
     * Whether to use autotranslate for a given language.
     * @param lang language code.
     */
    /**
     * Whether to use autotranslate for a given language.
     * @param {?} lang language code.
     * @return {?}
     */
    XliffMergeParameters.prototype.autotranslateLanguage = /**
     * Whether to use autotranslate for a given language.
     * @param {?} lang language code.
     * @return {?}
     */
    function (lang) {
        return this.autotranslatedLanguages().indexOf(lang) >= 0;
    };
    /**
     * Return a list of languages to be autotranslated.
     */
    /**
     * Return a list of languages to be autotranslated.
     * @return {?}
     */
    XliffMergeParameters.prototype.autotranslatedLanguages = /**
     * Return a list of languages to be autotranslated.
     * @return {?}
     */
    function () {
        if (isNullOrUndefined(this._autotranslate) || this._autotranslate === false) {
            return [];
        }
        if (isArray(this._autotranslate)) {
            return ((/** @type {?} */ (this._autotranslate)));
        }
        return this.languages().slice(1); // first is source language
    };
    /**
     * API key to be used for Google Translate
     * @return api key
     */
    /**
     * API key to be used for Google Translate
     * @return {?} api key
     */
    XliffMergeParameters.prototype.apikey = /**
     * API key to be used for Google Translate
     * @return {?} api key
     */
    function () {
        if (!isNullOrUndefined(this._apikey)) {
            return this._apikey;
        }
        else {
            /** @type {?} */
            var apikeyPath = this.apikeyfile();
            if (this.apikeyfile()) {
                if (fs.existsSync(apikeyPath)) {
                    return FileUtil.read(apikeyPath, 'utf-8');
                }
                else {
                    throw new Error(format('api key file not found: API_KEY_FILE=%s', apikeyPath));
                }
            }
            else {
                return null;
            }
        }
    };
    /**
     * file name for API key to be used for Google Translate.
     * Explicitly set or read from env var API_KEY_FILE.
     * @return file of api key
     */
    /**
     * file name for API key to be used for Google Translate.
     * Explicitly set or read from env var API_KEY_FILE.
     * @return {?} file of api key
     */
    XliffMergeParameters.prototype.apikeyfile = /**
     * file name for API key to be used for Google Translate.
     * Explicitly set or read from env var API_KEY_FILE.
     * @return {?} file of api key
     */
    function () {
        if (this._apikeyfile) {
            return this._apikeyfile;
        }
        else if (process.env.API_KEY_FILE) {
            return process.env.API_KEY_FILE;
        }
        else {
            return null;
        }
    };
    return XliffMergeParameters;
}());
export { XliffMergeParameters };
if (false) {
    /** @type {?} */
    XliffMergeParameters.prototype.usedProfilePath;
    /** @type {?} */
    XliffMergeParameters.prototype._quiet;
    /** @type {?} */
    XliffMergeParameters.prototype._verbose;
    /** @type {?} */
    XliffMergeParameters.prototype._allowIdChange;
    /** @type {?} */
    XliffMergeParameters.prototype._defaultLanguage;
    /** @type {?} */
    XliffMergeParameters.prototype._srcDir;
    /** @type {?} */
    XliffMergeParameters.prototype._i18nBaseFile;
    /** @type {?} */
    XliffMergeParameters.prototype._i18nFile;
    /** @type {?} */
    XliffMergeParameters.prototype._i18nFormat;
    /** @type {?} */
    XliffMergeParameters.prototype._encoding;
    /** @type {?} */
    XliffMergeParameters.prototype._genDir;
    /** @type {?} */
    XliffMergeParameters.prototype._languages;
    /** @type {?} */
    XliffMergeParameters.prototype._removeUnusedIds;
    /** @type {?} */
    XliffMergeParameters.prototype._supportNgxTranslate;
    /** @type {?} */
    XliffMergeParameters.prototype._ngxTranslateExtractionPattern;
    /** @type {?} */
    XliffMergeParameters.prototype._useSourceAsTarget;
    /** @type {?} */
    XliffMergeParameters.prototype._targetPraefix;
    /** @type {?} */
    XliffMergeParameters.prototype._targetSuffix;
    /** @type {?} */
    XliffMergeParameters.prototype._beautifyOutput;
    /** @type {?} */
    XliffMergeParameters.prototype._preserveOrder;
    /** @type {?} */
    XliffMergeParameters.prototype._autotranslate;
    /** @type {?} */
    XliffMergeParameters.prototype._apikey;
    /** @type {?} */
    XliffMergeParameters.prototype._apikeyfile;
    /** @type {?} */
    XliffMergeParameters.prototype.errorsFound;
    /** @type {?} */
    XliffMergeParameters.prototype.warningsFound;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieGxpZmYtbWVyZ2UtcGFyYW1ldGVycy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuZ3gtaTE4bnN1cHBvcnQvbmd4LWkxOG5zdXBwb3J0LyIsInNvdXJjZXMiOlsieGxpZmZtZXJnZS94bGlmZi1tZXJnZS1wYXJhbWV0ZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFNQSxPQUFPLEtBQUssRUFBRSxNQUFNLElBQUksQ0FBQztBQUN6QixPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFHcEQsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUM1QixPQUFPLEVBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFMUQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQzdDLE9BQU8sRUFBQyxxQkFBcUIsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBQ2hFLE9BQU8sRUFBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBWSxNQUFNLE1BQU0sQ0FBQzs7SUFFcEQsa0JBQWtCLEdBQUcsQ0FBQyxjQUFjLEVBQUUsbUJBQW1CLENBQUM7QUFFaEU7SUF3Q0k7UUFDSSxJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBZEQ7Ozs7T0FJRzs7Ozs7OztJQUNXLHNDQUFpQjs7Ozs7O0lBQS9CLFVBQWdDLE9BQXVCLEVBQUUsY0FBNEI7O1lBQzNFLFVBQVUsR0FBRyxJQUFJLG9CQUFvQixFQUFFO1FBQzdDLFVBQVUsQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQzlDLE9BQU8sVUFBVSxDQUFDO0lBQ3RCLENBQUM7SUFPRDs7Ozs7T0FLRzs7Ozs7OztJQUNZLHlDQUFvQjs7Ozs7O0lBQW5DLFVBQW9DLFdBQW1COztZQUMvQyxPQUFlO1FB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Q0FBQztTQUMzQjthQUFNLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUU7WUFDakMsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztTQUNuQzthQUFNO1lBQ0gsT0FBTyxJQUFJLENBQUM7U0FDZjtJQUNMLENBQUM7SUFDTCwyQkFBQztBQUFELENBQUMsQUFwa0JELElBb2tCQzs7OztJQWxrQkcsK0NBQWdDOztJQUNoQyxzQ0FBd0I7O0lBQ3hCLHdDQUEwQjs7SUFDMUIsOENBQWdDOztJQUNoQyxnREFBaUM7O0lBQ2pDLHVDQUF3Qjs7SUFDeEIsNkNBQThCOztJQUM5Qix5Q0FBMEI7O0lBQzFCLDJDQUE0Qjs7SUFDNUIseUNBQTBCOztJQUMxQix1Q0FBd0I7O0lBQ3hCLDBDQUE2Qjs7SUFDN0IsZ0RBQWtDOztJQUNsQyxvREFBc0M7O0lBQ3RDLDhEQUErQzs7SUFDL0Msa0RBQW9DOztJQUNwQyw4Q0FBK0I7O0lBQy9CLDZDQUE4Qjs7SUFDOUIsK0NBQWlDOztJQUNqQyw4Q0FBZ0M7O0lBQ2hDLDhDQUF5Qzs7SUFDekMsdUNBQXdCOztJQUN4QiwyQ0FBNEI7O0lBRTVCLDJDQUFzQzs7SUFDdEMsNkNBQStCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgbWFydGluIG9uIDE3LjAyLjIwMTcuXHJcbiAqIENvbGxlY3Rpb24gb2YgYWxsIHBhcmFtZXRlcnMgdXNlZCBieSB0aGUgdG9vbC5cclxuICogVGhlIHBhcmFtZXRlcnMgYXJlIHJlYWQgZm9ybSB0aGUgcHJvZmlsZSBvciBkZWZhdWx0cyBhcmUgdXNlZC5cclxuICovXHJcblxyXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCB7WGxpZmZNZXJnZUVycm9yfSBmcm9tICcuL3hsaWZmLW1lcmdlLWVycm9yJztcclxuaW1wb3J0IHtTdGF0c30gZnJvbSAnZnMnO1xyXG5pbXBvcnQge0NvbW1hbmRPdXRwdXR9IGZyb20gJy4uL2NvbW1vbi9jb21tYW5kLW91dHB1dCc7XHJcbmltcG9ydCB7Zm9ybWF0fSBmcm9tICd1dGlsJztcclxuaW1wb3J0IHtpc0FycmF5LCBpc051bGxPclVuZGVmaW5lZH0gZnJvbSAnLi4vY29tbW9uL3V0aWwnO1xyXG5pbXBvcnQge1Byb2dyYW1PcHRpb25zLCBJQ29uZmlnRmlsZX0gZnJvbSAnLi9pLXhsaWZmLW1lcmdlLW9wdGlvbnMnO1xyXG5pbXBvcnQge0ZpbGVVdGlsfSBmcm9tICcuLi9jb21tb24vZmlsZS11dGlsJztcclxuaW1wb3J0IHtOZ3hUcmFuc2xhdGVFeHRyYWN0b3J9IGZyb20gJy4vbmd4LXRyYW5zbGF0ZS1leHRyYWN0b3InO1xyXG5pbXBvcnQge2Rpcm5hbWUsIGlzQWJzb2x1dGUsIGpvaW4sIG5vcm1hbGl6ZX0gZnJvbSAncGF0aCc7XHJcblxyXG5jb25zdCBQUk9GSUxFX0NBTkRJREFURVMgPSBbJ3BhY2thZ2UuanNvbicsICcuYW5ndWxhci1jbGkuanNvbiddO1xyXG5cclxuZXhwb3J0IGNsYXNzIFhsaWZmTWVyZ2VQYXJhbWV0ZXJzIHtcclxuXHJcbiAgICBwcml2YXRlIHVzZWRQcm9maWxlUGF0aDogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfcXVpZXQ6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIF92ZXJib3NlOiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfYWxsb3dJZENoYW5nZTogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgX2RlZmF1bHRMYW5ndWFnZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfc3JjRGlyOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9pMThuQmFzZUZpbGU6IHN0cmluZztcclxuICAgIHByaXZhdGUgX2kxOG5GaWxlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9pMThuRm9ybWF0OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9lbmNvZGluZzogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfZ2VuRGlyOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9sYW5ndWFnZXM6IHN0cmluZ1tdO1xyXG4gICAgcHJpdmF0ZSBfcmVtb3ZlVW51c2VkSWRzOiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfc3VwcG9ydE5neFRyYW5zbGF0ZTogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgX25neFRyYW5zbGF0ZUV4dHJhY3Rpb25QYXR0ZXJuOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF91c2VTb3VyY2VBc1RhcmdldDogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgX3RhcmdldFByYWVmaXg6IHN0cmluZztcclxuICAgIHByaXZhdGUgX3RhcmdldFN1ZmZpeDogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfYmVhdXRpZnlPdXRwdXQ6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIF9wcmVzZXJ2ZU9yZGVyOiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfYXV0b3RyYW5zbGF0ZTogYm9vbGVhbnxzdHJpbmdbXTtcclxuICAgIHByaXZhdGUgX2FwaWtleTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfYXBpa2V5ZmlsZTogc3RyaW5nO1xyXG5cclxuICAgIHB1YmxpYyBlcnJvcnNGb3VuZDogWGxpZmZNZXJnZUVycm9yW107XHJcbiAgICBwdWJsaWMgd2FybmluZ3NGb3VuZDogc3RyaW5nW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgUGFyYW1ldGVycy5cclxuICAgICAqIEBwYXJhbSBvcHRpb25zIGNvbW1hbmQgb3B0aW9uc1xyXG4gICAgICogQHBhcmFtIHByb2ZpbGVDb250ZW50IGdpdmVuIHByb2ZpbGUgKGlmIG5vdCwgaXQgaXMgcmVhZCBmcm9tIHRoZSBwcm9maWxlIHBhdGggZnJvbSBvcHRpb25zKS5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVGcm9tT3B0aW9ucyhvcHRpb25zOiBQcm9ncmFtT3B0aW9ucywgcHJvZmlsZUNvbnRlbnQ/OiBJQ29uZmlnRmlsZSkge1xyXG4gICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSBuZXcgWGxpZmZNZXJnZVBhcmFtZXRlcnMoKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLmNvbmZpZ3VyZShvcHRpb25zLCBwcm9maWxlQ29udGVudCk7XHJcbiAgICAgICAgcmV0dXJuIHBhcmFtZXRlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmVycm9yc0ZvdW5kID0gW107XHJcbiAgICAgICAgdGhpcy53YXJuaW5nc0ZvdW5kID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWFkIHBvdGVudGlhbCBwcm9maWxlLlxyXG4gICAgICogVG8gYmUgYSBjYW5kaWRhdGUsIGZpbGUgbXVzdCBleGlzdCBhbmQgY29udGFpbiBwcm9wZXJ0eSBcInhsaWZmbWVyZ2VPcHRpb25zXCIuXHJcbiAgICAgKiBAcGFyYW0gcHJvZmlsZVBhdGggcGF0aCBvZiBwcm9maWxlXHJcbiAgICAgKiBAcmV0dXJuIHBhcnNlZCBjb250ZW50IG9mIGZpbGUgb3IgbnVsbCwgaWYgZmlsZSBkb2VzIG5vdCBleGlzdCBvciBpcyBub3QgYSBwcm9maWxlIGNhbmRpZGF0ZS5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZFByb2ZpbGVDYW5kaWRhdGUocHJvZmlsZVBhdGg6IHN0cmluZyk6IElDb25maWdGaWxlIHtcclxuICAgICAgICBsZXQgY29udGVudDogc3RyaW5nO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMocHJvZmlsZVBhdGgsICdVVEYtOCcpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyc2VkQ29udGVudDogSUNvbmZpZ0ZpbGUgPSBKU09OLnBhcnNlKGNvbnRlbnQpO1xyXG4gICAgICAgIGlmIChwYXJzZWRDb250ZW50ICYmIHBhcnNlZENvbnRlbnQueGxpZmZtZXJnZU9wdGlvbnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlZENvbnRlbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSBtZSBmcm9tIHRoZSBwcm9maWxlIGNvbnRlbnQuXHJcbiAgICAgKiAocHVibGljIG9ubHkgZm9yIHRlc3QgdXNhZ2UpLlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgb3B0aW9ucyBnaXZlbiBhdCBydW50aW1lIHZpYSBjb21tYW5kIGxpbmVcclxuICAgICAqIEBwYXJhbSBwcm9maWxlQ29udGVudCBpZiBudWxsLCByZWFkIGl0IGZyb20gcHJvZmlsZS5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjb25maWd1cmUob3B0aW9uczogUHJvZ3JhbU9wdGlvbnMsIHByb2ZpbGVDb250ZW50PzogSUNvbmZpZ0ZpbGUpIHtcclxuICAgICAgICB0aGlzLmVycm9yc0ZvdW5kID0gW107XHJcbiAgICAgICAgdGhpcy53YXJuaW5nc0ZvdW5kID0gW107XHJcbiAgICAgICAgaWYgKCFwcm9maWxlQ29udGVudCkge1xyXG4gICAgICAgICAgICBwcm9maWxlQ29udGVudCA9IHRoaXMucmVhZFByb2ZpbGUob3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHZhbGlkUHJvZmlsZTogYm9vbGVhbiA9ICghIXByb2ZpbGVDb250ZW50KTtcclxuICAgICAgICBpZiAob3B0aW9ucy5xdWlldCkge1xyXG4gICAgICAgICAgICB0aGlzLl9xdWlldCA9IG9wdGlvbnMucXVpZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zLnZlcmJvc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmVyYm9zZSA9IG9wdGlvbnMudmVyYm9zZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZhbGlkUHJvZmlsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVGcm9tQ29uZmlnKHByb2ZpbGVDb250ZW50KTtcclxuICAgICAgICAgICAgLy8gaWYgbGFuZ3VhZ2VzIGFyZSBnaXZlbiBhcyBwYXJhbWV0ZXJzLCB0aGV5IG92dmVyaWRlIGV2ZXJ5dGhpbmcgc2FpZCBpbiBwcm9maWxlXHJcbiAgICAgICAgICAgIGlmICghIW9wdGlvbnMubGFuZ3VhZ2VzICYmIG9wdGlvbnMubGFuZ3VhZ2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xhbmd1YWdlcyA9IG9wdGlvbnMubGFuZ3VhZ2VzO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9kZWZhdWx0TGFuZ3VhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZhdWx0TGFuZ3VhZ2UgPSB0aGlzLl9sYW5ndWFnZXNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jaGVja1BhcmFtZXRlcnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWFkIHByb2ZpbGUuXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBwcm9ncmFtIG9wdGlvbnNcclxuICAgICAqIEByZXR1cm4gdGhlIHJlYWQgcHJvZmlsZSAoZW1wdHksIGlmIG5vbmUsIG51bGwgaWYgZXJyb3JzKVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlYWRQcm9maWxlKG9wdGlvbnM6IFByb2dyYW1PcHRpb25zKTogSUNvbmZpZ0ZpbGUge1xyXG4gICAgICAgIGNvbnN0IHByb2ZpbGVQYXRoOiBzdHJpbmcgPSBvcHRpb25zLnByb2ZpbGVQYXRoO1xyXG4gICAgICAgIGlmICghcHJvZmlsZVBhdGgpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBjb25maWdmaWxlbmFtZSBvZiBQUk9GSUxFX0NBTkRJREFURVMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHByb2ZpbGUgPSBYbGlmZk1lcmdlUGFyYW1ldGVycy5yZWFkUHJvZmlsZUNhbmRpZGF0ZShjb25maWdmaWxlbmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlZFByb2ZpbGVQYXRoID0gY29uZmlnZmlsZW5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2ZpbGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgY29udGVudDogc3RyaW5nO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMocHJvZmlsZVBhdGgsICdVVEYtOCcpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yc0ZvdW5kLnB1c2gobmV3IFhsaWZmTWVyZ2VFcnJvcignY291bGQgbm90IHJlYWQgcHJvZmlsZSBcIicgKyBwcm9maWxlUGF0aCArICdcIicpKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXNlZFByb2ZpbGVQYXRoID0gcHJvZmlsZVBhdGg7XHJcbiAgICAgICAgY29uc3QgcHJvZmlsZUNvbnRlbnQ6IElDb25maWdGaWxlID0gSlNPTi5wYXJzZShjb250ZW50KTtcclxuICAgICAgICAvLyByZXBsYWNlIGFsbCBwYXRoZXMgaW4gb3B0aW9ucyBieSBhYnNvbHV0ZSBwYXRoc1xyXG4gICAgICAgIGNvbnN0IHhsaWZmbWVyZ2VPcHRpb25zID0gcHJvZmlsZUNvbnRlbnQueGxpZmZtZXJnZU9wdGlvbnM7XHJcbiAgICAgICAgeGxpZmZtZXJnZU9wdGlvbnMuc3JjRGlyID0gdGhpcy5hZGp1c3RQYXRoVG9Qcm9maWxlUGF0aChwcm9maWxlUGF0aCwgeGxpZmZtZXJnZU9wdGlvbnMuc3JjRGlyKTtcclxuICAgICAgICB4bGlmZm1lcmdlT3B0aW9ucy5nZW5EaXIgPSB0aGlzLmFkanVzdFBhdGhUb1Byb2ZpbGVQYXRoKHByb2ZpbGVQYXRoLCB4bGlmZm1lcmdlT3B0aW9ucy5nZW5EaXIpO1xyXG4gICAgICAgIHhsaWZmbWVyZ2VPcHRpb25zLmFwaWtleWZpbGUgPSB0aGlzLmFkanVzdFBhdGhUb1Byb2ZpbGVQYXRoKHByb2ZpbGVQYXRoLCB4bGlmZm1lcmdlT3B0aW9ucy5hcGlrZXlmaWxlKTtcclxuICAgICAgICByZXR1cm4gcHJvZmlsZUNvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGp1c3RQYXRoVG9Qcm9maWxlUGF0aChwcm9maWxlUGF0aDogc3RyaW5nLCBwYXRoVG9BZGp1c3Q6IHN0cmluZyB8IHVuZGVmaW5lZCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgaWYgKCFwYXRoVG9BZGp1c3QgfHwgaXNBYnNvbHV0ZShwYXRoVG9BZGp1c3QpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXRoVG9BZGp1c3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBqb2luKGRpcm5hbWUocHJvZmlsZVBhdGgpLCBwYXRoVG9BZGp1c3QpLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRpYWxpemVGcm9tQ29uZmlnKHByb2ZpbGVDb250ZW50OiBJQ29uZmlnRmlsZSkge1xyXG4gICAgICAgIGlmICghcHJvZmlsZUNvbnRlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwcm9maWxlID0gcHJvZmlsZUNvbnRlbnQueGxpZmZtZXJnZU9wdGlvbnM7XHJcbiAgICAgICAgaWYgKHByb2ZpbGUpIHtcclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmaW5lZChwcm9maWxlLnF1aWV0KSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcXVpZXQgPSBwcm9maWxlLnF1aWV0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQocHJvZmlsZS52ZXJib3NlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmVyYm9zZSA9IHByb2ZpbGUudmVyYm9zZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHByb2ZpbGUuYWxsb3dJZENoYW5nZSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2FsbG93SWRDaGFuZ2UgPSBwcm9maWxlLmFsbG93SWRDaGFuZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHByb2ZpbGUuZGVmYXVsdExhbmd1YWdlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWZhdWx0TGFuZ3VhZ2UgPSBwcm9maWxlLmRlZmF1bHRMYW5ndWFnZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocHJvZmlsZS5sYW5ndWFnZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xhbmd1YWdlcyA9IHByb2ZpbGUubGFuZ3VhZ2VzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcm9maWxlLnNyY0Rpcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3JjRGlyID0gcHJvZmlsZS5zcmNEaXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHByb2ZpbGUuYW5ndWxhckNvbXBpbGVyT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb2ZpbGUuYW5ndWxhckNvbXBpbGVyT3B0aW9ucy5nZW5EaXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9nZW5EaXIgPSBwcm9maWxlLmFuZ3VsYXJDb21waWxlck9wdGlvbnMuZ2VuRGlyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcm9maWxlLmdlbkRpcikge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBtdXN0IGJlIGFmdGVyIGFuZ3VsYXJDb21waWxlck9wdGlvbnMgdG8gYmUgcHJlZmVycmVkXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9nZW5EaXIgPSBwcm9maWxlLmdlbkRpcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocHJvZmlsZS5pMThuQmFzZUZpbGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2kxOG5CYXNlRmlsZSA9IHByb2ZpbGUuaTE4bkJhc2VGaWxlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcm9maWxlLmkxOG5GaWxlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pMThuRmlsZSA9IHByb2ZpbGUuaTE4bkZpbGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHByb2ZpbGUuaTE4bkZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faTE4bkZvcm1hdCA9IHByb2ZpbGUuaTE4bkZvcm1hdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocHJvZmlsZS5lbmNvZGluZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZW5jb2RpbmcgPSBwcm9maWxlLmVuY29kaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQocHJvZmlsZS5yZW1vdmVVbnVzZWRJZHMpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVVbnVzZWRJZHMgPSBwcm9maWxlLnJlbW92ZVVudXNlZElkcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHByb2ZpbGUuc3VwcG9ydE5neFRyYW5zbGF0ZSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N1cHBvcnROZ3hUcmFuc2xhdGUgPSBwcm9maWxlLnN1cHBvcnROZ3hUcmFuc2xhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmaW5lZChwcm9maWxlLm5neFRyYW5zbGF0ZUV4dHJhY3Rpb25QYXR0ZXJuKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbmd4VHJhbnNsYXRlRXh0cmFjdGlvblBhdHRlcm4gPSBwcm9maWxlLm5neFRyYW5zbGF0ZUV4dHJhY3Rpb25QYXR0ZXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQocHJvZmlsZS51c2VTb3VyY2VBc1RhcmdldCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3VzZVNvdXJjZUFzVGFyZ2V0ID0gcHJvZmlsZS51c2VTb3VyY2VBc1RhcmdldDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHByb2ZpbGUudGFyZ2V0UHJhZWZpeCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RhcmdldFByYWVmaXggPSBwcm9maWxlLnRhcmdldFByYWVmaXg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmaW5lZChwcm9maWxlLnRhcmdldFN1ZmZpeCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RhcmdldFN1ZmZpeCA9IHByb2ZpbGUudGFyZ2V0U3VmZml4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQocHJvZmlsZS5hdXRvdHJhbnNsYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYXV0b3RyYW5zbGF0ZSA9IHByb2ZpbGUuYXV0b3RyYW5zbGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHByb2ZpbGUuYmVhdXRpZnlPdXRwdXQpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9iZWF1dGlmeU91dHB1dCA9IHByb2ZpbGUuYmVhdXRpZnlPdXRwdXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmaW5lZChwcm9maWxlLnByZXNlcnZlT3JkZXIpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVzZXJ2ZU9yZGVyID0gcHJvZmlsZS5wcmVzZXJ2ZU9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQocHJvZmlsZS5hcGlrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hcGlrZXkgPSBwcm9maWxlLmFwaWtleTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHByb2ZpbGUuYXBpa2V5ZmlsZSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2FwaWtleWZpbGUgPSBwcm9maWxlLmFwaWtleWZpbGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLndhcm5pbmdzRm91bmQucHVzaCgnZGlkIG5vdCBmaW5kIFwieGxpZmZtZXJnZU9wdGlvbnNcIiBpbiBwcm9maWxlLCB1c2luZyBkZWZhdWx0cycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENoZWNrIGFsbCBQYXJhbWV0ZXJzLCB3ZXRoZXIgdGhleSBhcmUgY29tcGxldGUgYW5kIGNvbnNpc3RlbnQuXHJcbiAgICAgKiBpZiBzb21ldGhpbmcgaXMgd3Jvbmcgd2l0aCB0aGUgcGFyYW1ldGVycywgaXQgaXMgY29sbGVjdGVkIGluIGVycm9yc0ZvdW5kLlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNoZWNrUGFyYW1ldGVycygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNoZWNrTGFuZ3VhZ2VTeW50YXgodGhpcy5kZWZhdWx0TGFuZ3VhZ2UoKSk7XHJcbiAgICAgICAgaWYgKHRoaXMubGFuZ3VhZ2VzKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JzRm91bmQucHVzaChuZXcgWGxpZmZNZXJnZUVycm9yKCdubyBsYW5ndWFnZXMgc3BlY2lmaWVkJykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxhbmd1YWdlcygpLmZvckVhY2goKGxhbmcpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja0xhbmd1YWdlU3ludGF4KGxhbmcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGxldCBzdGF0czogU3RhdHM7XHJcbiAgICAgICAgbGV0IGVycjogYW55O1xyXG4gICAgICAgIC8vIHNyY0RpciBzaG91bGQgZXhpc3RzXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgc3RhdHMgPSBmcy5zdGF0U3luYyh0aGlzLnNyY0RpcigpKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGVyciA9IGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghIWVyciB8fCAhc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yc0ZvdW5kLnB1c2gobmV3IFhsaWZmTWVyZ2VFcnJvcignc3JjRGlyIFwiJyArIHRoaXMuc3JjRGlyKCkgKyAnXCIgaXMgbm90IGEgZGlyZWN0b3J5JykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBnZW5EaXIgc2hvdWxkIGV4aXN0c1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHN0YXRzID0gZnMuc3RhdFN5bmModGhpcy5nZW5EaXIoKSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBlcnIgPSBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoISFlcnIgfHwgIXN0YXRzLmlzRGlyZWN0b3J5KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5lcnJvcnNGb3VuZC5wdXNoKG5ldyBYbGlmZk1lcmdlRXJyb3IoJ2dlbkRpciBcIicgKyB0aGlzLmdlbkRpcigpICsgJ1wiIGlzIG5vdCBhIGRpcmVjdG9yeScpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gbWFzdGVyIGZpbGUgTVVTVCBleGlzdFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGZzLmFjY2Vzc1N5bmModGhpcy5pMThuRmlsZSgpLCBmcy5jb25zdGFudHMuUl9PSyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JzRm91bmQucHVzaChuZXcgWGxpZmZNZXJnZUVycm9yKCdpMThuRmlsZSBcIicgKyB0aGlzLmkxOG5GaWxlKCkgKyAnXCIgaXMgbm90IHJlYWRhYmxlJykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpMThuRm9ybWF0IG11c3QgYmUgeGxmIHhsZjIgb3IgeG1iXHJcbiAgICAgICAgaWYgKCEodGhpcy5pMThuRm9ybWF0KCkgPT09ICd4bGYnIHx8IHRoaXMuaTE4bkZvcm1hdCgpID09PSAneGxmMicgfHwgdGhpcy5pMThuRm9ybWF0KCkgPT09ICd4bWInKSkge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yc0ZvdW5kLnB1c2gobmV3IFhsaWZmTWVyZ2VFcnJvcignaTE4bkZvcm1hdCBcIicgKyB0aGlzLmkxOG5Gb3JtYXQoKSArICdcIiBpbnZhbGlkLCBtdXN0IGJlIFwieGxmXCIgb3IgXCJ4bGYyXCIgb3IgXCJ4bWJcIicpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYXV0b3RyYW5zbGF0ZSByZXF1aXJlcyBhcGkga2V5XHJcbiAgICAgICAgaWYgKHRoaXMuYXV0b3RyYW5zbGF0ZSgpICYmICF0aGlzLmFwaWtleSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JzRm91bmQucHVzaChuZXcgWGxpZmZNZXJnZUVycm9yKCdhdXRvdHJhbnNsYXRlIHJlcXVpcmVzIGFuIEFQSSBrZXksIHBsZWFzZSBzZXQgb25lJykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBhdXRvdHJhbnNsYXRlZCBsYW5ndWFnZXMgbXVzdCBiZSBpbiBsaXN0IG9mIGFsbCBsYW5ndWFnZXNcclxuICAgICAgICB0aGlzLmF1dG90cmFuc2xhdGVkTGFuZ3VhZ2VzKCkuZm9yRWFjaCgobGFuZykgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sYW5ndWFnZXMoKS5pbmRleE9mKGxhbmcpIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcnNGb3VuZC5wdXNoKG5ldyBYbGlmZk1lcmdlRXJyb3IoJ2F1dG90cmFuc2xhdGUgbGFuZ3VhZ2UgXCInICsgbGFuZyArICdcIiBpcyBub3QgaW4gbGlzdCBvZiBsYW5ndWFnZXMnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGxhbmcgPT09IHRoaXMuZGVmYXVsdExhbmd1YWdlKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzRm91bmQucHVzaChcclxuICAgICAgICAgICAgICAgICAgICBuZXcgWGxpZmZNZXJnZUVycm9yKCdhdXRvdHJhbnNsYXRlIGxhbmd1YWdlIFwiJyArIGxhbmcgKyAnXCIgY2Fubm90IGJlIHRyYW5zbGF0ZWQsIGJlY2F1c2UgaXQgaXMgdGhlIHNvdXJjZSBsYW5ndWFnZScpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIG5neCB0cmFuc2xhdGUgcGF0dGVybiBjaGVja1xyXG4gICAgICAgIGlmICh0aGlzLnN1cHBvcnROZ3hUcmFuc2xhdGUoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBjaGVja1Jlc3VsdCA9IE5neFRyYW5zbGF0ZUV4dHJhY3Rvci5jaGVja1BhdHRlcm4odGhpcy5uZ3hUcmFuc2xhdGVFeHRyYWN0aW9uUGF0dGVybigpKTtcclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmaW5lZChjaGVja1Jlc3VsdCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzRm91bmQucHVzaChcclxuICAgICAgICAgICAgICAgICAgICBuZXcgWGxpZmZNZXJnZUVycm9yKCduZ3hUcmFuc2xhdGVFeHRyYWN0aW9uUGF0dGVybiBcIicgKyB0aGlzLm5neFRyYW5zbGF0ZUV4dHJhY3Rpb25QYXR0ZXJuKCkgKyAnXCI6ICcgKyBjaGVja1Jlc3VsdCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRhcmdldFByYWVmaXggYW5kIHRhcmdldFN1ZmZpeCBjaGVja1xyXG4gICAgICAgIGlmICghdGhpcy51c2VTb3VyY2VBc1RhcmdldCgpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFByYWVmaXgoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndhcm5pbmdzRm91bmQucHVzaChcclxuICAgICAgICAgICAgICAgICAgICAnY29uZmlndXJlZCB0YXJnZXRQcmFlZml4IFwiJyArIHRoaXMudGFyZ2V0UHJhZWZpeCgpICsgJ1wiIHdpbGwgbm90IGJlIHVzZWQgYmVjYXVzZSBcInVzZVNvdXJjZUFzVGFyZ2V0XCIgaXMgZGlzYWJsZWRcIicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFN1ZmZpeCgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMud2FybmluZ3NGb3VuZC5wdXNoKFxyXG4gICAgICAgICAgICAgICAgICAgICdjb25maWd1cmVkIHRhcmdldFN1ZmZpeCBcIicgKyB0aGlzLnRhcmdldFN1ZmZpeCgpICsgJ1wiIHdpbGwgbm90IGJlIHVzZWQgYmVjYXVzZSBcInVzZVNvdXJjZUFzVGFyZ2V0XCIgaXMgZGlzYWJsZWRcIicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENoZWNrIHN5bnRheCBvZiBsYW5ndWFnZS5cclxuICAgICAqIE11c3QgYmUgY29tcGF0aWJsZSB3aXRoIFhNTCBTY2hlbWEgdHlwZSB4c2Q6bGFuZ3VhZ2UuXHJcbiAgICAgKiBQYXR0ZXJuOiBbYS16QS1aXXsxLDh9KCgtfF8pW2EtekEtWjAtOV17MSw4fSkqXHJcbiAgICAgKiBAcGFyYW0gbGFuZyBsYW5ndWFnZSB0byBjaGVja1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNoZWNrTGFuZ3VhZ2VTeW50YXgobGFuZzogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgcGF0dGVybiA9IC9eW2EtekEtWl17MSw4fShbLV9dW2EtekEtWjAtOV17MSw4fSkqJC87XHJcbiAgICAgICAgaWYgKCFwYXR0ZXJuLnRlc3QobGFuZykpIHtcclxuICAgICAgICAgICAgdGhpcy5lcnJvcnNGb3VuZC5wdXNoKG5ldyBYbGlmZk1lcmdlRXJyb3IoJ2xhbmd1YWdlIFwiJyArIGxhbmcgKyAnXCIgaXMgbm90IHZhbGlkJykpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWxsb3dJZENoYW5nZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX2FsbG93SWRDaGFuZ2UpKSA/IGZhbHNlIDogdGhpcy5fYWxsb3dJZENoYW5nZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdmVyYm9zZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX3ZlcmJvc2UpKSA/IGZhbHNlIDogdGhpcy5fdmVyYm9zZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcXVpZXQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIChpc051bGxPclVuZGVmaW5lZCh0aGlzLl9xdWlldCkpID8gZmFsc2UgOiB0aGlzLl9xdWlldDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERlYnVnIG91dHB1dCBhbGwgcGFyYW1ldGVycyB0byBjb21tYW5kT3V0cHV0LlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2hvd0FsbFBhcmFtZXRlcnMoY29tbWFuZE91dHB1dDogQ29tbWFuZE91dHB1dCk6IHZvaWQge1xyXG4gICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ3hsaWZmbWVyZ2UgVXNlZCBQYXJhbWV0ZXJzOicpO1xyXG4gICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ3VzZWRQcm9maWxlUGF0aDpcXHRcIiVzXCInLCB0aGlzLnVzZWRQcm9maWxlUGF0aCk7XHJcbiAgICAgICAgY29tbWFuZE91dHB1dC5kZWJ1ZygnZGVmYXVsdExhbmd1YWdlOlxcdFwiJXNcIicsIHRoaXMuZGVmYXVsdExhbmd1YWdlKCkpO1xyXG4gICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ3NyY0RpcjpcXHRcIiVzXCInLCB0aGlzLnNyY0RpcigpKTtcclxuICAgICAgICBjb21tYW5kT3V0cHV0LmRlYnVnKCdnZW5EaXI6XFx0XCIlc1wiJywgdGhpcy5nZW5EaXIoKSk7XHJcbiAgICAgICAgY29tbWFuZE91dHB1dC5kZWJ1ZygnaTE4bkJhc2VGaWxlOlxcdFwiJXNcIicsIHRoaXMuaTE4bkJhc2VGaWxlKCkpO1xyXG4gICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ2kxOG5GaWxlOlxcdFwiJXNcIicsIHRoaXMuaTE4bkZpbGUoKSk7XHJcbiAgICAgICAgY29tbWFuZE91dHB1dC5kZWJ1ZygnbGFuZ3VhZ2VzOlxcdCVzJywgdGhpcy5sYW5ndWFnZXMoKSk7XHJcbiAgICAgICAgZm9yIChjb25zdCBsYW5ndWFnZSBvZiB0aGlzLmxhbmd1YWdlcygpKSB7XHJcbiAgICAgICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ291dHB1dEZpbGVbJXNdOlxcdCVzJywgbGFuZ3VhZ2UsIHRoaXMuZ2VuZXJhdGVkSTE4bkZpbGUobGFuZ3VhZ2UpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29tbWFuZE91dHB1dC5kZWJ1ZygncmVtb3ZlVW51c2VkSWRzOlxcdCVzJywgdGhpcy5yZW1vdmVVbnVzZWRJZHMoKSk7XHJcbiAgICAgICAgY29tbWFuZE91dHB1dC5kZWJ1Zygnc3VwcG9ydE5neFRyYW5zbGF0ZTpcXHQlcycsIHRoaXMuc3VwcG9ydE5neFRyYW5zbGF0ZSgpKTtcclxuICAgICAgICBpZiAodGhpcy5zdXBwb3J0Tmd4VHJhbnNsYXRlKCkpIHtcclxuICAgICAgICAgICAgY29tbWFuZE91dHB1dC5kZWJ1Zygnbmd4VHJhbnNsYXRlRXh0cmFjdGlvblBhdHRlcm46XFx0JXMnLCB0aGlzLm5neFRyYW5zbGF0ZUV4dHJhY3Rpb25QYXR0ZXJuKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb21tYW5kT3V0cHV0LmRlYnVnKCd1c2VTb3VyY2VBc1RhcmdldDpcXHQlcycsIHRoaXMudXNlU291cmNlQXNUYXJnZXQoKSk7XHJcbiAgICAgICAgaWYgKHRoaXMudXNlU291cmNlQXNUYXJnZXQoKSkge1xyXG4gICAgICAgICAgICBjb21tYW5kT3V0cHV0LmRlYnVnKCd0YXJnZXRQcmFlZml4OlxcdFwiJXNcIicsIHRoaXMudGFyZ2V0UHJhZWZpeCgpKTtcclxuICAgICAgICAgICAgY29tbWFuZE91dHB1dC5kZWJ1ZygndGFyZ2V0U3VmZml4OlxcdFwiJXNcIicsIHRoaXMudGFyZ2V0U3VmZml4KCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb21tYW5kT3V0cHV0LmRlYnVnKCdhbGxvd0lkQ2hhbmdlOlxcdCVzJywgdGhpcy5hbGxvd0lkQ2hhbmdlKCkpO1xyXG4gICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ2JlYXV0aWZ5T3V0cHV0OlxcdCVzJywgdGhpcy5iZWF1dGlmeU91dHB1dCgpKTtcclxuICAgICAgICBjb21tYW5kT3V0cHV0LmRlYnVnKCdwcmVzZXJ2ZU9yZGVyOlxcdCVzJywgdGhpcy5wcmVzZXJ2ZU9yZGVyKCkpO1xyXG4gICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ2F1dG90cmFuc2xhdGU6XFx0JXMnLCB0aGlzLmF1dG90cmFuc2xhdGUoKSk7XHJcbiAgICAgICAgaWYgKHRoaXMuYXV0b3RyYW5zbGF0ZSgpKSB7XHJcbiAgICAgICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ2F1dG90cmFuc2xhdGVkIGxhbmd1YWdlczpcXHQlcycsIHRoaXMuYXV0b3RyYW5zbGF0ZWRMYW5ndWFnZXMoKSk7XHJcbiAgICAgICAgICAgIGNvbW1hbmRPdXRwdXQuZGVidWcoJ2FwaWtleTpcXHQlcycsIHRoaXMuYXBpa2V5KCkgPyAnKioqKicgOiAnTk9UIFNFVCcpO1xyXG4gICAgICAgICAgICBjb21tYW5kT3V0cHV0LmRlYnVnKCdhcGlrZXlmaWxlOlxcdCVzJywgdGhpcy5hcGlrZXlmaWxlKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERlZmF1bHQtTGFuZ3VhZ2UsIGRlZmF1bHQgZW4uXHJcbiAgICAgKiBAcmV0dXJuIGRlZmF1bHQgbGFuZ3VhZ2VcclxuICAgICAqL1xyXG4gICAgcHVibGljIGRlZmF1bHRMYW5ndWFnZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0TGFuZ3VhZ2UgPyB0aGlzLl9kZWZhdWx0TGFuZ3VhZ2UgOiAnZW4nO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTGlzdGUgZGVyIHp1IGJlYXJiZWl0ZW5kZW4gU3ByYWNoZW4uXHJcbiAgICAgKiBAcmV0dXJuIGxhbmd1YWdlc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbGFuZ3VhZ2VzKCk6IHN0cmluZ1tdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGFuZ3VhZ2VzID8gdGhpcy5fbGFuZ3VhZ2VzIDogW107XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBzcmMgZGlyZWN0b3J5LCB3aGVyZSB0aGUgbWFzdGVyIHhsaWYgaXMgbG9jYXRlZC5cclxuICAgICAqIEByZXR1cm4gc3JjRGlyXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzcmNEaXIoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3JjRGlyID8gdGhpcy5fc3JjRGlyIDogJy4nO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIGJhc2UgZmlsZSBuYW1lIG9mIHRoZSB4bGlmIGZpbGUgZm9yIGlucHV0IGFuZCBvdXRwdXQuXHJcbiAgICAgKiBEZWZhdWx0IGlzIG1lc3NhZ2VzXHJcbiAgICAgKiBAcmV0dXJuIGJhc2UgZmlsZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaTE4bkJhc2VGaWxlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2kxOG5CYXNlRmlsZSA/IHRoaXMuX2kxOG5CYXNlRmlsZSA6ICdtZXNzYWdlcyc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgbWFzdGVyIHhsaWYgZmlsZSAodGhlIG9uZSBnZW5lcmF0ZWQgYnkgbmcteGkxOG4pLlxyXG4gICAgICogRGVmYXVsdCBpcyA8c3JjRGlyPi88aTE4bkJhc2VGaWxlPi54bGYuXHJcbiAgICAgKiBAcmV0dXJuIG1hc3RlciBmaWxlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpMThuRmlsZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBqb2luKHRoaXMuc3JjRGlyKCksXHJcbiAgICAgICAgICAgICh0aGlzLl9pMThuRmlsZSA/IHRoaXMuX2kxOG5GaWxlIDogdGhpcy5pMThuQmFzZUZpbGUoKSArICcuJyArIHRoaXMuc3VmZml4Rm9yR2VuZXJhdGVkSTE4bkZpbGUoKSlcclxuICAgICAgICApLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZvcm1hdCBvZiB0aGUgbWFzdGVyIHhsaWYgZmlsZS5cclxuICAgICAqIERlZmF1bHQgaXMgXCJ4bGZcIiwgcG9zc2libGUgYXJlIFwieGxmXCIgb3IgXCJ4bGYyXCIgb3IgXCJ4bWJcIi5cclxuICAgICAqIEByZXR1cm4gZm9ybWF0XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpMThuRm9ybWF0KCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLl9pMThuRm9ybWF0ID8gdGhpcy5faTE4bkZvcm1hdCA6ICd4bGYnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHBvdGVudGlhbGx5IHRvIGJlIGdlbmVyYXRlZCBJMThuLUZpbGUgd2l0aCB0aGUgdHJhbnNsYXRpb25zIGZvciBvbmUgbGFuZ3VhZ2UuXHJcbiAgICAgKiBAcGFyYW0gbGFuZyBsYW5ndWFnZSBzaG9ydGN1dFxyXG4gICAgICogQHJldHVybiBQYXRoIG9mIGZpbGVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdlbmVyYXRlZEkxOG5GaWxlKGxhbmc6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGpvaW4odGhpcy5nZW5EaXIoKSwgdGhpcy5pMThuQmFzZUZpbGUoKSArICcuJyArIGxhbmcgKyAnLicgKyB0aGlzLnN1ZmZpeEZvckdlbmVyYXRlZEkxOG5GaWxlKCkpLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN1ZmZpeEZvckdlbmVyYXRlZEkxOG5GaWxlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmkxOG5Gb3JtYXQoKSkge1xyXG4gICAgICAgICAgICBjYXNlICd4bGYnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICd4bGYnO1xyXG4gICAgICAgICAgICBjYXNlICd4bGYyJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAneGxmJztcclxuICAgICAgICAgICAgY2FzZSAneG1iJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAneHRiJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBwb3RlbnRpYWxseSB0byBiZSBnZW5lcmF0ZWQgdHJhbnNsYXRlLUZpbGUgZm9yIG5neC10cmFuc2xhdGUgd2l0aCB0aGUgdHJhbnNsYXRpb25zIGZvciBvbmUgbGFuZ3VhZ2UuXHJcbiAgICAgKiBAcGFyYW0gbGFuZyBsYW5ndWFnZSBzaG9ydGN1dFxyXG4gICAgICogQHJldHVybiBQYXRoIG9mIGZpbGVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdlbmVyYXRlZE5neFRyYW5zbGF0ZUZpbGUobGFuZzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gam9pbih0aGlzLmdlbkRpcigpLCB0aGlzLmkxOG5CYXNlRmlsZSgpICsgJy4nICsgbGFuZyArICcuJyArICdqc29uJykucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIGVuY29kaW5nIHVzZWQgdG8gd3JpdGUgbmV3IFhMSUZGLWZpbGVzLlxyXG4gICAgICogQHJldHVybiBlbmNvZGluZ1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZW5jb2RpbmcoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZW5jb2RpbmcgPyB0aGlzLl9lbmNvZGluZyA6ICdVVEYtOCc7XHJcbiAgICB9XHJcblxyXG4gICAgIC8qKlxyXG4gICAgICAqIE91dHB1dC1EaXJlY3RvcnksIHdoZXJlIHRoZSBvdXRwdXQgaXMgd3JpdHRlbiB0by5cclxuICAgICAgKiBEZWZhdWx0IGlzIDxzcmNEaXI+LlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2VuRGlyKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dlbkRpciA/IHRoaXMuX2dlbkRpciA6IHRoaXMuc3JjRGlyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlbW92ZVVudXNlZElkcygpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX3JlbW92ZVVudXNlZElkcykpID8gdHJ1ZSA6IHRoaXMuX3JlbW92ZVVudXNlZElkcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3VwcG9ydE5neFRyYW5zbGF0ZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX3N1cHBvcnROZ3hUcmFuc2xhdGUpKSA/IGZhbHNlIDogdGhpcy5fc3VwcG9ydE5neFRyYW5zbGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbmd4VHJhbnNsYXRlRXh0cmFjdGlvblBhdHRlcm4oKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gKGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX25neFRyYW5zbGF0ZUV4dHJhY3Rpb25QYXR0ZXJuKSkgP1xyXG4gICAgICAgICAgICBOZ3hUcmFuc2xhdGVFeHRyYWN0b3IuRGVmYXVsdEV4dHJhY3Rpb25QYXR0ZXJuIDogdGhpcy5fbmd4VHJhbnNsYXRlRXh0cmFjdGlvblBhdHRlcm47XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBXaGV0aGVyIHNvdXJjZSBtdXN0IGJlIHVzZWQgYXMgdGFyZ2V0IGZvciBuZXcgdHJhbnMtdW5pdHNcclxuICAgICAqIERlZmF1bHQgaXMgdHJ1ZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdXNlU291cmNlQXNUYXJnZXQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIChpc051bGxPclVuZGVmaW5lZCh0aGlzLl91c2VTb3VyY2VBc1RhcmdldCkpID8gdHJ1ZSA6IHRoaXMuX3VzZVNvdXJjZUFzVGFyZ2V0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUHJhZWZpeCB1c2VkIGZvciB0YXJnZXQgd2hlbiBjb3B5aW5nIG5ldyB0cmFucy11bml0c1xyXG4gICAgICogRGVmYXVsdCBpcyBcIlwiXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0YXJnZXRQcmFlZml4KCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIChpc051bGxPclVuZGVmaW5lZCh0aGlzLl90YXJnZXRQcmFlZml4KSkgPyAnJyA6IHRoaXMuX3RhcmdldFByYWVmaXg7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWZmaXggdXNlZCBmb3IgdGFyZ2V0IHdoZW4gY29weWluZyBuZXcgdHJhbnMtdW5pdHNcclxuICAgICAqIERlZmF1bHQgaXMgXCJcIlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdGFyZ2V0U3VmZml4KCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIChpc051bGxPclVuZGVmaW5lZCh0aGlzLl90YXJnZXRTdWZmaXgpKSA/ICcnIDogdGhpcy5fdGFyZ2V0U3VmZml4O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSWYgc2V0LCBydW4geG1sIHJlc3VsdCB0aHJvdWdoIGJlYXV0aWZpZXIgKHByZXR0eS1kYXRhKS5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGJlYXV0aWZ5T3V0cHV0KCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAoaXNOdWxsT3JVbmRlZmluZWQodGhpcy5fYmVhdXRpZnlPdXRwdXQpKSA/IGZhbHNlIDogdGhpcy5fYmVhdXRpZnlPdXRwdXQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJZiBzZXQsIG9yZGVyIG9mIG5ldyB0cmFucyB1bml0cyB3aWxsIGJlIGFzIGluIG1hc3Rlci5cclxuICAgICAqIE90aGVyd2lzZSB0aGV5IGFyZSBhZGRlZCBhdCB0aGUgZW5kLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcHJlc2VydmVPcmRlcigpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX3ByZXNlcnZlT3JkZXIpKSA/IHRydWUgOiB0aGlzLl9wcmVzZXJ2ZU9yZGVyO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogV2hldGhlciB0byB1c2UgYXV0b3RyYW5zbGF0ZSBmb3IgbmV3IHRyYW5zLXVuaXRzXHJcbiAgICAgKiBEZWZhdWx0IGlzIGZhbHNlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhdXRvdHJhbnNsYXRlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmIChpc051bGxPclVuZGVmaW5lZCh0aGlzLl9hdXRvdHJhbnNsYXRlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc0FycmF5KHRoaXMuX2F1dG90cmFuc2xhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoPHN0cmluZ1tdPnRoaXMuX2F1dG90cmFuc2xhdGUpLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiA8Ym9vbGVhbj4gdGhpcy5fYXV0b3RyYW5zbGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdoZXRoZXIgdG8gdXNlIGF1dG90cmFuc2xhdGUgZm9yIGEgZ2l2ZW4gbGFuZ3VhZ2UuXHJcbiAgICAgKiBAcGFyYW0gbGFuZyBsYW5ndWFnZSBjb2RlLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYXV0b3RyYW5zbGF0ZUxhbmd1YWdlKGxhbmc6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmF1dG90cmFuc2xhdGVkTGFuZ3VhZ2VzKCkuaW5kZXhPZihsYW5nKSA+PSAwO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIGEgbGlzdCBvZiBsYW5ndWFnZXMgdG8gYmUgYXV0b3RyYW5zbGF0ZWQuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhdXRvdHJhbnNsYXRlZExhbmd1YWdlcygpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgaWYgKGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX2F1dG90cmFuc2xhdGUpIHx8IHRoaXMuX2F1dG90cmFuc2xhdGUgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzQXJyYXkodGhpcy5fYXV0b3RyYW5zbGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuICg8c3RyaW5nW10+dGhpcy5fYXV0b3RyYW5zbGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmxhbmd1YWdlcygpLnNsaWNlKDEpOyAvLyBmaXJzdCBpcyBzb3VyY2UgbGFuZ3VhZ2VcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFQSSBrZXkgdG8gYmUgdXNlZCBmb3IgR29vZ2xlIFRyYW5zbGF0ZVxyXG4gICAgICogQHJldHVybiBhcGkga2V5XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhcGlrZXkoKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX2FwaWtleSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwaWtleTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBhcGlrZXlQYXRoID0gdGhpcy5hcGlrZXlmaWxlKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwaWtleWZpbGUoKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoYXBpa2V5UGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmlsZVV0aWwucmVhZChhcGlrZXlQYXRoLCAndXRmLTgnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdCgnYXBpIGtleSBmaWxlIG5vdCBmb3VuZDogQVBJX0tFWV9GSUxFPSVzJywgYXBpa2V5UGF0aCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBmaWxlIG5hbWUgZm9yIEFQSSBrZXkgdG8gYmUgdXNlZCBmb3IgR29vZ2xlIFRyYW5zbGF0ZS5cclxuICAgICAqIEV4cGxpY2l0bHkgc2V0IG9yIHJlYWQgZnJvbSBlbnYgdmFyIEFQSV9LRVlfRklMRS5cclxuICAgICAqIEByZXR1cm4gZmlsZSBvZiBhcGkga2V5XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhcGlrZXlmaWxlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2FwaWtleWZpbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwaWtleWZpbGU7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzLmVudi5BUElfS0VZX0ZJTEUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3MuZW52LkFQSV9LRVlfRklMRTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19