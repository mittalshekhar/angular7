!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("stream"),require("chalk"),require("util"),require("fs"),require("@ngx-i18nsupport/ngx-i18nsupport-lib"),require("path"),require("request"),require("rxjs"),require("rxjs/operators"),require("he")):"function"==typeof define&&define.amd?define("@ngx-i18nsupport/ngx-i18nsupport",["exports","@angular/core","stream","chalk","util","fs","@ngx-i18nsupport/ngx-i18nsupport-lib","path","request","rxjs","rxjs/operators","he"],e):e((t["ngx-i18nsupport"]=t["ngx-i18nsupport"]||{},t["ngx-i18nsupport"]["ngx-i18nsupport"]={}),t.ng.core,t.stream,t.chalk,t.util,t.fs,t.ngxI18nsupportLib,t.path,t.request,t.rxjs,t.rxjs.operators,t.entityDecoderLib)}(this,function(t,e,r,i,o,g,h,n,a,d,m,p){"use strict";i=i&&i.hasOwnProperty("default")?i["default"]:i;var s=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function l(t,e){function r(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function y(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function c(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,i=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)s.push(n.value)}catch(o){a={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(a)throw a.error}}return s}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}function v(t){return t===undefined||null===t}function _(t){return Array.isArray(t)}var x=function(e){function t(){var t=e.call(this)||this;return t.resultString="",t}return l(t,e),t.prototype._write=function(t,e,r){var n;n=function a(t){return"string"==typeof t}(t)?t:t instanceof Buffer?t.toString():Buffer.alloc(t).toString(e),this.resultString=this.resultString+n,r()},t.prototype.writtenData=function(){return this.resultString},t}(r.Writable),T={ERROR:0,WARN:1,INFO:2,DEBUG:3};T[T.ERROR]="ERROR",T[T.WARN]="WARN",T[T.INFO]="INFO",T[T.DEBUG]="DEBUG";var F=function(){function t(t){this._quiet=!1,this._verbose=!1,this.outputStream=t||process.stdout}return t.prototype.setVerbose=function(){this._verbose=!0},t.prototype.setQuiet=function(){this._quiet=!0},t.prototype.verbose=function(){return this._verbose},t.prototype.quiet=function(){return this._quiet},t.prototype.error=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(T.ERROR,t,e)},t.prototype.warn=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(T.WARN,t,e)},t.prototype.info=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(T.INFO,t,e)},t.prototype.debug=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(T.DEBUG,t,e)},t.prototype.log=function(t,e,r){if(this.isOutputEnabled(t)){var n;switch(t){case T.ERROR:n=i.red("ERROR: "+e);break;case T.WARN:n=i.magenta("WARNING: "+e);break;default:n=i.gray("* "+e)}var a=o.format.apply(void 0,f([n],r));this.outputStream.write(a+"\n")}},t.prototype.isOutputEnabled=function(t){var e,r;switch(r=this._quiet&&this._verbose?e=!1:(e=this._quiet,this._verbose),t){case T.ERROR:return!0;case T.WARN:return!e;case T.INFO:return r&&!e;case T.DEBUG:return r;default:return!0}},t}(),w=function(r){function n(t){var e=r.call(this,t)||this;return Object.setPrototypeOf(e,n.prototype),e}return l(n,r),n}(Error),b=function(){function n(){}return n.exists=function(t){return g.existsSync(t)},n.read=function(t,e){return g.readFileSync(t,e)},n.replaceContent=function(t,e,r){g.writeFileSync(t,e,{encoding:r})},n.copy=function(t,e){for(var r=Buffer.alloc(65536),n=g.openSync(t,"r"),a=g.openSync(e,"w"),i=1,s=0;0<i;)i=g.readSync(n,r,0,65536,s),g.writeSync(a,r,0,i),s+=i;g.closeSync(n),g.closeSync(a)},n.deleteFolderRecursive=function(r){g.existsSync(r)&&(g.readdirSync(r).forEach(function(t){var e=r+"/"+t;g.lstatSync(e).isDirectory()?n.deleteFolderRecursive(e):g.unlinkSync(e)}),g.rmdirSync(r))},n.deleteFolderContentRecursive=function(r){g.existsSync(r)&&g.readdirSync(r).forEach(function(t){var e=r+"/"+t;g.lstatSync(e).isDirectory()?n.deleteFolderRecursive(e):g.unlinkSync(e)})},n.deleteFile=function(t){g.unlinkSync(t)},n}(),O=function(){function t(t){var e=(this.extractionPatternString=t).split("|");this._matchExplicitId=!1,this._descriptionPatterns=[];for(var r=0;r<e.length;r++){var n=e[r];if("@@"===n){if(this._matchExplicitId)throw new Error("extraction pattern must not contain @@ twice");this._matchExplicitId=!0}else{var a=this.checkValidDescriptionPattern(n);if(a)throw new Error(a);this._descriptionPatterns.push(n)}}}return t.prototype.isExplicitIdMatched=function(t){return t&&this._matchExplicitId},t.prototype.isDescriptionMatched=function(t){return 0<=this._descriptionPatterns.indexOf(t)},t.prototype.checkValidDescriptionPattern=function(t){return t?/^[a-zA-Z_][a-zA-Z_-]*$/.test(t)?null:"description pattern must be an identifier containing only letters, digits, _ or -":"empty value not allowed"},t}(),S=function(){function n(t,e){this.messagesFile=t,this.extractionPattern=new O(e)}return n.checkPattern=function(t){try{if(new O(t))return null}catch(e){return e.message}return null},n.extract=function(t,e,r){new n(t,e).extractTo(r)},n.prototype.extractTo=function(t){var e=this.toNgxTranslations(this.extract());e&&0<Object.keys(e).length?b.replaceContent(t,JSON.stringify(e,null,4),"UTF-8"):b.exists(t)&&b.deleteFile(t)},n.prototype.extract=function(){var n=this,a=[];return this.messagesFile.forEachTransUnit(function(t){var e=n.ngxTranslateIdFromTU(t);if(e){var r=t.targetContentNormalized().asDisplayString(h.NORMALIZATION_FORMAT_NGXTRANSLATE);a.push({id:e,message:r})}}),a},n.prototype.ngxTranslateIdFromTU=function(t){if(this.isExplicitlySetId(t.id))return this.extractionPattern.isExplicitIdMatched(t.id)?t.id:null;var e=t.description();return e&&this.extractionPattern.isDescriptionMatched(e)?t.meaning():void 0},n.prototype.isExplicitlySetId=function(t){if(v(t))return!1;return!/^[0-9a-f]{11,}$/.test(t)},n.prototype.toNgxTranslations=function(t){var e=this,r={};return t.forEach(function(t){e.putInTranslationObject(r,t)}),r},n.prototype.putInTranslationObject=function(t,e){var r,n,a=e.id.indexOf(".");if(0===a||a===e.id.length-1)throw new Error('bad nxg-translate id "'+e.id+'"');n=a<0?(r=e.id,""):(r=e.id.substring(0,a),e.id.substring(a+1));var i=t[r];if(v(i)){if(""===n)return void(t[r]=e.message);i={},t[r]=i}else if(""===n)throw new Error('duplicate id praefix "'+e.id+'"');this.putInTranslationObject(i,{id:n,message:e.message})},n.DefaultExtractionPattern="@@|ngx-translate",n}(),E=["package.json",".angular-cli.json"],I=function(){function h(){this.errorsFound=[],this.warningsFound=[]}return h.createFromOptions=function(t,e){var r=new h;return r.configure(t,e),r},h.readProfileCandidate=function(t){var e;try{e=g.readFileSync(t,"UTF-8")}catch(n){return null}var r=JSON.parse(e);return r&&r.xliffmergeOptions?r:null},h.prototype.configure=function(t,e){this.errorsFound=[],this.warningsFound=[],e||(e=this.readProfile(t));var r=!!e;t.quiet&&(this._quiet=t.quiet),t.verbose&&(this._verbose=t.verbose),r&&(this.initializeFromConfig(e),t.languages&&0<t.languages.length&&(this._languages=t.languages,this._defaultLanguage||(this._defaultLanguage=this._languages[0])),this.checkParameters())},h.prototype.readProfile=function(t){var e,r,n,a=t.profilePath;if(!a){try{for(var i=y(E),s=i.next();!s.done;s=i.next()){var o=s.value,u=h.readProfileCandidate(o);if(u)return this.usedProfilePath=o,u}}catch(p){e={error:p}}finally{try{s&&!s.done&&(r=i["return"])&&r.call(i)}finally{if(e)throw e.error}}return{}}try{n=g.readFileSync(a,"UTF-8")}catch(f){return this.errorsFound.push(new w('could not read profile "'+a+'"')),null}this.usedProfilePath=a;var l=JSON.parse(n),c=l.xliffmergeOptions;return c.srcDir=this.adjustPathToProfilePath(a,c.srcDir),c.genDir=this.adjustPathToProfilePath(a,c.genDir),c.apikeyfile=this.adjustPathToProfilePath(a,c.apikeyfile),l},h.prototype.adjustPathToProfilePath=function(t,e){return!e||n.isAbsolute(e)?e:n.join(n.dirname(t),e).replace(/\\/g,"/")},h.prototype.initializeFromConfig=function(t){if(t){var e=t.xliffmergeOptions;e?(v(e.quiet)||(this._quiet=e.quiet),v(e.verbose)||(this._verbose=e.verbose),v(e.allowIdChange)||(this._allowIdChange=e.allowIdChange),e.defaultLanguage&&(this._defaultLanguage=e.defaultLanguage),e.languages&&(this._languages=e.languages),e.srcDir&&(this._srcDir=e.srcDir),e.angularCompilerOptions&&e.angularCompilerOptions.genDir&&(this._genDir=e.angularCompilerOptions.genDir),e.genDir&&(this._genDir=e.genDir),e.i18nBaseFile&&(this._i18nBaseFile=e.i18nBaseFile),e.i18nFile&&(this._i18nFile=e.i18nFile),e.i18nFormat&&(this._i18nFormat=e.i18nFormat),e.encoding&&(this._encoding=e.encoding),v(e.removeUnusedIds)||(this._removeUnusedIds=e.removeUnusedIds),v(e.supportNgxTranslate)||(this._supportNgxTranslate=e.supportNgxTranslate),v(e.ngxTranslateExtractionPattern)||(this._ngxTranslateExtractionPattern=e.ngxTranslateExtractionPattern),v(e.useSourceAsTarget)||(this._useSourceAsTarget=e.useSourceAsTarget),v(e.targetPraefix)||(this._targetPraefix=e.targetPraefix),v(e.targetSuffix)||(this._targetSuffix=e.targetSuffix),v(e.autotranslate)||(this._autotranslate=e.autotranslate),v(e.beautifyOutput)||(this._beautifyOutput=e.beautifyOutput),v(e.preserveOrder)||(this._preserveOrder=e.preserveOrder),v(e.apikey)||(this._apikey=e.apikey),v(e.apikeyfile)||(this._apikeyfile=e.apikeyfile)):this.warningsFound.push('did not find "xliffmergeOptions" in profile, using defaults')}},h.prototype.checkParameters=function(){var t,e,r=this;this.checkLanguageSyntax(this.defaultLanguage()),0===this.languages().length&&this.errorsFound.push(new w("no languages specified")),this.languages().forEach(function(t){r.checkLanguageSyntax(t)});try{t=g.statSync(this.srcDir())}catch(a){e=a}!e&&t.isDirectory()||this.errorsFound.push(new w('srcDir "'+this.srcDir()+'" is not a directory'));try{t=g.statSync(this.genDir())}catch(a){e=a}!e&&t.isDirectory()||this.errorsFound.push(new w('genDir "'+this.genDir()+'" is not a directory'));try{g.accessSync(this.i18nFile(),g.constants.R_OK)}catch(e){this.errorsFound.push(new w('i18nFile "'+this.i18nFile()+'" is not readable'))}if("xlf"!==this.i18nFormat()&&"xlf2"!==this.i18nFormat()&&"xmb"!==this.i18nFormat()&&this.errorsFound.push(new w('i18nFormat "'+this.i18nFormat()+'" invalid, must be "xlf" or "xlf2" or "xmb"')),this.autotranslate()&&!this.apikey()&&this.errorsFound.push(new w("autotranslate requires an API key, please set one")),this.autotranslatedLanguages().forEach(function(t){r.languages().indexOf(t)<0&&r.errorsFound.push(new w('autotranslate language "'+t+'" is not in list of languages')),t===r.defaultLanguage()&&r.errorsFound.push(new w('autotranslate language "'+t+'" cannot be translated, because it is the source language'))}),this.supportNgxTranslate()){var n=S.checkPattern(this.ngxTranslateExtractionPattern());v(n)||this.errorsFound.push(new w('ngxTranslateExtractionPattern "'+this.ngxTranslateExtractionPattern()+'": '+n))}this.useSourceAsTarget()||(0<this.targetPraefix().length&&this.warningsFound.push('configured targetPraefix "'+this.targetPraefix()+'" will not be used because "useSourceAsTarget" is disabled"'),0<this.targetSuffix().length&&this.warningsFound.push('configured targetSuffix "'+this.targetSuffix()+'" will not be used because "useSourceAsTarget" is disabled"'))},h.prototype.checkLanguageSyntax=function(t){/^[a-zA-Z]{1,8}([-_][a-zA-Z0-9]{1,8})*$/.test(t)||this.errorsFound.push(new w('language "'+t+'" is not valid'))},h.prototype.allowIdChange=function(){return!v(this._allowIdChange)&&this._allowIdChange},h.prototype.verbose=function(){return!v(this._verbose)&&this._verbose},h.prototype.quiet=function(){return!v(this._quiet)&&this._quiet},h.prototype.showAllParameters=function(t){var e,r;t.debug("xliffmerge Used Parameters:"),t.debug('usedProfilePath:\t"%s"',this.usedProfilePath),t.debug('defaultLanguage:\t"%s"',this.defaultLanguage()),t.debug('srcDir:\t"%s"',this.srcDir()),t.debug('genDir:\t"%s"',this.genDir()),t.debug('i18nBaseFile:\t"%s"',this.i18nBaseFile()),t.debug('i18nFile:\t"%s"',this.i18nFile()),t.debug("languages:\t%s",this.languages());try{for(var n=y(this.languages()),a=n.next();!a.done;a=n.next()){var i=a.value;t.debug("outputFile[%s]:\t%s",i,this.generatedI18nFile(i))}}catch(s){e={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(e)throw e.error}}t.debug("removeUnusedIds:\t%s",this.removeUnusedIds()),t.debug("supportNgxTranslate:\t%s",this.supportNgxTranslate()),this.supportNgxTranslate()&&t.debug("ngxTranslateExtractionPattern:\t%s",this.ngxTranslateExtractionPattern()),t.debug("useSourceAsTarget:\t%s",this.useSourceAsTarget()),this.useSourceAsTarget()&&(t.debug('targetPraefix:\t"%s"',this.targetPraefix()),t.debug('targetSuffix:\t"%s"',this.targetSuffix())),t.debug("allowIdChange:\t%s",this.allowIdChange()),t.debug("beautifyOutput:\t%s",this.beautifyOutput()),t.debug("preserveOrder:\t%s",this.preserveOrder()),t.debug("autotranslate:\t%s",this.autotranslate()),this.autotranslate()&&(t.debug("autotranslated languages:\t%s",this.autotranslatedLanguages()),t.debug("apikey:\t%s",this.apikey()?"****":"NOT SET"),t.debug("apikeyfile:\t%s",this.apikeyfile()))},h.prototype.defaultLanguage=function(){return this._defaultLanguage?this._defaultLanguage:"en"},h.prototype.languages=function(){return this._languages?this._languages:[]},h.prototype.srcDir=function(){return this._srcDir?this._srcDir:"."},h.prototype.i18nBaseFile=function(){return this._i18nBaseFile?this._i18nBaseFile:"messages"},h.prototype.i18nFile=function(){return n.join(this.srcDir(),this._i18nFile?this._i18nFile:this.i18nBaseFile()+"."+this.suffixForGeneratedI18nFile()).replace(/\\/g,"/")},h.prototype.i18nFormat=function(){return this._i18nFormat?this._i18nFormat:"xlf"},h.prototype.generatedI18nFile=function(t){return n.join(this.genDir(),this.i18nBaseFile()+"."+t+"."+this.suffixForGeneratedI18nFile()).replace(/\\/g,"/")},h.prototype.suffixForGeneratedI18nFile=function(){switch(this.i18nFormat()){case"xlf":case"xlf2":return"xlf";case"xmb":return"xtb"}},h.prototype.generatedNgxTranslateFile=function(t){return n.join(this.genDir(),this.i18nBaseFile()+"."+t+".json").replace(/\\/g,"/")},h.prototype.encoding=function(){return this._encoding?this._encoding:"UTF-8"},h.prototype.genDir=function(){return this._genDir?this._genDir:this.srcDir()},h.prototype.removeUnusedIds=function(){return!!v(this._removeUnusedIds)||this._removeUnusedIds},h.prototype.supportNgxTranslate=function(){return!v(this._supportNgxTranslate)&&this._supportNgxTranslate},h.prototype.ngxTranslateExtractionPattern=function(){return v(this._ngxTranslateExtractionPattern)?S.DefaultExtractionPattern:this._ngxTranslateExtractionPattern},h.prototype.useSourceAsTarget=function(){return!!v(this._useSourceAsTarget)||this._useSourceAsTarget},h.prototype.targetPraefix=function(){return v(this._targetPraefix)?"":this._targetPraefix},h.prototype.targetSuffix=function(){return v(this._targetSuffix)?"":this._targetSuffix},h.prototype.beautifyOutput=function(){return!v(this._beautifyOutput)&&this._beautifyOutput},h.prototype.preserveOrder=function(){return!!v(this._preserveOrder)||this._preserveOrder},h.prototype.autotranslate=function(){return!v(this._autotranslate)&&(_(this._autotranslate)?0<this._autotranslate.length:this._autotranslate)},h.prototype.autotranslateLanguage=function(t){return 0<=this.autotranslatedLanguages().indexOf(t)},h.prototype.autotranslatedLanguages=function(){return v(this._autotranslate)||!1===this._autotranslate?[]:_(this._autotranslate)?this._autotranslate:this.languages().slice(1)},h.prototype.apikey=function(){if(v(this._apikey)){var t=this.apikeyfile();if(this.apikeyfile()){if(g.existsSync(t))return b.read(t,"utf-8");throw new Error(o.format("api key file not found: API_KEY_FILE=%s",t))}return null}return this._apikey},h.prototype.apikeyfile=function(){return this._apikeyfile?this._apikeyfile:process.env.API_KEY_FILE?process.env.API_KEY_FILE:null},h}(),U=null;try{U=require(n.resolve(__dirname,"..","package.json"))}catch(M){try{U=require(n.resolve(__dirname,"..","..","package.json"))}catch(M){U=null}}var A=U?U.version:"unknown",P=function(){function a(){}return a.readXmlFileContent=function(t,e){e||(e=a.DEFAULT_ENCODING);var r=b.read(t,e),n=a.encodingFromXml(r);return n!==e&&(r=b.read(t,n)),{content:r,encoding:n}},a.encodingFromXml=function(t){var e=t.indexOf('encoding="');if(e<0)return this.DEFAULT_ENCODING;var r=t.indexOf('"',e+10);return t.substring(e+10,r)},a.DEFAULT_ENCODING="UTF-8",a}(),N=function(){function s(){}return s.fromFile=function(t,e,r,n){var a=P.readXmlFileContent(e,r),i=s.masterFileContent(n,r);return h.TranslationMessagesFileFactory.fromFileContent(t,a.content,e,a.encoding,i)},s.fromUnknownFormatFile=function(t,e,r){var n=P.readXmlFileContent(t,e),a=s.masterFileContent(r,e);return h.TranslationMessagesFileFactory.fromUnknownFormatFileContent(n.content,t,n.encoding,a)},s.masterFileContent=function(t,e){if(t){var r=P.readXmlFileContent(t,e);return{xmlContent:r.content,path:t,encoding:r.encoding}}return null},s.save=function(t,e){b.replaceContent(t.filename(),t.editedContent(e),t.encoding())},s}(),C=function(){function i(t){this._request=a,this._apiKey=t,this._rootUrl="https://translation.googleapis.com/"}return i.stripRegioncode=function(t){for(var e=t.toLowerCase(),r=0;r<e.length;r++){var n=e.charAt(r);if(n<"a"||"z"<n)return e.substring(0,r)}return e},i.prototype.setApiKey=function(t){this._apiKey=t},i.prototype.translateMultipleStrings=function(t,e,r){var n=this;if(0===t.length)return d.of([]);if(!this._apiKey)return d.throwError("cannot autotranslate: no api key");if(!e||!r)return d.throwError("cannot autotranslate: source and target language must be set");e=i.stripRegioncode(e),r=i.stripRegioncode(r);var a=this.splitMessagesToGoogleLimit(t).map(function(t){return n.limitedTranslateMultipleStrings(t,e,r)});return d.forkJoin(a).pipe(m.map(function(t){for(var e=[],r=0;r<t.length;r++)e=e.concat(t[r]);return e}))},i.prototype.splitMessagesToGoogleLimit=function(t){if(t.length<=128)return[t];for(var e=[],r=[],n=0,a=0;a<t.length;a++)r.push(t[a]),128<=++n&&(e.push(r),r=[],n=0);return 0<r.length&&e.push(r),e},i.prototype.limitedTranslateMultipleStrings=function(t,r,n){var e=this._rootUrl+"language/translate/v2?key="+this._apiKey,a={url:e,body:{q:t,target:n,source:r},json:!0};return this.post(e,a).pipe(m.map(function(t){var e=t.body;if(!e)throw new Error("no result received");if(e.error){if(400!==e.error.code)throw new Error(o.format("Error %s: %s",e.error.code,e.error.message));if("Invalid Value"===e.error.message)throw new Error(o.format('Translation from "%s" to "%s" not supported',r,n));throw new Error(o.format("Invalid request: %s",e.error.message))}return e.data.translations.map(function(t){return t.translatedText})}))},i.prototype.post=function(t,e){return this._call.apply(this,[].concat("post",t,Object.assign({},e||{})))},i.prototype._call=function(r,a,i){var s=this;return d.Observable.create(function(n){var t=[].concat(a,Object.assign({},i||{}),function(t,e,r){if(t)return n.error(t);n.next(Object.assign({},{response:e,body:r})),n.complete()});try{s._request[r].apply(s._request,t)}catch(e){n.error(e)}})},i}(),D=function(){function t(t,e){this._success=t,this._details=e}return t.prototype.success=function(){return this._success},t}(),R=function(){function t(t,e){this._from=t,this._to=e,this._total=0,this._ignored=0,this._success=0,this._failed=0}return t.prototype.setError=function(t,e){this._error=t,this._total=e,this._failed=e},t.prototype.error=function(){return this._error},t.prototype.setIgnored=function(t){this._total+=t,this._ignored=t},t.prototype.addSingleResult=function(t,e){this._total++,e.success()?this._success++:this._failed++},t.prototype.merge=function(t){this._error||(this._error=t._error),this._total+=t.total(),this._ignored+=t.ignored(),this._success+=t.success(),this._failed+=t.failed()},t.prototype.total=function(){return this._total},t.prototype.ignored=function(){return this._ignored},t.prototype.success=function(){return this._success},t.prototype.failed=function(){return this._failed},t.prototype.content=function(){return this._error?o.format('Auto translation from "%s" to "%s" failed: "%s", failed units: %s',this._from,this._to,this._error,this._failed):o.format('Auto translation from "%s" to "%s", total auto translated units: %s, ignored: %s, succesful: %s, failed: %s',this._from,this._to,this._total,this._ignored,this._success,this._failed)},t}(),L=function(){function t(t){this.autoTranslateService=new C(t)}return t.prototype.autoTranslate=function(t,e,r){return d.forkJoin(f([this.doAutoTranslateNonICUMessages(t,e,r)],this.doAutoTranslateICUMessages(t,e,r))).pipe(m.map(function(t){for(var e=t[0],r=1;r<t.length;r++)e.merge(t[r]);return e}))},t.prototype.allUntranslatedTUs=function(t){var e=[];return t.forEachTransUnit(function(t){t.targetState()===h.STATE_NEW&&e.push(t)}),e},t.prototype.doAutoTranslateNonICUMessages=function(s,o,t){var u=this,l=this.allUntranslatedTUs(t),c=l.filter(function(t){return v(t.sourceContentNormalized().getICUMessage())}),r=c.map(function(t){return t.sourceContentNormalized().asDisplayString()});return this.autoTranslateService.translateMultipleStrings(r,s,o).pipe(m.map(function(t){return t.map(function(t){return p.decode(t)})}),m.map(function(t){var e=new R(s,o);e.setIgnored(l.length-c.length);for(var r=0;r<t.length;r++){var n=c[r],a=t[r],i=u.autoTranslateNonICUUnit(n,a);e.addSingleResult(n,i)}return e}),m.catchError(function(t){var e=new R(s,o);return e.setError(t.message,r.length),d.of(e)}))},t.prototype.doAutoTranslateICUMessages=function(e,r,t){var n=this;return this.allUntranslatedTUs(t).filter(function(t){return!v(t.sourceContentNormalized().getICUMessage())}).map(function(t){return n.doAutoTranslateICUMessage(e,r,t)})},t.prototype.doAutoTranslateICUMessage=function(i,s,o){var u=this,l=o.sourceContentNormalized().getICUMessage().getCategories();if(l.find(function(t){return!v(t.getMessageNormalized().getICUMessage())})){var t=new R(i,s);return t.setIgnored(1),d.of(t)}var r=l.map(function(t){return t.getMessageNormalized().asDisplayString()});return this.autoTranslateService.translateMultipleStrings(r,i,s).pipe(m.map(function(t){return t.map(function(t){return p.decode(t)})}),m.map(function(t){for(var e=new R(i,s),r={},n=0;n<t.length;n++)r[l[n].getCategory()]=t[n];var a=u.autoTranslateICUUnit(o,r);return e.addSingleResult(o,a),e}),m.catchError(function(t){var e=new R(i,s);return e.setError(t.message,r.length),d.of(e)}))},t.prototype.autoTranslateNonICUUnit=function(t,e){return this.autoTranslateUnit(t,t.sourceContentNormalized().translate(e))},t.prototype.autoTranslateICUUnit=function(t,e){return this.autoTranslateUnit(t,t.sourceContentNormalized().translateICUMessage(e))},t.prototype.autoTranslateUnit=function(t,e){var r=e.validate(),n=e.validateWarnings();return v(r)?v(n)?(t.translate(e),new D(!0,null)):new D(!1,"warnings detected, not translated"):new D(!1,"errors detected, not translated")},t}(),k=function(){function a(t,e){this.commandOutput=t,this.options=e,this.parameters=null}return a.main=function(t){var e=a.parseArgs(t);e&&new a(new F(process.stdout),e).run(function(t){process.exit(t)})},a.parseArgs=function(t){for(var e={languages:[]},r=1;r<t.length;r++){var n=t[r];if("--version"===n||"-version"===n)console.log("xliffmerge "+A);else if("--verbose"===n||"-v"===n)e.verbose=!0;else if("--profile"===n||"-p"===n){if(++r>=t.length)return console.log("missing config file"),a.showUsage(),null;e.profilePath=t[r]}else if("--quiet"===n||"-q"===n)e.quiet=!0;else if("--help"===n||"-help"===n||"-h"===n)a.showUsage();else{if(0<n.length&&"-"===n.charAt(0))return console.log("unknown option"),null;e.languages.push(n)}}return e},a.showUsage=function(){console.log("usage: xliffmerge <option>* <language>*"),console.log("Options"),console.log("\t-p|--profile a json configuration file containing all relevant parameters."),console.log("\t\tfor details please consult the home page https://github.com/martinroob/ngx-i18nsupport"),console.log("\t-v|--verbose show some output for debugging purposes"),console.log("\t-q|--quiet only show errors, nothing else"),console.log("\t-version|--version show version string"),console.log(""),console.log('\t<language> has to be a valid language short string, e,g. "en", "de", "de-ch"')},a.createFromOptions=function(t,e,r){var n=new a(t,e);return n.parameters=I.createFromOptions(e,r),n},a.prototype.run=function(e,r){this.runAsync().subscribe(function(t){v(e)||e(t)},function(t){v(r)||r(t)})},a.prototype.runAsync=function(){var t,e,r,n,a=this;if(this.options&&this.options.quiet&&this.commandOutput.setQuiet(),this.options&&this.options.verbose&&this.commandOutput.setVerbose(),this.parameters||(this.parameters=I.createFromOptions(this.options)),this.commandOutput.info("xliffmerge version %s",A),this.parameters.verbose()&&this.parameters.showAllParameters(this.commandOutput),0<this.parameters.errorsFound.length){try{for(var i=y(this.parameters.errorsFound),s=i.next();!s.done;s=i.next()){var o=s.value;this.commandOutput.error(o.message)}}catch(f){t={error:f}}finally{try{s&&!s.done&&(e=i["return"])&&e.call(i)}finally{if(t)throw t.error}}return d.of(-1)}if(0<this.parameters.warningsFound.length)try{for(var u=y(this.parameters.warningsFound),l=u.next();!l.done;l=u.next()){var c=l.value;this.commandOutput.warn(c)}}catch(h){r={error:h}}finally{try{l&&!l.done&&(n=u["return"])&&n.call(u)}finally{if(r)throw r.error}}this.readMaster(),this.parameters.autotranslate()&&(this.autoTranslateService=new L(this.parameters.apikey()));var p=[];return this.parameters.languages().forEach(function(t){p.push(a.processLanguage(t))}),d.forkJoin(p).pipe(m.map(function(t){return a.totalRetcode(t)}))},a.prototype.totalRetcode=function(t){for(var e=0;e<t.length;e++)if(0!==t[e])return t[e];return 0},a.prototype.generatedI18nFile=function(t){return this.parameters.generatedI18nFile(t)},a.prototype.generatedNgxTranslateFile=function(t){return this.parameters.generatedNgxTranslateFile(t)},a.prototype.warnings=function(){return this.parameters.warningsFound},a.prototype.readMaster=function(){var e=this;try{this.master=N.fromFile(this.parameters.i18nFormat(),this.parameters.i18nFile(),this.parameters.encoding()),this.master.warnings().forEach(function(t){e.commandOutput.warn(t)});var t=this.master.numberOfTransUnits(),r=this.master.numberOfTransUnitsWithMissingId();this.commandOutput.info("master contains %s trans-units",t),0<r&&this.commandOutput.warn("master contains %s trans-units, but there are %s without id",t,r);var n=this.master.sourceLanguage();n&&n!==this.parameters.defaultLanguage()&&(this.commandOutput.warn('master says to have source-language="%s", should be "%s" (your defaultLanguage)',n,this.parameters.defaultLanguage()),this.master.setSourceLanguage(this.parameters.defaultLanguage()),N.save(this.master,this.parameters.beautifyOutput()),this.commandOutput.warn('changed master source-language="%s" to "%s"',n,this.parameters.defaultLanguage()))}catch(s){if(s instanceof w)return this.commandOutput.error(s.message),d.of(-1);var a=this.parameters.i18nFile(),i=a?o.format('file "%s", ',a):"";throw this.commandOutput.error(i+"oops "+s),s}},a.prototype.processLanguage=function(e){var r=this;this.commandOutput.debug("processing language %s",e);var n=this.parameters.generatedI18nFile(e),a=n;return(b.exists(n)?this.mergeMasterTo(e,n):this.createUntranslatedXliff(e,n)).pipe(m.map(function(){if(r.parameters.supportNgxTranslate()){var t=N.fromFile(r.translationFormat(r.parameters.i18nFormat()),n,r.parameters.encoding(),r.master.filename());S.extract(t,r.parameters.ngxTranslateExtractionPattern(),r.parameters.generatedNgxTranslateFile(e))}return 0}),m.catchError(function(t){if(t instanceof w)return r.commandOutput.error(t.message),d.of(-1);var e=a?o.format('file "%s", ',a):"";throw r.commandOutput.error(e+"oops "+t),t}))},a.prototype.createUntranslatedXliff=function(e,r){var n=this,a=e===this.parameters.defaultLanguage();this.master.setNewTransUnitTargetPraefix(this.parameters.targetPraefix()),this.master.setNewTransUnitTargetSuffix(this.parameters.targetSuffix());var i=this.master.createTranslationFileForLang(e,r,a,this.parameters.useSourceAsTarget());return this.autoTranslate(this.master.sourceLanguage(),e,i).pipe(m.map(function(t){return N.save(i,n.parameters.beautifyOutput()),n.commandOutput.info('created new file "%s" for target-language="%s"',r,e),a||n.commandOutput.warn('please translate file "%s" to target-language="%s"',r,e),null}))},a.prototype.translationFormat=function(t){return t===h.FORMAT_XMB?h.FORMAT_XTB:t},a.prototype.mergeMasterTo=function(t,e){var a=this,i=N.fromFile(this.translationFormat(this.parameters.i18nFormat()),e,this.parameters.encoding()),s=t===this.parameters.defaultLanguage(),o=0,u=0,l=0,c=0,p=0;i.setNewTransUnitTargetPraefix(this.parameters.targetPraefix()),i.setNewTransUnitTargetSuffix(this.parameters.targetSuffix());var f=null;this.master.forEachTransUnit(function(t){var e=i.transUnitWithId(t.id);if(e){if(e.supportsSetSourceContent()&&t.sourceContent()!==e.sourceContent()&&(e.setSourceContent(t.sourceContent()),s?(e.translate(t.sourceContent()),e.setTargetState(h.STATE_FINAL)):e.targetState()===h.STATE_FINAL&&e.setTargetState(h.STATE_TRANSLATED),u++),e.supportsSetSourceReferences()&&!a.areSourceReferencesEqual(t.sourceReferences(),e.sourceReferences())&&(e.setSourceReferences(t.sourceReferences()),l++),e.supportsSetDescriptionAndMeaning()){var r=!1;e.description()!==t.description()&&(e.setDescription(t.description()),r=!0),e.meaning()!==t.meaning()&&(e.setMeaning(t.meaning()),r=!0),r&&c++}f=e}else{var n=void 0;a.parameters.allowIdChange()&&(n=a.processChangedIdUnit(t,i,f))?(f=n,p++):(f=i.importNewTransUnit(t,s,a.parameters.useSourceAsTarget(),a.parameters.preserveOrder()?f:undefined),o++)}}),0<o&&this.commandOutput.warn('merged %s trans-units from master to "%s"',o,t),0<u&&this.commandOutput.warn('transferred %s changed source content from master to "%s"',u,t),0<l&&this.commandOutput.warn('transferred %s source references from master to "%s"',l,t),0<p&&this.commandOutput.warn('found %s changed id\'s in "%s"',p,t),0<c&&this.commandOutput.warn('transferred %s changed descriptions/meanings from master to "%s"',c,t);var r=0;return i.forEachTransUnit(function(t){!v(a.master.transUnitWithId(t.id))||(a.parameters.removeUnusedIds()&&i.removeTransUnitWithId(t.id),r++)}),0<r&&(this.parameters.removeUnusedIds()?this.commandOutput.warn('removed %s unused trans-units in "%s"',r,t):this.commandOutput.warn('keeping %s unused trans-units in "%s", because removeUnused is disabled',r,t)),0===o&&0===r&&0===u&&0===l&&0===c?(this.commandOutput.info('file for "%s" was up to date',t),d.of(null)):this.autoTranslate(this.master.sourceLanguage(),t,i).pipe(m.map(function(){return N.save(i,a.parameters.beautifyOutput()),a.commandOutput.info('updated file "%s" for target-language="%s"',e,t),0<o&&!s&&a.commandOutput.warn('please translate file "%s" to target-language="%s"',e,t),null}))},a.prototype.processChangedIdUnit=function(t,e,r){var n=t.sourceContentNormalized().asDisplayString(h.NORMALIZATION_FORMAT_DEFAULT).trim(),a=null;if(e.forEachTransUnit(function(t){t.sourceContentNormalized().asDisplayString(h.NORMALIZATION_FORMAT_DEFAULT).trim()===n&&(a=t)}),!a)return null;var i=e.importNewTransUnit(t,!1,!1,this.parameters.preserveOrder()?r:undefined),s=a.targetContent();return s&&(i.translate(s),i.setTargetState(h.STATE_TRANSLATED)),i},a.prototype.areSourceReferencesEqual=function(t,e){if(v(t)&&!v(e)||v(e)&&!v(t))return!1;if(v(t)&&v(e))return!0;var r=new Set;t.forEach(function(t){r.add(t.sourcefile+":"+t.linenumber)});var n=new Set;if(e.forEach(function(t){n.add(t.sourcefile+":"+t.linenumber)}),r.size!==n.size)return!1;var a=!0;return n.forEach(function(t){r.has(t)||(a=!1)}),a},a.prototype.autoTranslate=function(t,e,r){var n=this,a=this.parameters.autotranslateLanguage(e);return(a?this.autoTranslateService.autoTranslate(t,e,r):d.of(new R(t,e))).pipe(m.map(function(t){return a&&(t.error()||0<t.failed()?n.commandOutput.error(t.content()):n.commandOutput.warn(t.content())),t}))},a}();t.WriterToString=x,t.CommandOutput=F,t.XliffMerge=k,t.XliffmergeModule=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-i18nsupport-ngx-i18nsupport.umd.min.js.map